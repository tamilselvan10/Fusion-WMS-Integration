<!DOCTYPE html><html xmlns='http://www.w3.org/1999/xhtml'><head><title>Code coverage</title><meta http-equiv="content-type" content="text/html; charset=utf-8" /><script src='https://utplsql.github.io/utPLSQL-coverage-html/assets/application.js' type='text/javascript'></script><link href='https://utplsql.github.io/utPLSQL-coverage-html/assets/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'><link rel="shortcut icon" type="image/png" href="https://utplsql.github.io/utPLSQL-coverage-html/assets/favicon_red.png" /><link rel="icon" type="image/png" href="https://utplsql.github.io/utPLSQL-coverage-html/assets/favicon_red.png" /></head><body><div id="loading"><img src="https://utplsql.github.io/utPLSQL-coverage-html/assets/loading.gif" alt="loading"/></div><div id="wrapper" style="display:none;"><div class="timestamp">Generated <abbr class="timeago" title="2017-07-15T22:00:24">2017-07-15T22:00:24</abbr></div><ul class="group_tabs"></ul><div id="content"><div class="file_list_container" id="991716A5FE7B1B4DB80E6C06908178EB"><h2><span class="group_name">All files</span> (<span class="covered_percent"><span class="red">9.4%</span></span> covered at <span class="covered_strength"><span class="green">5</span></span> hits/line)</h2><a name="991716A5FE7B1B4DB80E6C06908178EB"></a><div><b>15</b> files in total. <b>4158</b> relevant lines. <span class="green"><b>391</b> lines covered</span> and <span class="red"><b>3767</b> lines missed </span></div><table class="file_list"><thead><tr><th>File</th><th>% covered</th><th>Lines</th><th>Relevant Lines</th><th>Lines covered</th><th>Lines missed</th><th>Avg. Hits / Line</th></tr></thead><tbody>
<tr><td class="strong"><a href="#F13AF9CDA3CE83A2366705CF7B5CDA57" class="src_link" title="dev.num_generator">dev.num_generator</a></td><td class="red strong">0 %</td><td>8</td><td>8</td><td>0</td><td>8</td><td>0</td></tr>
<tr><td class="strong"><a href="#11AA0058E23902394DB87854D7CC3DFA" class="src_link" title="dev.pljson">dev.pljson</a></td><td class="red strong">4.4 %</td><td>400</td><td>159</td><td>7</td><td>152</td><td>1</td></tr>
<tr><td class="strong"><a href="#FD68A3F7403B93E6B4416C8A6DCAA2E7" class="src_link" title="dev.pljson_ac">dev.pljson_ac</a></td><td class="red strong">0 %</td><td>195</td><td>195</td><td>0</td><td>195</td><td>0</td></tr>
<tr><td class="strong"><a href="#0EAA32B6814598F107ACC33C126C8363" class="src_link" title="dev.pljson_dyn">dev.pljson_dyn</a></td><td class="red strong">0 %</td><td>245</td><td>245</td><td>0</td><td>245</td><td>0</td></tr>
<tr><td class="strong"><a href="#4014B2709ABFD413F402713A6480B163" class="src_link" title="dev.pljson_ext">dev.pljson_ext</a></td><td class="red strong">0 %</td><td>797</td><td>797</td><td>0</td><td>797</td><td>0</td></tr>
<tr><td class="strong"><a href="#8FCED375345CFEAC810465415BC32011" class="src_link" title="dev.pljson_helper">dev.pljson_helper</a></td><td class="red strong">0 %</td><td>395</td><td>395</td><td>0</td><td>395</td><td>0</td></tr>
<tr><td class="strong"><a href="#FDCEFD8C561B7FB741B71FEA0E74E3A2" class="src_link" title="dev.pljson_list">dev.pljson_list</a></td><td class="red strong">2.03 %</td><td>396</td><td>148</td><td>3</td><td>145</td><td>0</td></tr>
<tr><td class="strong"><a href="#3E7A626619B4AC32F7A62560BD5BD119" class="src_link" title="dev.pljson_ml">dev.pljson_ml</a></td><td class="red strong">0 %</td><td>269</td><td>269</td><td>0</td><td>269</td><td>0</td></tr>
<tr><td class="strong"><a href="#B2E15073521A14742461D99C0EB3054D" class="src_link" title="dev.pljson_parser">dev.pljson_parser</a></td><td class="red strong">63.3 %</td><td>822</td><td>436</td><td>276</td><td>160</td><td>43</td></tr>
<tr><td class="strong"><a href="#762EF77D357D91F6A44C37FF45ABE261" class="src_link" title="dev.pljson_parser_test">dev.pljson_parser_test</a></td><td class="green strong">91.03 %</td><td>193</td><td>78</td><td>71</td><td>7</td><td>3</td></tr>
<tr><td class="strong"><a href="#0BF2DDD14219D82617803C19CBDF2AE1" class="src_link" title="dev.pljson_printer">dev.pljson_printer</a></td><td class="red strong">0 %</td><td>620</td><td>620</td><td>0</td><td>620</td><td>0</td></tr>
<tr><td class="strong"><a href="#054F3C7DC9A5D6BF522C518AF47F1C0A" class="src_link" title="dev.pljson_table_impl">dev.pljson_table_impl</a></td><td class="red strong">0 %</td><td>237</td><td>237</td><td>0</td><td>237</td><td>0</td></tr>
<tr><td class="strong"><a href="#DCD3F257FD70169AFA76532687F65E08" class="src_link" title="dev.pljson_util_pkg">dev.pljson_util_pkg</a></td><td class="red strong">0 %</td><td>322</td><td>322</td><td>0</td><td>322</td><td>0</td></tr>
<tr><td class="strong"><a href="#8ACD5C747FC1C87F2DF869260BB0A4BF" class="src_link" title="dev.pljson_value">dev.pljson_value</a></td><td class="red strong">25.37 %</td><td>306</td><td>134</td><td>34</td><td>100</td><td>3</td></tr>
<tr><td class="strong"><a href="#16AC19A4FA51C27269DDBE9AFA77761C" class="src_link" title="dev.pljson_xml">dev.pljson_xml</a></td><td class="red strong">0 %</td><td>115</td><td>115</td><td>0</td><td>115</td><td>0</td></tr></tbody></table></div>
</div><div id="footer">Generated by <a href="http://github.com/utPLSQL/utPLSQL">utPLSQL - Version v3.0.1.798</a><br/>Based on <a href="http://github.com/colszowka/simplecov-html">simplecov-html</a> v0.10.0 </div><div class="source_files"><div class="source_table" id="F13AF9CDA3CE83A2366705CF7B5CDA57"><div class="header"> <h3>DEV.NUM_GENERATOR</h3><h4><span class="red">0 %</span> covered</h4><div> <b>8</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>8</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">function num_generator(n in number default null) return num_array pipelined as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">begin</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  for i in 1 .. nvl(n, 999999999)</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  loop</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">    pipe row(i);</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  return;</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">end;</code></li></ol></pre></div><div class="source_table" id="11AA0058E23902394DB87854D7CC3DFA"><div class="header"> <h3>DEV.PLJSON</h3><h4><span class="red">4.4 %</span> covered</h4><div> <b>159</b> relevant lines. <span class="green"><b>7</b> lines covered</span> and <span class="red"><b>152</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">type body pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  /* Constructors */</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  constructor function pljson return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="19" data-linenumber="6">
              <span class="hits">19</span>
              <code class="sql">    self.json_data := pljson_value_array();</code></li>
            <li class="covered" data-hits="19" data-linenumber="7">
              <span class="hits">19</span>
              <code class="sql">    self.check_for_duplicate := 1;</code></li>
            <li class="covered" data-hits="19" data-linenumber="8">
              <span class="hits">19</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">  constructor function pljson(str varchar2) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="49" data-linenumber="13">
              <span class="hits">49</span>
              <code class="sql">    self := pljson_parser.parser(str);</code></li>
            <li class="covered" data-hits="18" data-linenumber="14">
              <span class="hits">18</span>
              <code class="sql">    self.check_for_duplicate := 1;</code></li>
            <li class="covered" data-hits="18" data-linenumber="15">
              <span class="hits">18</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  constructor function pljson(str in clob) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="20">
              <code class="sql">    self := pljson_parser.parser(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="21">
              <code class="sql">    self.check_for_duplicate := 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="22">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">  constructor function pljson(cast pljson_value) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">    x number;</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="28">
              <code class="sql">    x := cast.object_or_array.getobject(self);</code></li>
            <li class="missed" data-hits="0" data-linenumber="29">
              <code class="sql">    self.check_for_duplicate := 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="30">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">  constructor function pljson(l in out nocopy pljson_list) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="35">
              <code class="sql">    for i in 1 .. l.list_data.count loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="36">
              <code class="sql">      if(l.list_data(i).mapname is null or l.list_data(i).mapname like &apos;row%&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="37">
              <code class="sql">      l.list_data(i).mapname := &apos;row&apos;||i;</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="39">
              <code class="sql">      l.list_data(i).mapindx := i;</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="42">
              <code class="sql">    self.json_data := l.list_data;</code></li>
            <li class="missed" data-hits="0" data-linenumber="43">
              <code class="sql">    self.check_for_duplicate := 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="44">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">  /* Member setter methods */</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">  member procedure remove(self in out nocopy pljson, pair_name varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">    indx pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">    function get_member(pair_name varchar2) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">      indx pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">    begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="55">
              <code class="sql">      indx := json_data.first;</code></li>
            <li class="missed" data-hits="0" data-linenumber="56">
              <code class="sql">      loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="57">
              <code class="sql">        exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="58">
              <code class="sql">        if(pair_name is null and json_data(indx).mapname is null) then return json_data(indx); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="59">
              <code class="sql">        if(json_data(indx).mapname = pair_name) then return json_data(indx); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="60">
              <code class="sql">        indx := json_data.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">      end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="62">
              <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">    end;</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="65">
              <code class="sql">    temp := get_member(pair_name);</code></li>
            <li class="missed" data-hits="0" data-linenumber="66">
              <code class="sql">    if(temp is null) then return; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="68">
              <code class="sql">    indx := json_data.next(temp.mapindx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="69">
              <code class="sql">    loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="70">
              <code class="sql">      exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="71">
              <code class="sql">      json_data(indx).mapindx := indx - 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="72">
              <code class="sql">      json_data(indx-1) := json_data(indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="73">
              <code class="sql">      indx := json_data.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="75">
              <code class="sql">    json_data.trim(1);</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">    --num_elements := num_elements - 1;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value pljson_value, position pls_integer default null) as</code></li>
            <li class="missed" data-hits="0" data-linenumber="80">
              <code class="sql">    insert_value pljson_value := nvl(pair_value, pljson_value.makenull);</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">    indx pls_integer; x number;</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">    function get_member(pair_name varchar2) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">      indx pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">    begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="86">
              <code class="sql">      indx := json_data.first;</code></li>
            <li class="missed" data-hits="0" data-linenumber="87">
              <code class="sql">      loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="88">
              <code class="sql">        exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="89">
              <code class="sql">        if(pair_name is null and json_data(indx).mapname is null) then return json_data(indx); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="90">
              <code class="sql">        if(json_data(indx).mapname = pair_name) then return json_data(indx); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="91">
              <code class="sql">        indx := json_data.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">      end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="93">
              <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">    end;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">    --dbms_output.put_line(&apos;PN &apos;||pair_name);</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">--    if(pair_name is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">--      raise_application_error(-20102, &apos;JSON put-method type error: name cannot be null&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">--    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="101">
              <code class="sql">    insert_value.mapname := pair_name;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">--    self.remove(pair_name);</code></li>
            <li class="missed" data-hits="0" data-linenumber="103">
              <code class="sql">    if(self.check_for_duplicate = 1) then temp := get_member(pair_name); else temp := null; end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="104">
              <code class="sql">    if(temp is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="105">
              <code class="sql">      insert_value.mapindx := temp.mapindx;</code></li>
            <li class="missed" data-hits="0" data-linenumber="106">
              <code class="sql">      json_data(temp.mapindx) := insert_value;</code></li>
            <li class="missed" data-hits="0" data-linenumber="107">
              <code class="sql">      return;</code></li>
            <li class="missed" data-hits="0" data-linenumber="108">
              <code class="sql">    elsif(position is null or position &gt; self.count) then</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">      --insert at the end of the list</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">      --dbms_output.put_line(&apos;Test&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">--      indx := self.count + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="112">
              <code class="sql">      json_data.extend(1);</code></li>
            <li class="missed" data-hits="0" data-linenumber="113">
              <code class="sql">      json_data(json_data.count) := insert_value;</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">--      insert_value.mapindx := json_data.count;</code></li>
            <li class="missed" data-hits="0" data-linenumber="115">
              <code class="sql">      json_data(json_data.count).mapindx := json_data.count;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">--      dbms_output.put_line(&apos;Test2&apos;||insert_value.mapindx);</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">--      dbms_output.put_line(&apos;Test2&apos;||insert_value.mapname);</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">--      insert_value.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">--      self.print;</code></li>
            <li class="missed" data-hits="0" data-linenumber="120">
              <code class="sql">    elsif(position &lt; 2) then</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">      --insert at the start of the list</code></li>
            <li class="missed" data-hits="0" data-linenumber="122">
              <code class="sql">      indx := json_data.last;</code></li>
            <li class="missed" data-hits="0" data-linenumber="123">
              <code class="sql">      json_data.extend;</code></li>
            <li class="missed" data-hits="0" data-linenumber="124">
              <code class="sql">      loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="125">
              <code class="sql">        exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="126">
              <code class="sql">        temp := json_data(indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="127">
              <code class="sql">        temp.mapindx := indx+1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="128">
              <code class="sql">        json_data(temp.mapindx) := temp;</code></li>
            <li class="missed" data-hits="0" data-linenumber="129">
              <code class="sql">        indx := json_data.prior(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">      end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="131">
              <code class="sql">      json_data(1) := insert_value;</code></li>
            <li class="missed" data-hits="0" data-linenumber="132">
              <code class="sql">      insert_value.mapindx := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">      --insert somewhere in the list</code></li>
            <li class="missed" data-hits="0" data-linenumber="135">
              <code class="sql">      indx := json_data.last;</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">--      dbms_output.put_line(&apos;Test &apos;||indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="137">
              <code class="sql">      json_data.extend;</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">--      dbms_output.put_line(&apos;Test &apos;||indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="139">
              <code class="sql">      loop</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">--        dbms_output.put_line(&apos;Test &apos;||indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="141">
              <code class="sql">        temp := json_data(indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="142">
              <code class="sql">        temp.mapindx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="143">
              <code class="sql">        json_data(temp.mapindx) := temp;</code></li>
            <li class="missed" data-hits="0" data-linenumber="144">
              <code class="sql">        exit when indx = position;</code></li>
            <li class="missed" data-hits="0" data-linenumber="145">
              <code class="sql">        indx := json_data.prior(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">      end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="147">
              <code class="sql">      json_data(position) := insert_value;</code></li>
            <li class="missed" data-hits="0" data-linenumber="148">
              <code class="sql">      json_data(position).mapindx := position;</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">--    num_elements := num_elements + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value varchar2, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="155">
              <code class="sql">    put(pair_name, pljson_value(pair_value), position);</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value number, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="160">
              <code class="sql">    if(pair_value is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="161">
              <code class="sql">      put(pair_name, pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="163">
              <code class="sql">      put(pair_name, pljson_value(pair_value), position);</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value binary_double, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="170">
              <code class="sql">    if(pair_value is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="171">
              <code class="sql">      put(pair_name, pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="173">
              <code class="sql">      put(pair_name, pljson_value(pair_value), position);</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value boolean, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="179">
              <code class="sql">    if(pair_value is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="180">
              <code class="sql">      put(pair_name, pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="182">
              <code class="sql">      put(pair_name, pljson_value(pair_value), position);</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">  member procedure check_duplicate(self in out nocopy pljson, v_set boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="188">
              <code class="sql">    if(v_set) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="189">
              <code class="sql">      check_for_duplicate := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="191">
              <code class="sql">      check_for_duplicate := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">  /* deprecated putters */</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value pljson, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="199">
              <code class="sql">    if(pair_value is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="200">
              <code class="sql">      put(pair_name, pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="202">
              <code class="sql">      put(pair_name, pair_value.to_json_value, position);</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">  member procedure put(self in out nocopy pljson, pair_name varchar2, pair_value pljson_list, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="208">
              <code class="sql">    if(pair_value is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="209">
              <code class="sql">      put(pair_name, pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="211">
              <code class="sql">      put(pair_name, pair_value.to_json_value, position);</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">  /* Member getter methods */</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">  member function count return number as</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="218">
              <code class="sql">    return self.json_data.count;</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">  member function get(pair_name varchar2) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">    indx pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="224">
              <code class="sql">    indx := json_data.first;</code></li>
            <li class="missed" data-hits="0" data-linenumber="225">
              <code class="sql">    loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="226">
              <code class="sql">      exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="227">
              <code class="sql">      if(pair_name is null and json_data(indx).mapname is null) then return json_data(indx); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="228">
              <code class="sql">      if(json_data(indx).mapname = pair_name) then return json_data(indx); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="229">
              <code class="sql">      indx := json_data.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="231">
              <code class="sql">    return null;</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">  member function get(position pls_integer) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="236">
              <code class="sql">    if(self.count &gt;= position and position &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="237">
              <code class="sql">      return self.json_data(position);</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="239">
              <code class="sql">    return null; -- do not throw error, just return null</code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">  member function index_of(pair_name varchar2) return number as</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">    indx pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="245">
              <code class="sql">    indx := json_data.first;</code></li>
            <li class="missed" data-hits="0" data-linenumber="246">
              <code class="sql">    loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="247">
              <code class="sql">      exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="248">
              <code class="sql">      if(pair_name is null and json_data(indx).mapname is null) then return indx; end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="249">
              <code class="sql">      if(json_data(indx).mapname = pair_name) then return indx; end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="250">
              <code class="sql">      indx := json_data.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="252">
              <code class="sql">    return -1;</code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql">  member function exist(pair_name varchar2) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="257">
              <code class="sql">    return (self.get(pair_name) is not null);</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="259">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">  /* Output methods */</code></li>
            <li class="never" data-hits="" data-linenumber="261">
            <code class="sql">  member function to_char(spaces boolean default true, chars_per_line number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="263">
              <code class="sql">    if(spaces is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="264">
              <code class="sql">      return pljson_printer.pretty_print(self, line_length =&gt; chars_per_line);</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="266">
              <code class="sql">      return pljson_printer.pretty_print(self, spaces, line_length =&gt; chars_per_line);</code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="268">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="270">
            <code class="sql">  member procedure to_clob(self in pljson, buf in out nocopy clob, spaces boolean default false, chars_per_line number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="271">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="272">
              <code class="sql">    if(spaces is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="273">
              <code class="sql">      pljson_printer.pretty_print(self, false, buf, line_length =&gt; chars_per_line, erase_clob =&gt; erase_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="274">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="275">
              <code class="sql">      pljson_printer.pretty_print(self, spaces, buf, line_length =&gt; chars_per_line, erase_clob =&gt; erase_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="277">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="278">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="279">
            <code class="sql">  member procedure print(self in pljson, spaces boolean default true, chars_per_line number default 8192, jsonp varchar2 default null) as --32512 is the real maximum in sqldeveloper</code></li>
            <li class="never" data-hits="" data-linenumber="280">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="281">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="282">
              <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="283">
              <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="284">
              <code class="sql">    pljson_printer.pretty_print(self, spaces, my_clob, case when (chars_per_line&gt;32512) then 32512 else chars_per_line end);</code></li>
            <li class="missed" data-hits="0" data-linenumber="285">
              <code class="sql">    pljson_printer.dbms_output_clob(my_clob, pljson_printer.newline_char, jsonp);</code></li>
            <li class="missed" data-hits="0" data-linenumber="286">
              <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="287">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="288">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="289">
            <code class="sql">  member procedure htp(self in pljson, spaces boolean default false, chars_per_line number default 0, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="292">
              <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="293">
              <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="294">
              <code class="sql">    pljson_printer.pretty_print(self, spaces, my_clob, chars_per_line);</code></li>
            <li class="missed" data-hits="0" data-linenumber="295">
              <code class="sql">    pljson_printer.htp_output_clob(my_clob, jsonp);</code></li>
            <li class="missed" data-hits="0" data-linenumber="296">
              <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="297">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="299">
            <code class="sql">  member function to_json_value return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="300">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="301">
              <span class="hits">1</span>
              <code class="sql">    return pljson_value(sys.anydata.convertobject(self));</code></li>
            <li class="never" data-hits="" data-linenumber="302">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">  /* json path */</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql">  member function path(json_path varchar2, base number default 1) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="307">
              <code class="sql">    return pljson_ext.get_json_value(self, json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql">  end path;</code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">  /* json path_put */</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem pljson_value, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="313">
              <code class="sql">    pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="314">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="315">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="316">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="317">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="318">
              <code class="sql">    pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="319">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="320">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="321">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem number, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="322">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="323">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="324">
              <code class="sql">      pljson_ext.put(self, json_path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="325">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="326">
              <code class="sql">      pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="327">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="328">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="329">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="330">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="331">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem binary_double, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="332">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="333">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="334">
              <code class="sql">      pljson_ext.put(self, json_path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="335">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="336">
              <code class="sql">      pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="337">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="338">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="339">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="340">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem boolean, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="341">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="342">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="343">
              <code class="sql">      pljson_ext.put(self, json_path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="344">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="345">
              <code class="sql">      pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="346">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="347">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="348">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="349">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem pljson_list, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="350">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="351">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="352">
              <code class="sql">      pljson_ext.put(self, json_path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="353">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="354">
              <code class="sql">      pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="355">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="356">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="357">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="358">
            <code class="sql">  member procedure path_put(self in out nocopy pljson, json_path varchar2, elem pljson, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="359">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="360">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="361">
              <code class="sql">      pljson_ext.put(self, json_path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="362">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="363">
              <code class="sql">      pljson_ext.put(self, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="364">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="365">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="366">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="367">
            <code class="sql">  member procedure path_remove(self in out nocopy pljson, json_path varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="368">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="369">
              <code class="sql">    pljson_ext.remove(self, json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="370">
            <code class="sql">  end path_remove;</code></li>
            <li class="never" data-hits="" data-linenumber="371">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="372">
            <code class="sql">  /* Thanks to Matt Nolan */</code></li>
            <li class="never" data-hits="" data-linenumber="373">
            <code class="sql">  member function get_keys return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="374">
            <code class="sql">    keys pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="375">
            <code class="sql">    indx pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="376">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="377">
              <code class="sql">    keys := pljson_list();</code></li>
            <li class="missed" data-hits="0" data-linenumber="378">
              <code class="sql">    indx := json_data.first;</code></li>
            <li class="missed" data-hits="0" data-linenumber="379">
              <code class="sql">    loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="380">
              <code class="sql">      exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="381">
              <code class="sql">      keys.append(json_data(indx).mapname);</code></li>
            <li class="missed" data-hits="0" data-linenumber="382">
              <code class="sql">      indx := json_data.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="383">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="384">
              <code class="sql">    return keys;</code></li>
            <li class="never" data-hits="" data-linenumber="385">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="386">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="387">
            <code class="sql">  member function get_values return pljson_list as</code></li>
            <li class="missed" data-hits="0" data-linenumber="388">
              <code class="sql">    vals pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="389">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="390">
              <code class="sql">    vals.list_data := self.json_data;</code></li>
            <li class="missed" data-hits="0" data-linenumber="391">
              <code class="sql">    return vals;</code></li>
            <li class="never" data-hits="" data-linenumber="392">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="393">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="394">
            <code class="sql">  member procedure remove_duplicates(self in out nocopy pljson) as</code></li>
            <li class="never" data-hits="" data-linenumber="395">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="396">
              <code class="sql">    pljson_parser.remove_duplicates(self);</code></li>
            <li class="never" data-hits="" data-linenumber="397">
            <code class="sql">  end remove_duplicates;</code></li>
            <li class="never" data-hits="" data-linenumber="398">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="399">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="400">
            <code class="sql">end;</code></li></ol></pre></div><div class="source_table" id="FD68A3F7403B93E6B4416C8A6DCAA2E7"><div class="header"> <h3>DEV.PLJSON_AC</h3><h4><span class="red">0 %</span> covered</h4><div> <b>195</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>195</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_ac as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">  procedure object_remove(p_self in out nocopy pljson, pair_name varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  begin p_self.remove(pair_name); end;</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value pljson_value, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value varchar2, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value number, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value binary_double, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value boolean, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  procedure object_check_duplicate(p_self in out nocopy pljson, v_set boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  begin p_self.check_duplicate(v_set); end;</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  procedure object_remove_duplicates(p_self in out nocopy pljson) as</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  begin p_self.remove_duplicates; end;</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value pljson, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">  procedure object_put(p_self in out nocopy pljson, pair_name varchar2, pair_value pljson_list, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">  begin p_self.put(pair_name, pair_value, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">  function object_count(p_self in pljson) return number as</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">  begin return p_self.count; end;</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">  function object_get(p_self in pljson, pair_name varchar2) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">  begin return p_self.get(pair_name); end;</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  function object_get(p_self in pljson, position pls_integer) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">  begin return p_self.get(position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  function object_index_of(p_self in pljson, pair_name varchar2) return number as</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">  begin return p_self.index_of(pair_name); end;</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">  function object_exist(p_self in pljson, pair_name varchar2) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">  begin return p_self.exist(pair_name); end;</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">  function object_to_char(p_self in pljson, spaces boolean default true, chars_per_line number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">  begin return p_self.to_char(spaces, chars_per_line); end;</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  procedure object_to_clob(p_self in pljson, buf in out nocopy clob, spaces boolean default false, chars_per_line number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql">  begin p_self.to_clob(buf, spaces, chars_per_line, erase_clob); end;</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">  procedure object_print(p_self in pljson, spaces boolean default true, chars_per_line number default 8192, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">  begin p_self.print(spaces, chars_per_line, jsonp); end;</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">  procedure object_htp(p_self in pljson, spaces boolean default false, chars_per_line number default 0, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">  begin p_self.htp(spaces, chars_per_line, jsonp); end;</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">  function object_to_json_value(p_self in pljson) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">  begin return p_self.to_json_value; end;</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">  function object_path(p_self in pljson, json_path varchar2, base number default 1) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">  begin return p_self.path(json_path, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem pljson_value, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem varchar2  , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem number    , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem binary_double, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem boolean   , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem pljson_list , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">  procedure object_path_put(p_self in out nocopy pljson, json_path varchar2, elem pljson      , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">  procedure object_path_remove(p_self in out nocopy pljson, json_path varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">  begin p_self.path_remove(json_path, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">  function object_get_values(p_self in pljson) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">  begin return p_self.get_values; end;</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">  function object_get_keys(p_self in pljson) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">  begin return p_self.get_keys; end;</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">  --json_list type</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql">  procedure array_append(p_self in out nocopy pljson_list, elem pljson_value, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">  begin p_self.append(elem, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">  procedure array_append(p_self in out nocopy pljson_list, elem varchar2, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">  begin p_self.append(elem, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">  procedure array_append(p_self in out nocopy pljson_list, elem number, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">  begin p_self.append(elem, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">  procedure array_append(p_self in out nocopy pljson_list, elem binary_double, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">  begin p_self.append(elem, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">  procedure array_append(p_self in out nocopy pljson_list, elem boolean, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">  begin p_self.append(elem, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">  procedure array_append(p_self in out nocopy pljson_list, elem pljson_list, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">  begin p_self.append(elem, position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">  procedure array_replace(p_self in out nocopy pljson_list, position pls_integer, elem pljson_value) as</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">  begin p_self.replace(position, elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">  procedure array_replace(p_self in out nocopy pljson_list, position pls_integer, elem varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">  begin p_self.replace(position, elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">  procedure array_replace(p_self in out nocopy pljson_list, position pls_integer, elem number) as</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">  begin p_self.replace(position, elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">  procedure array_replace(p_self in out nocopy pljson_list, position pls_integer, elem binary_double) as</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">  begin p_self.replace(position, elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">  procedure array_replace(p_self in out nocopy pljson_list, position pls_integer, elem boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">  begin p_self.replace(position, elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">  procedure array_replace(p_self in out nocopy pljson_list, position pls_integer, elem pljson_list) as</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">  begin p_self.replace(position, elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">  function array_count(p_self in pljson_list) return number as</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">  begin return p_self.count; end;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">  procedure array_remove(p_self in out nocopy pljson_list, position pls_integer) as</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">  begin p_self.remove(position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">  procedure array_remove_first(p_self in out nocopy pljson_list) as</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">  begin p_self.remove_first; end;</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">  procedure array_remove_last(p_self in out nocopy pljson_list) as</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">  begin p_self.remove_last; end;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">  function array_get(p_self in pljson_list, position pls_integer) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">  begin return p_self.get(position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">  function array_head(p_self in pljson_list) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">  begin return p_self.head; end;</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">  function array_last(p_self in pljson_list) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">  begin return p_self.last; end;</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">  function array_tail(p_self in pljson_list) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">  begin return p_self.tail; end;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">  function array_to_char(p_self in pljson_list, spaces boolean default true, chars_per_line number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">  begin return p_self.to_char(spaces, chars_per_line); end;</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">  procedure array_to_clob(p_self in pljson_list, buf in out nocopy clob, spaces boolean default false, chars_per_line number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">  begin p_self.to_clob(buf, spaces, chars_per_line, erase_clob); end;</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">  procedure array_print(p_self in pljson_list, spaces boolean default true, chars_per_line number default 8192, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">  begin p_self.print(spaces, chars_per_line, jsonp); end;</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">  procedure array_htp(p_self in pljson_list, spaces boolean default false, chars_per_line number default 0, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">  begin p_self.htp(spaces, chars_per_line, jsonp); end;</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">  function array_path(p_self in pljson_list, json_path varchar2, base number default 1) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">  begin return p_self.path(json_path, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">  procedure array_path_put(p_self in out nocopy pljson_list, json_path varchar2, elem pljson_value, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">  procedure array_path_put(p_self in out nocopy pljson_list, json_path varchar2, elem varchar2  , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">  procedure array_path_put(p_self in out nocopy pljson_list, json_path varchar2, elem number    , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">  procedure array_path_put(p_self in out nocopy pljson_list, json_path varchar2, elem binary_double, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">  procedure array_path_put(p_self in out nocopy pljson_list, json_path varchar2, elem boolean   , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">  procedure array_path_put(p_self in out nocopy pljson_list, json_path varchar2, elem pljson_list , base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">  begin p_self.path_put(json_path, elem, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">  procedure array_path_remove(p_self in out nocopy pljson_list, json_path varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">  begin p_self.path_remove(json_path, base); end;</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">  function array_to_json_value(p_self in pljson_list) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">  begin return p_self.to_json_value; end;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">  --json_value</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">  function jv_get_type(p_self in pljson_value) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">  begin return p_self.get_type; end;</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">  function jv_get_string(p_self in pljson_value, max_byte_size number default null, max_char_size number default null) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">  begin return p_self.get_string(max_byte_size, max_char_size); end;</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">  procedure jv_get_string(p_self in pljson_value, buf in out nocopy clob) as</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">  begin p_self.get_string(buf); end;</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">  function jv_get_number(p_self in pljson_value) return number as</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">  begin return p_self.get_number; end;</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">  function jv_get_double(p_self in pljson_value) return binary_double as</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">  begin return p_self.get_double; end;</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">  function jv_get_bool(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">  begin return p_self.get_bool; end;</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">  function jv_get_null(p_self in pljson_value) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">  begin return p_self.get_null; end;</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">  function jv_is_object(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">  begin return p_self.is_object; end;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">  function jv_is_array(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">  begin return p_self.is_array; end;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">  function jv_is_string(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">  begin return p_self.is_string; end;</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">  function jv_is_number(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">  begin return p_self.is_number; end;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">  function jv_is_bool(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">  begin return p_self.is_bool; end;</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">  function jv_is_null(p_self in pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">  begin return p_self.is_null; end;</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">  function jv_to_char(p_self in pljson_value, spaces boolean default true, chars_per_line number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">  begin return p_self.to_char(spaces, chars_per_line); end;</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">  procedure jv_to_clob(p_self in pljson_value, buf in out nocopy clob, spaces boolean default false, chars_per_line number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">  begin p_self.to_clob(buf, spaces, chars_per_line, erase_clob); end;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">  procedure jv_print(p_self in pljson_value, spaces boolean default true, chars_per_line number default 8192, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">  begin p_self.print(spaces, chars_per_line, jsonp); end;</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">  procedure jv_htp(p_self in pljson_value, spaces boolean default false, chars_per_line number default 0, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">  begin p_self.htp(spaces, chars_per_line, jsonp); end;</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">  function jv_value_of(p_self in pljson_value, max_byte_size number default null, max_char_size number default null) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">  begin return p_self.value_of(max_byte_size, max_char_size); end;</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">end pljson_ac;</code></li></ol></pre></div><div class="source_table" id="0EAA32B6814598F107ACC33C126C8363"><div class="header"> <h3>DEV.PLJSON_DYN</h3><h4><span class="red">0 %</span> covered</h4><div> <b>245</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>245</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_dyn as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">/*</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  -- 11gR2</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  function executeList(stmt in out sys_refcursor) return json_list as</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">    l_cur number;</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">    l_cur := dbms_sql.to_cursor_number(stmt);</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">    return json_dyn.executeList(null, null, l_cur);</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">  -- 11gR2</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">  function executeObject(stmt in out sys_refcursor) return json as</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">    l_cur number;</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">    l_cur := dbms_sql.to_cursor_number(stmt);</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">    return json_dyn.executeObject(null, null, l_cur);</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">*/</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">  procedure bind_json(l_cur number, bindvar pljson) as</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">    keylist pljson_list := bindvar.get_keys();</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">    for i in 1 .. keylist.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">      if(bindvar.get(i).get_type = &apos;number&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">        dbms_sql.bind_variable(l_cur, &apos;:&apos;||keylist.get(i).get_string, bindvar.get(i).get_number);</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">      elsif(bindvar.get(i).get_type = &apos;array&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">        declare</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">          v_bind dbms_sql.varchar2_table;</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">          v_arr  pljson_list := pljson_list(bindvar.get(i));</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">        begin</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">          for j in 1 .. v_arr.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">            v_bind(j) := v_arr.get(j).value_of;</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">          dbms_sql.bind_array(l_cur, &apos;:&apos;||keylist.get(i).get_string, v_bind);</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql">        end;</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">        dbms_sql.bind_variable(l_cur, &apos;:&apos;||keylist.get(i).get_string, bindvar.get(i).value_of());</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">  end bind_json;</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">  /* list with objects */</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">  function executeList(stmt varchar2, bindvar pljson, cur_num number) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">    l_cur number;</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">    l_dtbl dbms_sql.desc_tab2;</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">    l_cnt number;</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">    l_status number;</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">    l_val varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">    outer_list pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">    inner_obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">    conv number;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">    read_date date;</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">    read_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">    read_blob blob;</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">    col_type number;</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">    if(cur_num is not null) then</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">      l_cur := cur_num;</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">      l_cur := dbms_sql.open_cursor;</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">      dbms_sql.parse(l_cur, stmt, dbms_sql.native);</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">      if(bindvar is not null) then bind_json(l_cur, bindvar); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">    dbms_sql.describe_columns2(l_cur, l_cnt, l_dtbl);</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">    for i in 1..l_cnt loop</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">      col_type := l_dtbl(i).col_type;</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">      --dbms_output.put_line(col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">      if(col_type = 12) then</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">        dbms_sql.define_column(l_cur,i,read_date);</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">      elsif(col_type = 112) then</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">        dbms_sql.define_column(l_cur,i,read_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">      elsif(col_type = 113) then</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">        dbms_sql.define_column(l_cur,i,read_blob);</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">      elsif(col_type in (1,2,96)) then</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql">        dbms_sql.define_column(l_cur,i,l_val,4000);</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">    if(cur_num is null) then l_status := dbms_sql.execute(l_cur); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">    --loop through rows</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">    while ( dbms_sql.fetch_rows(l_cur) &gt; 0 ) loop</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">      inner_obj := pljson(); --init for each row</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">      --loop through columns</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">      for i in 1..l_cnt loop</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">        case true</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">        --handling string types</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">        when l_dtbl(i).col_type in (1,96) then -- varchar2</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">          dbms_sql.column_value(l_cur,i,l_val);</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">          if(l_val is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">            if(null_as_empty_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">              inner_obj.put(l_dtbl(i).col_name, &apos;&apos;); --treatet as emptystring?</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">            else</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">              inner_obj.put(l_dtbl(i).col_name, pljson_value.makenull); --null</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">            inner_obj.put(l_dtbl(i).col_name, pljson_value(l_val)); --null</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">          --dbms_output.put_line(l_dtbl(i).col_name||&apos; --&gt; &apos;||l_val||&apos;varchar2&apos; ||l_dtbl(i).col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">        --handling number types</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">        when l_dtbl(i).col_type = 2 then -- number</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">          dbms_sql.column_value(l_cur,i,l_val);</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">          conv := l_val;</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">          inner_obj.put(l_dtbl(i).col_name, conv);</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">          -- dbms_output.put_line(l_dtbl(i).col_name||&apos; --&gt; &apos;||l_val||&apos;number &apos; ||l_dtbl(i).col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">        when l_dtbl(i).col_type = 12 then -- date</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">          if(include_dates) then</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">            dbms_sql.column_value(l_cur,i,read_date);</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">            inner_obj.put(l_dtbl(i).col_name, pljson_ext.to_json_value(read_date));</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">          --dbms_output.put_line(l_dtbl(i).col_name||&apos; --&gt; &apos;||l_val||&apos;date &apos; ||l_dtbl(i).col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">        when l_dtbl(i).col_type = 112 then --clob</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">          if(include_clobs) then</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">            dbms_sql.column_value(l_cur,i,read_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">            inner_obj.put(l_dtbl(i).col_name, pljson_value(read_clob));</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">        when l_dtbl(i).col_type = 113 then --blob</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">          if(include_blobs) then</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">            dbms_sql.column_value(l_cur,i,read_blob);</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">            if(dbms_lob.getlength(read_blob) &gt; 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">              inner_obj.put(l_dtbl(i).col_name, pljson_ext.encode(read_blob));</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">            else</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">              inner_obj.put(l_dtbl(i).col_name, pljson_value.makenull);</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">        else null; --discard other types</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">        end case;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">      outer_list.append(inner_obj.to_json_value);</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">    dbms_sql.close_cursor(l_cur);</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">    return outer_list;</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">  end executeList;</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">  /* object with lists */</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">  function executeObject(stmt varchar2, bindvar pljson, cur_num number) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">    l_cur number;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">    l_dtbl dbms_sql.desc_tab;</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">    l_cnt number;</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">    l_status number;</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">    l_val varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">    inner_list_names pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql">    inner_list_data pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">    data_list pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">    outer_obj pljson := pljson();</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">    conv number;</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">    read_date date;</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">    read_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">    read_blob blob;</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">    col_type number;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">    if(cur_num is not null) then</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">      l_cur := cur_num;</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">      l_cur := dbms_sql.open_cursor;</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">      dbms_sql.parse(l_cur, stmt, dbms_sql.native);</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">      if(bindvar is not null) then bind_json(l_cur, bindvar); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">    dbms_sql.describe_columns(l_cur, l_cnt, l_dtbl);</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">    for i in 1..l_cnt loop</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">      col_type := l_dtbl(i).col_type;</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">      if(col_type = 12) then</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">        dbms_sql.define_column(l_cur,i,read_date);</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">      elsif(col_type = 112) then</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">        dbms_sql.define_column(l_cur,i,read_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">      elsif(col_type = 113) then</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">        dbms_sql.define_column(l_cur,i,read_blob);</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">      elsif(col_type in (1,2,96)) then</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">        dbms_sql.define_column(l_cur,i,l_val,4000);</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">    if(cur_num is null) then l_status := dbms_sql.execute(l_cur); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">    --build up name_list</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">    for i in 1..l_cnt loop</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">      case l_dtbl(i).col_type</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">        when 1 then inner_list_names.append(l_dtbl(i).col_name);</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">        when 96 then inner_list_names.append(l_dtbl(i).col_name);</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">        when 2 then inner_list_names.append(l_dtbl(i).col_name);</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">        when 12 then if(include_dates) then inner_list_names.append(l_dtbl(i).col_name); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">        when 112 then if(include_clobs) then inner_list_names.append(l_dtbl(i).col_name); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">        when 113 then if(include_blobs) then inner_list_names.append(l_dtbl(i).col_name); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">        else null;</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">    --loop through rows</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">    while ( dbms_sql.fetch_rows(l_cur) &gt; 0 ) loop</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">      data_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">      --loop through columns</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">      for i in 1..l_cnt loop</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">        case true</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">        --handling string types</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">        when l_dtbl(i).col_type in (1,96) then -- varchar2</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">          dbms_sql.column_value(l_cur,i,l_val);</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">          if(l_val is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">            if(null_as_empty_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">              data_list.append(&apos;&apos;); --treatet as emptystring?</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">            else</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">              data_list.append(pljson_value.makenull); --null</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">            data_list.append(pljson_value(l_val)); --null</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">          --dbms_output.put_line(l_dtbl(i).col_name||&apos; --&gt; &apos;||l_val||&apos;varchar2&apos; ||l_dtbl(i).col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">        --handling number types</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">        when l_dtbl(i).col_type = 2 then -- number</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">          dbms_sql.column_value(l_cur,i,l_val);</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">          conv := l_val;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">          data_list.append(conv);</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">          -- dbms_output.put_line(l_dtbl(i).col_name||&apos; --&gt; &apos;||l_val||&apos;number &apos; ||l_dtbl(i).col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">        when l_dtbl(i).col_type = 12 then -- date</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">          if(include_dates) then</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">            dbms_sql.column_value(l_cur,i,read_date);</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">            data_list.append(pljson_ext.to_json_value(read_date));</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">          --dbms_output.put_line(l_dtbl(i).col_name||&apos; --&gt; &apos;||l_val||&apos;date &apos; ||l_dtbl(i).col_type);</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">        when l_dtbl(i).col_type = 112 then --clob</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">          if(include_clobs) then</code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">            dbms_sql.column_value(l_cur,i,read_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">            data_list.append(pljson_value(read_clob));</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">        when l_dtbl(i).col_type = 113 then --blob</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">          if(include_blobs) then</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">            dbms_sql.column_value(l_cur,i,read_blob);</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql">            if(dbms_lob.getlength(read_blob) &gt; 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">              data_list.append(pljson_ext.encode(read_blob));</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">            else</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql">              data_list.append(pljson_value.makenull);</code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql">        else null; --discard other types</code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">        end case;</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql">      inner_list_data.append(data_list);</code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql">    outer_obj.put(&apos;names&apos;, inner_list_names.to_json_value);</code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">    outer_obj.put(&apos;data&apos;, inner_list_data.to_json_value);</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql">    dbms_sql.close_cursor(l_cur);</code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">    return outer_obj;</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">  end executeObject;</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">end pljson_dyn;</code></li></ol></pre></div><div class="source_table" id="4014B2709ABFD413F402713A6480B163"><div class="header"> <h3>DEV.PLJSON_EXT</h3><h4><span class="red">0 %</span> covered</h4><div> <b>797</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>797</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_ext as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">  scanner_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  pragma exception_init(scanner_exception, -20100);</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  parser_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  pragma exception_init(parser_exception, -20101);</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  jext_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  pragma exception_init(jext_exception, -20110);</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  --extra function checks if number has no fraction</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">  function is_integer(v pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">    num number;</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">    num_double binary_double;</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">    int_number number(38); --the oracle way to specify an integer</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">    int_double binary_double; --the oracle way to specify an integer</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">    /*</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">    if(v.is_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">      myint := v.get_number;</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">      return (myint = v.get_number); --no rounding errors?</code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">    */</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">    /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">    if (v.is_number_repr_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">      num := v.get_number;</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">      int_number := trunc(num);</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">      --dbms_output.put_line(&apos;number: &apos; || num || &apos; -&gt; &apos; || int_number);</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">      return (int_number = num); --no rounding errors?</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">    elsif (v.is_number_repr_double) then</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">      num_double := v.get_double;</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">      int_double := trunc(num_double);</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">      --dbms_output.put_line(&apos;double: &apos; || num_double || &apos; -&gt; &apos; || int_double);</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">      return (int_double = num_double); --no rounding errors?</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">  --extension enables json to store dates without comprimising the implementation</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">  function to_json_value(d date) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">    return pljson_value(to_char(d, format_string));</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">  --notice that a date type in json is also a varchar2</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">  function is_date(v pljson_value) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">    temp date;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">    temp := pljson_ext.to_date(v);</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">    return true;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">  exception</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">    when others then</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">  --conversion is needed to extract dates</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  function to_date(v pljson_value) return date as</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">    if(v.is_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">      return standard.to_date(v.get_string, format_string);</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">      raise_application_error(-20110, &apos;Anydata did not contain a date-value&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">  exception</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">    when others then</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">      raise_application_error(-20110, &apos;Anydata did not contain a date on the format: &apos;||format_string);</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">  -- alias so that old code doesn&apos;t break</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">  function to_date2(v pljson_value) return date as</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">    return to_date(v);</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">  --Json Path parser</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">  function parsePath(json_path varchar2, base number default 1) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">    build_path varchar2(32767) := &apos;[&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">    buf varchar2(4);</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">    endstring varchar2(1);</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">    indx number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">    ret pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">    procedure next_char as</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">    begin</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">      if(indx &lt;= length(json_path)) then</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">        buf := substr(json_path, indx, 1);</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">        indx := indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">        buf := null;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">    end;</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">    --skip ws</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">    procedure skipws as begin while(buf in (chr(9),chr(10),chr(13),&apos; &apos;)) loop next_char; end loop; end;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">    next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">    while(buf is not null) loop</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">      if(buf = &apos;.&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">        next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">        if(buf is null) then raise_application_error(-20110, &apos;JSON Path parse error: . is not a valid json_path end&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">        if(not regexp_like(buf, &apos;^[[:alnum:]\_ ]+&apos;, &apos;c&apos;) ) then</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">          raise_application_error(-20110, &apos;JSON Path parse error: alpha-numeric character or space expected at position &apos;||indx);</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">        if(build_path != &apos;[&apos;) then build_path := build_path || &apos;,&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">        build_path := build_path || &apos;&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">        while(regexp_like(buf, &apos;^[[:alnum:]\_ ]+&apos;, &apos;c&apos;) ) loop</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">          build_path := build_path || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">          next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">        build_path := build_path || &apos;&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">      elsif(buf = &apos;[&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">        next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">        skipws();</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">        if(buf is null) then raise_application_error(-20110, &apos;JSON Path parse error: [ is not a valid json_path end&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">        if(buf in (&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;) or (buf = &apos;0&apos; and base = 0)) then</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">          if(build_path != &apos;[&apos;) then build_path := build_path || &apos;,&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">          while(buf in (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;)) loop</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">            build_path := build_path || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">            next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">        elsif (regexp_like(buf, &apos;^(\&quot;|\&apos;&apos;)&apos;, &apos;c&apos;)) then</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">          endstring := buf;</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">          if(build_path != &apos;[&apos;) then build_path := build_path || &apos;,&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">          build_path := build_path || &apos;&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">          next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">          if(buf is null) then raise_application_error(-20110, &apos;JSON Path parse error: premature json_path end&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">          while(buf != endstring) loop</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">            build_path := build_path || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">            next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">            if(buf is null) then raise_application_error(-20110, &apos;JSON Path parse error: premature json_path end&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">            if(buf = &apos;\&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">              next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">              build_path := build_path || &apos;\&apos; || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">              next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">          build_path := build_path || &apos;&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">          next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">          raise_application_error(-20110, &apos;JSON Path parse error: expected a string or an positive integer at &apos;||indx);</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql">        skipws();</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">        if(buf is null) then raise_application_error(-20110, &apos;JSON Path parse error: premature json_path end&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">        if(buf != &apos;]&apos;) then raise_application_error(-20110, &apos;JSON Path parse error: no array ending found. found: &apos;|| buf); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">        next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">        skipws();</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">      elsif(build_path = &apos;[&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">        if(not regexp_like(buf, &apos;^[[:alnum:]\_ ]+&apos;, &apos;c&apos;) ) then</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">          raise_application_error(-20110, &apos;JSON Path parse error: alpha-numeric character or space expected at position &apos;||indx);</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">        build_path := build_path || &apos;&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">        while(regexp_like(buf, &apos;^[[:alnum:]\_ ]+&apos;, &apos;c&apos;) ) loop</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">          build_path := build_path || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">          next_char();</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">        build_path := build_path || &apos;&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">        raise_application_error(-20110, &apos;JSON Path parse error: expected . or [ found &apos;|| buf || &apos; at position &apos;|| indx);</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">    build_path := build_path || &apos;]&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">    build_path := replace(replace(replace(replace(replace(build_path, chr(9), &apos;\t&apos;), chr(10), &apos;\n&apos;), chr(13), &apos;\f&apos;), chr(8), &apos;\b&apos;), chr(14), &apos;\r&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">    ret := pljson_list(build_path);</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">    if(base != 1) then</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">      --fix base 0 to base 1</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">      declare</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">        elem pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">      begin</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">        for i in 1 .. ret.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">          elem := ret.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">          if(elem.is_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">            ret.replace(i,elem.get_number()+1);</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">      end;</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">    return ret;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">  end parsePath;</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">  --JSON Path getters</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">  function get_json_value(obj pljson, v_path varchar2, base number default 1) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">    path pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">    ret pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">    o pljson; l pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">    path := parsePath(v_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">    ret := obj.to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">    if(path.count = 0) then return ret; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">    for i in 1 .. path.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">      if(path.get(i).is_string()) then</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">        --string fetch only on json</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">        o := pljson(ret);</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">        ret := o.get(path.get(i).get_string());</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">        --number fetch on json and json_list</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">        if(ret.is_array()) then</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">          l := pljson_list(ret);</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">          ret := l.get(path.get(i).get_number());</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">          o := pljson(ret);</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">          l := o.get_values();</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">          ret := l.get(path.get(i).get_number());</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">    return ret;</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">  exception</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">    when scanner_exception then raise;</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">    when parser_exception then raise;</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">    when jext_exception then raise;</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">    when others then return null;</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">  end get_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">  --JSON Path getters</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">  function get_string(obj pljson, path varchar2, base number default 1) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">    if(temp is null or not temp.is_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">      return temp.get_string;</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql">  function get_number(obj pljson, path varchar2, base number default 1) return number as</code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">    if(temp is null or not temp.is_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">      return temp.get_number;</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">  function get_double(obj pljson, path varchar2, base number default 1) return binary_double as</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql">    if(temp is null or not temp.is_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="252">
            <code class="sql">      return temp.get_double;</code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql">  function get_json(obj pljson, path varchar2, base number default 1) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="259">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">    if(temp is null or not temp.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="261">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql">      return pljson(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql">  function get_json_list(obj pljson, path varchar2, base number default 1) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="268">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="270">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="271">
            <code class="sql">    if(temp is null or not temp.is_array) then</code></li>
            <li class="never" data-hits="" data-linenumber="272">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="273">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="274">
            <code class="sql">      return pljson_list(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="275">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="277">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="278">
            <code class="sql">  function get_bool(obj pljson, path varchar2, base number default 1) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="279">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="280">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="281">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">    if(temp is null or not temp.is_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="283">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="284">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">      return temp.get_bool;</code></li>
            <li class="never" data-hits="" data-linenumber="286">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="287">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="288">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="289">
            <code class="sql">  function get_date(obj pljson, path varchar2, base number default 1) return date as</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">    temp pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="292">
            <code class="sql">    temp := get_json_value(obj, path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="293">
            <code class="sql">    if(temp is null or not is_date(temp)) then</code></li>
            <li class="never" data-hits="" data-linenumber="294">
            <code class="sql">      return null;</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="296">
            <code class="sql">      return pljson_ext.to_date(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="297">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="299">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="300">
            <code class="sql">  /* JSON Path putter internal function */</code></li>
            <li class="never" data-hits="" data-linenumber="301">
            <code class="sql">  procedure put_internal(obj in out nocopy pljson, v_path varchar2, elem pljson_value, base number) as</code></li>
            <li class="never" data-hits="" data-linenumber="302">
            <code class="sql">    val pljson_value := elem;</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql">    path pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">    backreference pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql">    keyval pljson_value; keynum number; keystring varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="307">
            <code class="sql">    temp pljson_value := obj.to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql">    obj_temp  pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql">    list_temp pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">    inserter pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">    path := pljson_ext.parsePath(v_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="313">
            <code class="sql">    if(path.count = 0) then raise_application_error(-20110, &apos;PLJSON_EXT put error: cannot put with empty string.&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="314">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="315">
            <code class="sql">    --build backreference</code></li>
            <li class="never" data-hits="" data-linenumber="316">
            <code class="sql">    for i in 1 .. path.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="317">
            <code class="sql">      --backreference.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="318">
            <code class="sql">      keyval := path.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="319">
            <code class="sql">      if (keyval.is_number()) then</code></li>
            <li class="never" data-hits="" data-linenumber="320">
            <code class="sql">        --number index</code></li>
            <li class="never" data-hits="" data-linenumber="321">
            <code class="sql">        keynum := keyval.get_number();</code></li>
            <li class="never" data-hits="" data-linenumber="322">
            <code class="sql">        if((not temp.is_object()) and (not temp.is_array())) then</code></li>
            <li class="never" data-hits="" data-linenumber="323">
            <code class="sql">          if(val is null) then return; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="324">
            <code class="sql">          backreference.remove_last;</code></li>
            <li class="never" data-hits="" data-linenumber="325">
            <code class="sql">          temp := pljson_list().to_json_value();</code></li>
            <li class="never" data-hits="" data-linenumber="326">
            <code class="sql">          backreference.append(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="327">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="328">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="329">
            <code class="sql">        if(temp.is_object()) then</code></li>
            <li class="never" data-hits="" data-linenumber="330">
            <code class="sql">          obj_temp := pljson(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="331">
            <code class="sql">          if(obj_temp.count &lt; keynum) then</code></li>
            <li class="never" data-hits="" data-linenumber="332">
            <code class="sql">            if(val is null) then return; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="333">
            <code class="sql">            raise_application_error(-20110, &apos;PLJSON_EXT put error: access object with to few members.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="334">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="335">
            <code class="sql">          temp := obj_temp.get(keynum);</code></li>
            <li class="never" data-hits="" data-linenumber="336">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="337">
            <code class="sql">          list_temp := pljson_list(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="338">
            <code class="sql">          if(list_temp.count &lt; keynum) then</code></li>
            <li class="never" data-hits="" data-linenumber="339">
            <code class="sql">            if(val is null) then return; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="340">
            <code class="sql">            --raise error or quit if val is null</code></li>
            <li class="never" data-hits="" data-linenumber="341">
            <code class="sql">            for i in list_temp.count+1 .. keynum loop</code></li>
            <li class="never" data-hits="" data-linenumber="342">
            <code class="sql">              list_temp.append(pljson_value.makenull);</code></li>
            <li class="never" data-hits="" data-linenumber="343">
            <code class="sql">            end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="344">
            <code class="sql">            backreference.remove_last;</code></li>
            <li class="never" data-hits="" data-linenumber="345">
            <code class="sql">            backreference.append(list_temp);</code></li>
            <li class="never" data-hits="" data-linenumber="346">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="347">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="348">
            <code class="sql">          temp := list_temp.get(keynum);</code></li>
            <li class="never" data-hits="" data-linenumber="349">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="350">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="351">
            <code class="sql">        --string index</code></li>
            <li class="never" data-hits="" data-linenumber="352">
            <code class="sql">        keystring := keyval.get_string();</code></li>
            <li class="never" data-hits="" data-linenumber="353">
            <code class="sql">        if(not temp.is_object()) then</code></li>
            <li class="never" data-hits="" data-linenumber="354">
            <code class="sql">          --backreference.print;</code></li>
            <li class="never" data-hits="" data-linenumber="355">
            <code class="sql">          if(val is null) then return; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="356">
            <code class="sql">          backreference.remove_last;</code></li>
            <li class="never" data-hits="" data-linenumber="357">
            <code class="sql">          temp := pljson().to_json_value();</code></li>
            <li class="never" data-hits="" data-linenumber="358">
            <code class="sql">          backreference.append(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="359">
            <code class="sql">          --raise_application_error(-20110, &apos;PLJSON_EXT put error: trying to access a non object with a string.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="360">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="361">
            <code class="sql">        obj_temp := pljson(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="362">
            <code class="sql">        temp := obj_temp.get(keystring);</code></li>
            <li class="never" data-hits="" data-linenumber="363">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="364">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="365">
            <code class="sql">      if(temp is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="366">
            <code class="sql">        if(val is null) then return; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="367">
            <code class="sql">        --what to expect?</code></li>
            <li class="never" data-hits="" data-linenumber="368">
            <code class="sql">        keyval := path.get(i+1);</code></li>
            <li class="never" data-hits="" data-linenumber="369">
            <code class="sql">        if(keyval is not null and keyval.is_number()) then</code></li>
            <li class="never" data-hits="" data-linenumber="370">
            <code class="sql">          temp := pljson_list().to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="371">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="372">
            <code class="sql">          temp := pljson().to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="373">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="374">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="375">
            <code class="sql">      backreference.append(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="376">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="377">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="378">
            <code class="sql">    --  backreference.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="379">
            <code class="sql">    --  path.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="380">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="381">
            <code class="sql">    --use backreference and path together</code></li>
            <li class="never" data-hits="" data-linenumber="382">
            <code class="sql">    inserter := val;</code></li>
            <li class="never" data-hits="" data-linenumber="383">
            <code class="sql">    for i in reverse 1 .. backreference.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="384">
            <code class="sql">      --inserter.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="385">
            <code class="sql">      if( i = 1 ) then</code></li>
            <li class="never" data-hits="" data-linenumber="386">
            <code class="sql">        keyval := path.get(1);</code></li>
            <li class="never" data-hits="" data-linenumber="387">
            <code class="sql">        if(keyval.is_string()) then</code></li>
            <li class="never" data-hits="" data-linenumber="388">
            <code class="sql">          keystring := keyval.get_string();</code></li>
            <li class="never" data-hits="" data-linenumber="389">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="390">
            <code class="sql">          keynum := keyval.get_number();</code></li>
            <li class="never" data-hits="" data-linenumber="391">
            <code class="sql">          declare</code></li>
            <li class="never" data-hits="" data-linenumber="392">
            <code class="sql">            t1 pljson_value := obj.get(keynum);</code></li>
            <li class="never" data-hits="" data-linenumber="393">
            <code class="sql">          begin</code></li>
            <li class="never" data-hits="" data-linenumber="394">
            <code class="sql">            keystring := t1.mapname;</code></li>
            <li class="never" data-hits="" data-linenumber="395">
            <code class="sql">          end;</code></li>
            <li class="never" data-hits="" data-linenumber="396">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="397">
            <code class="sql">        if(inserter is null) then obj.remove(keystring); else obj.put(keystring, inserter); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="398">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="399">
            <code class="sql">        temp := backreference.get(i-1);</code></li>
            <li class="never" data-hits="" data-linenumber="400">
            <code class="sql">        if(temp.is_object()) then</code></li>
            <li class="never" data-hits="" data-linenumber="401">
            <code class="sql">          keyval := path.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="402">
            <code class="sql">          obj_temp := pljson(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="403">
            <code class="sql">          if(keyval.is_string()) then</code></li>
            <li class="never" data-hits="" data-linenumber="404">
            <code class="sql">            keystring := keyval.get_string();</code></li>
            <li class="never" data-hits="" data-linenumber="405">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="406">
            <code class="sql">            keynum := keyval.get_number();</code></li>
            <li class="never" data-hits="" data-linenumber="407">
            <code class="sql">            declare</code></li>
            <li class="never" data-hits="" data-linenumber="408">
            <code class="sql">              t1 pljson_value := obj_temp.get(keynum);</code></li>
            <li class="never" data-hits="" data-linenumber="409">
            <code class="sql">            begin</code></li>
            <li class="never" data-hits="" data-linenumber="410">
            <code class="sql">              keystring := t1.mapname;</code></li>
            <li class="never" data-hits="" data-linenumber="411">
            <code class="sql">            end;</code></li>
            <li class="never" data-hits="" data-linenumber="412">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="413">
            <code class="sql">          if(inserter is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="414">
            <code class="sql">            obj_temp.remove(keystring);</code></li>
            <li class="never" data-hits="" data-linenumber="415">
            <code class="sql">            if(obj_temp.count &gt; 0) then inserter := obj_temp.to_json_value; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="416">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="417">
            <code class="sql">            obj_temp.put(keystring, inserter);</code></li>
            <li class="never" data-hits="" data-linenumber="418">
            <code class="sql">            inserter := obj_temp.to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="419">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="420">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="421">
            <code class="sql">          --array only number</code></li>
            <li class="never" data-hits="" data-linenumber="422">
            <code class="sql">          keynum := path.get(i).get_number();</code></li>
            <li class="never" data-hits="" data-linenumber="423">
            <code class="sql">          list_temp := pljson_list(temp);</code></li>
            <li class="never" data-hits="" data-linenumber="424">
            <code class="sql">          list_temp.remove(keynum);</code></li>
            <li class="never" data-hits="" data-linenumber="425">
            <code class="sql">          if(not inserter is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="426">
            <code class="sql">            list_temp.append(inserter, keynum);</code></li>
            <li class="never" data-hits="" data-linenumber="427">
            <code class="sql">            inserter := list_temp.to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="428">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="429">
            <code class="sql">            if(list_temp.count &gt; 0) then inserter := list_temp.to_json_value; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="430">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="431">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="432">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="433">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="434">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="435">
            <code class="sql">  end put_internal;</code></li>
            <li class="never" data-hits="" data-linenumber="436">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="437">
            <code class="sql">  /* JSON Path putters */</code></li>
            <li class="never" data-hits="" data-linenumber="438">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="439">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="440">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="441">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="442">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="443">
            <code class="sql">        put_internal(obj, path, pljson_value(elem), base);</code></li>
            <li class="never" data-hits="" data-linenumber="444">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="445">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="446">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="447">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem number, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="448">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="449">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="450">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="451">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="452">
            <code class="sql">        put_internal(obj, path, pljson_value(elem), base);</code></li>
            <li class="never" data-hits="" data-linenumber="453">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="454">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="455">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="456">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="457">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem binary_double, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="458">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="459">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="460">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="461">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="462">
            <code class="sql">        put_internal(obj, path, pljson_value(elem), base);</code></li>
            <li class="never" data-hits="" data-linenumber="463">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="464">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="465">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="466">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem pljson, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="467">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="468">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="469">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="470">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="471">
            <code class="sql">        put_internal(obj, path, elem.to_json_value, base);</code></li>
            <li class="never" data-hits="" data-linenumber="472">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="473">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="474">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="475">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem pljson_list, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="476">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="477">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="478">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="479">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="480">
            <code class="sql">        put_internal(obj, path, elem.to_json_value, base);</code></li>
            <li class="never" data-hits="" data-linenumber="481">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="482">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="483">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="484">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem boolean, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="485">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="486">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="487">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="488">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="489">
            <code class="sql">        put_internal(obj, path, pljson_value(elem), base);</code></li>
            <li class="never" data-hits="" data-linenumber="490">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="491">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="492">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="493">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem pljson_value, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="494">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="495">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="496">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="497">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="498">
            <code class="sql">        put_internal(obj, path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="499">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="500">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="501">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="502">
            <code class="sql">  procedure put(obj in out nocopy pljson, path varchar2, elem date, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="503">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="504">
            <code class="sql">    if elem is null then</code></li>
            <li class="never" data-hits="" data-linenumber="505">
            <code class="sql">        put_internal(obj, path, pljson_value(), base);</code></li>
            <li class="never" data-hits="" data-linenumber="506">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="507">
            <code class="sql">        put_internal(obj, path, pljson_ext.to_json_value(elem), base);</code></li>
            <li class="never" data-hits="" data-linenumber="508">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="509">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="510">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="511">
            <code class="sql">  procedure remove(obj in out nocopy pljson, path varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="512">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="513">
            <code class="sql">    pljson_ext.put_internal(obj,path,null,base);</code></li>
            <li class="never" data-hits="" data-linenumber="514">
            <code class="sql">    --if(json_ext.get_json_value(obj, path) is not null) then</code></li>
            <li class="never" data-hits="" data-linenumber="515">
            <code class="sql">    --end if;</code></li>
            <li class="never" data-hits="" data-linenumber="516">
            <code class="sql">  end remove;</code></li>
            <li class="never" data-hits="" data-linenumber="517">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="518">
            <code class="sql">  --Pretty print with JSON Path</code></li>
            <li class="never" data-hits="" data-linenumber="519">
            <code class="sql">  function pp(obj pljson, v_path varchar2) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="520">
            <code class="sql">    json_part pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="521">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="522">
            <code class="sql">    json_part := pljson_ext.get_json_value(obj, v_path);</code></li>
            <li class="never" data-hits="" data-linenumber="523">
            <code class="sql">    if(json_part is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="524">
            <code class="sql">      return &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="525">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="526">
            <code class="sql">      return pljson_printer.pretty_print_any(json_part); --escapes a possible internal string</code></li>
            <li class="never" data-hits="" data-linenumber="527">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="528">
            <code class="sql">  end pp;</code></li>
            <li class="never" data-hits="" data-linenumber="529">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="530">
            <code class="sql">  procedure pp(obj pljson, v_path varchar2) as --using dbms_output.put_line</code></li>
            <li class="never" data-hits="" data-linenumber="531">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="532">
            <code class="sql">    dbms_output.put_line(pp(obj, v_path));</code></li>
            <li class="never" data-hits="" data-linenumber="533">
            <code class="sql">  end pp;</code></li>
            <li class="never" data-hits="" data-linenumber="534">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="535">
            <code class="sql">  -- spaces = false!</code></li>
            <li class="never" data-hits="" data-linenumber="536">
            <code class="sql">  procedure pp_htp(obj pljson, v_path varchar2) as --using htp.print</code></li>
            <li class="never" data-hits="" data-linenumber="537">
            <code class="sql">    json_part pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="538">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="539">
            <code class="sql">    json_part := pljson_ext.get_json_value(obj, v_path);</code></li>
            <li class="never" data-hits="" data-linenumber="540">
            <code class="sql">    if(json_part is null) then htp.print; else</code></li>
            <li class="never" data-hits="" data-linenumber="541">
            <code class="sql">      htp.print(pljson_printer.pretty_print_any(json_part, false));</code></li>
            <li class="never" data-hits="" data-linenumber="542">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="543">
            <code class="sql">  end pp_htp;</code></li>
            <li class="never" data-hits="" data-linenumber="544">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="545">
            <code class="sql">  function base64(binarydata blob) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="546">
            <code class="sql">    obj pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="547">
            <code class="sql">    c clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="548">
            <code class="sql">    benc blob;</code></li>
            <li class="never" data-hits="" data-linenumber="549">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="550">
            <code class="sql">    v_blob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="551">
            <code class="sql">    v_clob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="552">
            <code class="sql">    v_lang_context NUMBER := DBMS_LOB.DEFAULT_LANG_CTX;</code></li>
            <li class="never" data-hits="" data-linenumber="553">
            <code class="sql">    v_warning NUMBER;</code></li>
            <li class="never" data-hits="" data-linenumber="554">
            <code class="sql">    v_amount PLS_INTEGER;</code></li>
            <li class="never" data-hits="" data-linenumber="555">
            <code class="sql">    --temp varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="556">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="557">
            <code class="sql">    FUNCTION encodeBlob2Base64(pBlobIn IN BLOB) RETURN BLOB IS</code></li>
            <li class="never" data-hits="" data-linenumber="558">
            <code class="sql">      vAmount NUMBER := 45;</code></li>
            <li class="never" data-hits="" data-linenumber="559">
            <code class="sql">      vBlobEnc BLOB := empty_blob();</code></li>
            <li class="never" data-hits="" data-linenumber="560">
            <code class="sql">      vBlobEncLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="561">
            <code class="sql">      vBlobInLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="562">
            <code class="sql">      vBuffer RAW(45);</code></li>
            <li class="never" data-hits="" data-linenumber="563">
            <code class="sql">      vOffset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="564">
            <code class="sql">    BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="565">
            <code class="sql">      --dbms_output.put_line(&apos;Start base64 encoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="566">
            <code class="sql">      vBlobInLen := dbms_lob.getlength(pBlobIn);</code></li>
            <li class="never" data-hits="" data-linenumber="567">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobInLength&gt;&apos; || vBlobInLen);</code></li>
            <li class="never" data-hits="" data-linenumber="568">
            <code class="sql">      dbms_lob.createtemporary(vBlobEnc, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="569">
            <code class="sql">      LOOP</code></li>
            <li class="never" data-hits="" data-linenumber="570">
            <code class="sql">        IF vOffset &gt;= vBlobInLen THEN</code></li>
            <li class="never" data-hits="" data-linenumber="571">
            <code class="sql">          EXIT;</code></li>
            <li class="never" data-hits="" data-linenumber="572">
            <code class="sql">        END IF;</code></li>
            <li class="never" data-hits="" data-linenumber="573">
            <code class="sql">        dbms_lob.read(pBlobIn, vAmount, vOffset, vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="574">
            <code class="sql">        BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="575">
            <code class="sql">          dbms_lob.append(vBlobEnc, utl_encode.base64_encode(vBuffer));</code></li>
            <li class="never" data-hits="" data-linenumber="576">
            <code class="sql">        EXCEPTION</code></li>
            <li class="never" data-hits="" data-linenumber="577">
            <code class="sql">          WHEN OTHERS THEN</code></li>
            <li class="never" data-hits="" data-linenumber="578">
            <code class="sql">          dbms_output.put_line(&apos;&lt;vAmount&gt;&apos; || vAmount || &apos;&lt;vOffset&gt;&apos; || vOffset || &apos;&lt;vBuffer&gt;&apos; || vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="579">
            <code class="sql">          dbms_output.put_line(&apos;ERROR IN append: &apos; || SQLERRM);</code></li>
            <li class="never" data-hits="" data-linenumber="580">
            <code class="sql">          RAISE;</code></li>
            <li class="never" data-hits="" data-linenumber="581">
            <code class="sql">        END;</code></li>
            <li class="never" data-hits="" data-linenumber="582">
            <code class="sql">        vOffset := vOffset + vAmount;</code></li>
            <li class="never" data-hits="" data-linenumber="583">
            <code class="sql">      END LOOP;</code></li>
            <li class="never" data-hits="" data-linenumber="584">
            <code class="sql">      vBlobEncLen := dbms_lob.getlength(vBlobEnc);</code></li>
            <li class="never" data-hits="" data-linenumber="585">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobEncLength&gt;&apos; || vBlobEncLen);</code></li>
            <li class="never" data-hits="" data-linenumber="586">
            <code class="sql">      --dbms_output.put_line(&apos;Finshed base64 encoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="587">
            <code class="sql">      RETURN vBlobEnc;</code></li>
            <li class="never" data-hits="" data-linenumber="588">
            <code class="sql">    END encodeBlob2Base64;</code></li>
            <li class="never" data-hits="" data-linenumber="589">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="590">
            <code class="sql">    benc := encodeBlob2Base64(binarydata);</code></li>
            <li class="never" data-hits="" data-linenumber="591">
            <code class="sql">    dbms_lob.createtemporary(c, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="592">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(benc);</code></li>
            <li class="never" data-hits="" data-linenumber="593">
            <code class="sql">    DBMS_LOB.CONVERTTOCLOB(c, benc, v_amount, v_clob_offset, v_blob_offset, 1, v_lang_context, v_warning);</code></li>
            <li class="never" data-hits="" data-linenumber="594">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="595">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(c);</code></li>
            <li class="never" data-hits="" data-linenumber="596">
            <code class="sql">    v_clob_offset := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="597">
            <code class="sql">    --dbms_output.put_line(&apos;V amount: &apos;||v_amount);</code></li>
            <li class="never" data-hits="" data-linenumber="598">
            <code class="sql">    while(v_clob_offset &lt; v_amount) loop</code></li>
            <li class="never" data-hits="" data-linenumber="599">
            <code class="sql">      --dbms_output.put_line(v_offset);</code></li>
            <li class="never" data-hits="" data-linenumber="600">
            <code class="sql">      --temp := ;</code></li>
            <li class="never" data-hits="" data-linenumber="601">
            <code class="sql">      --dbms_output.put_line(&apos;size: &apos;||length(temp));</code></li>
            <li class="never" data-hits="" data-linenumber="602">
            <code class="sql">      obj.append(dbms_lob.SUBSTR(c, 4000, v_clob_offset));</code></li>
            <li class="never" data-hits="" data-linenumber="603">
            <code class="sql">      v_clob_offset := v_clob_offset + 4000;</code></li>
            <li class="never" data-hits="" data-linenumber="604">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="605">
            <code class="sql">    dbms_lob.freetemporary(benc);</code></li>
            <li class="never" data-hits="" data-linenumber="606">
            <code class="sql">    dbms_lob.freetemporary(c);</code></li>
            <li class="never" data-hits="" data-linenumber="607">
            <code class="sql">    --dbms_output.put_line(obj.count);</code></li>
            <li class="never" data-hits="" data-linenumber="608">
            <code class="sql">    --dbms_output.put_line(obj.get_last().to_char);</code></li>
            <li class="never" data-hits="" data-linenumber="609">
            <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="610">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="611">
            <code class="sql">  end base64;</code></li>
            <li class="never" data-hits="" data-linenumber="612">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="613">
            <code class="sql">  function base64(l pljson_list) return blob as</code></li>
            <li class="never" data-hits="" data-linenumber="614">
            <code class="sql">    c clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="615">
            <code class="sql">    b blob := empty_blob();</code></li>
            <li class="never" data-hits="" data-linenumber="616">
            <code class="sql">    bret blob;</code></li>
            <li class="never" data-hits="" data-linenumber="617">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="618">
            <code class="sql">    v_blob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="619">
            <code class="sql">    v_clob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="620">
            <code class="sql">    v_lang_context NUMBER := 0; --DBMS_LOB.DEFAULT_LANG_CTX;</code></li>
            <li class="never" data-hits="" data-linenumber="621">
            <code class="sql">    v_warning NUMBER;</code></li>
            <li class="never" data-hits="" data-linenumber="622">
            <code class="sql">    v_amount PLS_INTEGER;</code></li>
            <li class="never" data-hits="" data-linenumber="623">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="624">
            <code class="sql">    FUNCTION decodeBase642Blob(pBlobIn IN BLOB) RETURN BLOB IS</code></li>
            <li class="never" data-hits="" data-linenumber="625">
            <code class="sql">      vAmount NUMBER := 256;--32;</code></li>
            <li class="never" data-hits="" data-linenumber="626">
            <code class="sql">      vBlobDec BLOB := empty_blob();</code></li>
            <li class="never" data-hits="" data-linenumber="627">
            <code class="sql">      vBlobDecLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="628">
            <code class="sql">      vBlobInLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="629">
            <code class="sql">      vBuffer RAW(256);--32);</code></li>
            <li class="never" data-hits="" data-linenumber="630">
            <code class="sql">      vOffset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="631">
            <code class="sql">    BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="632">
            <code class="sql">      --dbms_output.put_line(&apos;Start base64 decoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="633">
            <code class="sql">      vBlobInLen := dbms_lob.getlength(pBlobIn);</code></li>
            <li class="never" data-hits="" data-linenumber="634">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobInLength&gt;&apos; || vBlobInLen);</code></li>
            <li class="never" data-hits="" data-linenumber="635">
            <code class="sql">      dbms_lob.createtemporary(vBlobDec, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="636">
            <code class="sql">      LOOP</code></li>
            <li class="never" data-hits="" data-linenumber="637">
            <code class="sql">        IF vOffset &gt;= vBlobInLen THEN</code></li>
            <li class="never" data-hits="" data-linenumber="638">
            <code class="sql">          EXIT;</code></li>
            <li class="never" data-hits="" data-linenumber="639">
            <code class="sql">        END IF;</code></li>
            <li class="never" data-hits="" data-linenumber="640">
            <code class="sql">        dbms_lob.read(pBlobIn, vAmount, vOffset, vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="641">
            <code class="sql">        BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="642">
            <code class="sql">          dbms_lob.append(vBlobDec, utl_encode.base64_decode(vBuffer));</code></li>
            <li class="never" data-hits="" data-linenumber="643">
            <code class="sql">        EXCEPTION</code></li>
            <li class="never" data-hits="" data-linenumber="644">
            <code class="sql">          WHEN OTHERS THEN</code></li>
            <li class="never" data-hits="" data-linenumber="645">
            <code class="sql">          dbms_output.put_line(&apos;&lt;vAmount&gt;&apos; || vAmount || &apos;&lt;vOffset&gt;&apos; || vOffset || &apos;&lt;vBuffer&gt;&apos; || vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="646">
            <code class="sql">          dbms_output.put_line(&apos;ERROR IN append: &apos; || SQLERRM);</code></li>
            <li class="never" data-hits="" data-linenumber="647">
            <code class="sql">          RAISE;</code></li>
            <li class="never" data-hits="" data-linenumber="648">
            <code class="sql">        END;</code></li>
            <li class="never" data-hits="" data-linenumber="649">
            <code class="sql">        vOffset := vOffset + vAmount;</code></li>
            <li class="never" data-hits="" data-linenumber="650">
            <code class="sql">      END LOOP;</code></li>
            <li class="never" data-hits="" data-linenumber="651">
            <code class="sql">      vBlobDecLen := dbms_lob.getlength(vBlobDec);</code></li>
            <li class="never" data-hits="" data-linenumber="652">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobDecLength&gt;&apos; || vBlobDecLen);</code></li>
            <li class="never" data-hits="" data-linenumber="653">
            <code class="sql">      --dbms_output.put_line(&apos;Finshed base64 decoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="654">
            <code class="sql">      RETURN vBlobDec;</code></li>
            <li class="never" data-hits="" data-linenumber="655">
            <code class="sql">    END decodeBase642Blob;</code></li>
            <li class="never" data-hits="" data-linenumber="656">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="657">
            <code class="sql">    dbms_lob.createtemporary(c, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="658">
            <code class="sql">    for i in 1 .. l.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="659">
            <code class="sql">      dbms_lob.append(c, l.get(i).get_string());</code></li>
            <li class="never" data-hits="" data-linenumber="660">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="661">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(c);</code></li>
            <li class="never" data-hits="" data-linenumber="662">
            <code class="sql">    --dbms_output.put_line(&apos;L C&apos;||v_amount);</code></li>
            <li class="never" data-hits="" data-linenumber="663">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="664">
            <code class="sql">    dbms_lob.createtemporary(b, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="665">
            <code class="sql">    DBMS_LOB.CONVERTTOBLOB(b, c, dbms_lob.lobmaxsize, v_clob_offset, v_blob_offset, 1, v_lang_context, v_warning);</code></li>
            <li class="never" data-hits="" data-linenumber="666">
            <code class="sql">    dbms_lob.freetemporary(c);</code></li>
            <li class="never" data-hits="" data-linenumber="667">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(b);</code></li>
            <li class="never" data-hits="" data-linenumber="668">
            <code class="sql">    --dbms_output.put_line(&apos;L B&apos;||v_amount);</code></li>
            <li class="never" data-hits="" data-linenumber="669">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="670">
            <code class="sql">    bret := decodeBase642Blob(b);</code></li>
            <li class="never" data-hits="" data-linenumber="671">
            <code class="sql">    dbms_lob.freetemporary(b);</code></li>
            <li class="never" data-hits="" data-linenumber="672">
            <code class="sql">    return bret;</code></li>
            <li class="never" data-hits="" data-linenumber="673">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="674">
            <code class="sql">  end base64;</code></li>
            <li class="never" data-hits="" data-linenumber="675">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="676">
            <code class="sql">  function encode(binarydata blob) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="677">
            <code class="sql">    obj pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="678">
            <code class="sql">    c clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="679">
            <code class="sql">    benc blob;</code></li>
            <li class="never" data-hits="" data-linenumber="680">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="681">
            <code class="sql">    v_blob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="682">
            <code class="sql">    v_clob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="683">
            <code class="sql">    v_lang_context NUMBER := DBMS_LOB.DEFAULT_LANG_CTX;</code></li>
            <li class="never" data-hits="" data-linenumber="684">
            <code class="sql">    v_warning NUMBER;</code></li>
            <li class="never" data-hits="" data-linenumber="685">
            <code class="sql">    v_amount PLS_INTEGER;</code></li>
            <li class="never" data-hits="" data-linenumber="686">
            <code class="sql">    --temp varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="687">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="688">
            <code class="sql">    FUNCTION encodeBlob2Base64(pBlobIn IN BLOB) RETURN BLOB IS</code></li>
            <li class="never" data-hits="" data-linenumber="689">
            <code class="sql">      vAmount NUMBER := 45;</code></li>
            <li class="never" data-hits="" data-linenumber="690">
            <code class="sql">      vBlobEnc BLOB := empty_blob();</code></li>
            <li class="never" data-hits="" data-linenumber="691">
            <code class="sql">      vBlobEncLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="692">
            <code class="sql">      vBlobInLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="693">
            <code class="sql">      vBuffer RAW(45);</code></li>
            <li class="never" data-hits="" data-linenumber="694">
            <code class="sql">      vOffset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="695">
            <code class="sql">    BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="696">
            <code class="sql">      --dbms_output.put_line(&apos;Start base64 encoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="697">
            <code class="sql">      vBlobInLen := dbms_lob.getlength(pBlobIn);</code></li>
            <li class="never" data-hits="" data-linenumber="698">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobInLength&gt;&apos; || vBlobInLen);</code></li>
            <li class="never" data-hits="" data-linenumber="699">
            <code class="sql">      dbms_lob.createtemporary(vBlobEnc, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="700">
            <code class="sql">      LOOP</code></li>
            <li class="never" data-hits="" data-linenumber="701">
            <code class="sql">        IF vOffset &gt;= vBlobInLen THEN</code></li>
            <li class="never" data-hits="" data-linenumber="702">
            <code class="sql">          EXIT;</code></li>
            <li class="never" data-hits="" data-linenumber="703">
            <code class="sql">        END IF;</code></li>
            <li class="never" data-hits="" data-linenumber="704">
            <code class="sql">        dbms_lob.read(pBlobIn, vAmount, vOffset, vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="705">
            <code class="sql">        BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="706">
            <code class="sql">          dbms_lob.append(vBlobEnc, utl_encode.base64_encode(vBuffer));</code></li>
            <li class="never" data-hits="" data-linenumber="707">
            <code class="sql">        EXCEPTION</code></li>
            <li class="never" data-hits="" data-linenumber="708">
            <code class="sql">          WHEN OTHERS THEN</code></li>
            <li class="never" data-hits="" data-linenumber="709">
            <code class="sql">          dbms_output.put_line(&apos;&lt;vAmount&gt;&apos; || vAmount || &apos;&lt;vOffset&gt;&apos; || vOffset || &apos;&lt;vBuffer&gt;&apos; || vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="710">
            <code class="sql">          dbms_output.put_line(&apos;ERROR IN append: &apos; || SQLERRM);</code></li>
            <li class="never" data-hits="" data-linenumber="711">
            <code class="sql">          RAISE;</code></li>
            <li class="never" data-hits="" data-linenumber="712">
            <code class="sql">        END;</code></li>
            <li class="never" data-hits="" data-linenumber="713">
            <code class="sql">        vOffset := vOffset + vAmount;</code></li>
            <li class="never" data-hits="" data-linenumber="714">
            <code class="sql">      END LOOP;</code></li>
            <li class="never" data-hits="" data-linenumber="715">
            <code class="sql">      vBlobEncLen := dbms_lob.getlength(vBlobEnc);</code></li>
            <li class="never" data-hits="" data-linenumber="716">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobEncLength&gt;&apos; || vBlobEncLen);</code></li>
            <li class="never" data-hits="" data-linenumber="717">
            <code class="sql">      --dbms_output.put_line(&apos;Finshed base64 encoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="718">
            <code class="sql">      RETURN vBlobEnc;</code></li>
            <li class="never" data-hits="" data-linenumber="719">
            <code class="sql">    END encodeBlob2Base64;</code></li>
            <li class="never" data-hits="" data-linenumber="720">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="721">
            <code class="sql">    benc := encodeBlob2Base64(binarydata);</code></li>
            <li class="never" data-hits="" data-linenumber="722">
            <code class="sql">    dbms_lob.createtemporary(c, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="723">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(benc);</code></li>
            <li class="never" data-hits="" data-linenumber="724">
            <code class="sql">    DBMS_LOB.CONVERTTOCLOB(c, benc, v_amount, v_clob_offset, v_blob_offset, 1, v_lang_context, v_warning);</code></li>
            <li class="never" data-hits="" data-linenumber="725">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="726">
            <code class="sql">    obj := pljson_value(c);</code></li>
            <li class="never" data-hits="" data-linenumber="727">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="728">
            <code class="sql">    dbms_lob.freetemporary(benc);</code></li>
            <li class="never" data-hits="" data-linenumber="729">
            <code class="sql">    dbms_lob.freetemporary(c);</code></li>
            <li class="never" data-hits="" data-linenumber="730">
            <code class="sql">    --dbms_output.put_line(obj.count);</code></li>
            <li class="never" data-hits="" data-linenumber="731">
            <code class="sql">    --dbms_output.put_line(obj.get_last().to_char);</code></li>
            <li class="never" data-hits="" data-linenumber="732">
            <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="733">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="734">
            <code class="sql">  end encode;</code></li>
            <li class="never" data-hits="" data-linenumber="735">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="736">
            <code class="sql">  function decode(v pljson_value) return blob as</code></li>
            <li class="never" data-hits="" data-linenumber="737">
            <code class="sql">    c clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="738">
            <code class="sql">    b blob := empty_blob();</code></li>
            <li class="never" data-hits="" data-linenumber="739">
            <code class="sql">    bret blob;</code></li>
            <li class="never" data-hits="" data-linenumber="740">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="741">
            <code class="sql">    v_blob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="742">
            <code class="sql">    v_clob_offset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="743">
            <code class="sql">    v_lang_context NUMBER := 0; --DBMS_LOB.DEFAULT_LANG_CTX;</code></li>
            <li class="never" data-hits="" data-linenumber="744">
            <code class="sql">    v_warning NUMBER;</code></li>
            <li class="never" data-hits="" data-linenumber="745">
            <code class="sql">    v_amount PLS_INTEGER;</code></li>
            <li class="never" data-hits="" data-linenumber="746">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="747">
            <code class="sql">    FUNCTION decodeBase642Blob(pBlobIn IN BLOB) RETURN BLOB IS</code></li>
            <li class="never" data-hits="" data-linenumber="748">
            <code class="sql">      vAmount NUMBER := 256;--32;</code></li>
            <li class="never" data-hits="" data-linenumber="749">
            <code class="sql">      vBlobDec BLOB := empty_blob();</code></li>
            <li class="never" data-hits="" data-linenumber="750">
            <code class="sql">      vBlobDecLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="751">
            <code class="sql">      vBlobInLen NUMBER := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="752">
            <code class="sql">      vBuffer RAW(256);--32);</code></li>
            <li class="never" data-hits="" data-linenumber="753">
            <code class="sql">      vOffset NUMBER := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="754">
            <code class="sql">    BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="755">
            <code class="sql">      --dbms_output.put_line(&apos;Start base64 decoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="756">
            <code class="sql">      vBlobInLen := dbms_lob.getlength(pBlobIn);</code></li>
            <li class="never" data-hits="" data-linenumber="757">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobInLength&gt;&apos; || vBlobInLen);</code></li>
            <li class="never" data-hits="" data-linenumber="758">
            <code class="sql">      dbms_lob.createtemporary(vBlobDec, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="759">
            <code class="sql">      LOOP</code></li>
            <li class="never" data-hits="" data-linenumber="760">
            <code class="sql">        IF vOffset &gt;= vBlobInLen THEN</code></li>
            <li class="never" data-hits="" data-linenumber="761">
            <code class="sql">          EXIT;</code></li>
            <li class="never" data-hits="" data-linenumber="762">
            <code class="sql">        END IF;</code></li>
            <li class="never" data-hits="" data-linenumber="763">
            <code class="sql">        dbms_lob.read(pBlobIn, vAmount, vOffset, vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="764">
            <code class="sql">        BEGIN</code></li>
            <li class="never" data-hits="" data-linenumber="765">
            <code class="sql">          dbms_lob.append(vBlobDec, utl_encode.base64_decode(vBuffer));</code></li>
            <li class="never" data-hits="" data-linenumber="766">
            <code class="sql">        EXCEPTION</code></li>
            <li class="never" data-hits="" data-linenumber="767">
            <code class="sql">          WHEN OTHERS THEN</code></li>
            <li class="never" data-hits="" data-linenumber="768">
            <code class="sql">          dbms_output.put_line(&apos;&lt;vAmount&gt;&apos; || vAmount || &apos;&lt;vOffset&gt;&apos; || vOffset || &apos;&lt;vBuffer&gt;&apos; || vBuffer);</code></li>
            <li class="never" data-hits="" data-linenumber="769">
            <code class="sql">          dbms_output.put_line(&apos;ERROR IN append: &apos; || SQLERRM);</code></li>
            <li class="never" data-hits="" data-linenumber="770">
            <code class="sql">          RAISE;</code></li>
            <li class="never" data-hits="" data-linenumber="771">
            <code class="sql">        END;</code></li>
            <li class="never" data-hits="" data-linenumber="772">
            <code class="sql">        vOffset := vOffset + vAmount;</code></li>
            <li class="never" data-hits="" data-linenumber="773">
            <code class="sql">      END LOOP;</code></li>
            <li class="never" data-hits="" data-linenumber="774">
            <code class="sql">      vBlobDecLen := dbms_lob.getlength(vBlobDec);</code></li>
            <li class="never" data-hits="" data-linenumber="775">
            <code class="sql">      --dbms_output.put_line(&apos;&lt;BlobDecLength&gt;&apos; || vBlobDecLen);</code></li>
            <li class="never" data-hits="" data-linenumber="776">
            <code class="sql">      --dbms_output.put_line(&apos;Finshed base64 decoding.&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="777">
            <code class="sql">      RETURN vBlobDec;</code></li>
            <li class="never" data-hits="" data-linenumber="778">
            <code class="sql">    END decodeBase642Blob;</code></li>
            <li class="never" data-hits="" data-linenumber="779">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="780">
            <code class="sql">    dbms_lob.createtemporary(c, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="781">
            <code class="sql">    v.get_string(c);</code></li>
            <li class="never" data-hits="" data-linenumber="782">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(c);</code></li>
            <li class="never" data-hits="" data-linenumber="783">
            <code class="sql">    --dbms_output.put_line(&apos;L C&apos;||v_amount);</code></li>
            <li class="never" data-hits="" data-linenumber="784">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="785">
            <code class="sql">    dbms_lob.createtemporary(b, TRUE);</code></li>
            <li class="never" data-hits="" data-linenumber="786">
            <code class="sql">    DBMS_LOB.CONVERTTOBLOB(b, c, dbms_lob.lobmaxsize, v_clob_offset, v_blob_offset, 1, v_lang_context, v_warning);</code></li>
            <li class="never" data-hits="" data-linenumber="787">
            <code class="sql">    dbms_lob.freetemporary(c);</code></li>
            <li class="never" data-hits="" data-linenumber="788">
            <code class="sql">    v_amount := DBMS_LOB.GETLENGTH(b);</code></li>
            <li class="never" data-hits="" data-linenumber="789">
            <code class="sql">    --dbms_output.put_line(&apos;L B&apos;||v_amount);</code></li>
            <li class="never" data-hits="" data-linenumber="790">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="791">
            <code class="sql">    bret := decodeBase642Blob(b);</code></li>
            <li class="never" data-hits="" data-linenumber="792">
            <code class="sql">    dbms_lob.freetemporary(b);</code></li>
            <li class="never" data-hits="" data-linenumber="793">
            <code class="sql">    return bret;</code></li>
            <li class="never" data-hits="" data-linenumber="794">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="795">
            <code class="sql">  end decode;</code></li>
            <li class="never" data-hits="" data-linenumber="796">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="797">
            <code class="sql">end pljson_ext;</code></li></ol></pre></div><div class="source_table" id="8FCED375345CFEAC810465415BC32011"><div class="header"> <h3>DEV.PLJSON_HELPER</h3><h4><span class="red">0 %</span> covered</h4><div> <b>395</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>395</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_helper as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  --recursive merge</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  function merge( p_a_json pljson, p_b_json pljson) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">    l_json    pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">    l_jv      pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">    l_indx    number;</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">    l_recursive pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">    --</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">    -- Initialize our return object</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">    --</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">    l_json := p_a_json;</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">    -- loop through p_b_json</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">    l_indx := p_b_json.json_data.first;</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">    loop</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">      exit when l_indx is null;</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">      l_jv   := p_b_json.json_data(l_indx);</code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">      if(l_jv.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">        --recursive</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">        l_recursive := l_json.get(l_jv.mapname);</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">        if(l_recursive is not null and l_recursive.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">          l_json.put(l_jv.mapname, merge(pljson(l_recursive), pljson(l_jv)));</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">          l_json.put(l_jv.mapname, l_jv);</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">        l_json.put(l_jv.mapname, l_jv);</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">      --increment</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">      l_indx := p_b_json.json_data.next(l_indx);</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">    return l_json;</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  end merge;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">  -- join two lists</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">  function join( p_a_list pljson_list, p_b_list pljson_list) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">    l_json_list pljson_list := p_a_list;</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">    for indx in 1 .. p_b_list.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">      l_json_list.append(p_b_list.get(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">    return l_json_list;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">  end join;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">  -- keep keys.</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">  function keep( p_json pljson, p_keys pljson_list) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">    l_json pljson := pljson();</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">    mapname varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">    for i in 1 .. p_keys.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">      mapname := p_keys.get(i).get_string;</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">      if(p_json.exist(mapname)) then</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">        l_json.put(mapname, p_json.get(mapname));</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">    return l_json;</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">  end keep;</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">  -- drop keys.</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">  function remove( p_json pljson, p_keys pljson_list) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">    l_json pljson := p_json;</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">    for i in 1 .. p_keys.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">      l_json.remove(p_keys.get(i).get_string);</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql">    return l_json;</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">  end remove;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">  --equals functions</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 number) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">      return p_v1.is_null;</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">    if(not p_v1.is_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">    return p_v2 = p_v1.get_number;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 binary_double) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">      return p_v1.is_null;</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">    if(not p_v1.is_number) then</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">    return p_v2 = p_v1.get_double;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">      return p_v1.is_null;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">    if(not p_v1.is_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">    return p_v2 = p_v1.get_bool;</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 varchar2) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">      return (p_v1.is_null or p_v1.get_string is null);</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">    if(not p_v1.is_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">    return p_v2 = p_v1.get_string;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 clob) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">    res boolean;</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">      return p_v1.is_null;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">    if(not p_v1.is_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">    p_v1.get_string(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">    res := dbms_lob.compare(p_v2, my_clob) = 0;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">    return res;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 pljson_value, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">    if(p_v2 is null or p_v2.is_null) then</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">      return (p_v1 is null or p_v1.is_null);</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">    if(p_v2.is_number) then return equals(p_v1, p_v2.get_number); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">    if(p_v2.is_bool) then return equals(p_v1, p_v2.get_bool); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">    if(p_v2.is_object) then return equals(p_v1, pljson(p_v2), exact); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">    if(p_v2.is_array) then return equals(p_v1, pljson_list(p_v2), exact); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">    if(p_v2.is_string) then</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">      if(p_v2.extended_str is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">        return equals(p_v1, p_v2.get_string);</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">        declare</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">          my_clob clob; res boolean;</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">        begin</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">          my_clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">          dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">          p_v2.get_string(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">          res := equals(p_v1, my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">          dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">          return res;</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">        end;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">    return false; --should never happen</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 pljson_list, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">    cmp pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">    res boolean := true;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">--  p_v1.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">--  p_v2.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">--  dbms_output.put_line(&apos;labc1&apos;||case when exact then &apos;X&apos; else &apos;U&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">      return p_v1.is_null;</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">    if(not p_v1.is_array) then</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">--  dbms_output.put_line(&apos;labc2&apos;||case when exact then &apos;X&apos; else &apos;U&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">    cmp := pljson_list(p_v1);</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">    if(cmp.count != p_v2.count and exact) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">--  dbms_output.put_line(&apos;labc3&apos;||case when exact then &apos;X&apos; else &apos;U&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">    if(exact) then</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">      for i in 1 .. cmp.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">        res := equals(cmp.get(i), p_v2.get(i), exact);</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">        if(not res) then return res; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">--  dbms_output.put_line(&apos;labc4&apos;||case when exact then &apos;X&apos; else &apos;U&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">      if(p_v2.count &gt; cmp.count) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">--  dbms_output.put_line(&apos;labc5&apos;||case when exact then &apos;X&apos; else &apos;U&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">      --match sublist here!</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">      for x in 0 .. (cmp.count-p_v2.count) loop</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">--  dbms_output.put_line(&apos;labc7&apos;||x);</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">        for i in 1 .. p_v2.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">          res := equals(cmp.get(x+i), p_v2.get(i), exact);</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">          if(not res) then</code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">            goto next_index;</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql">        return true;</code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">        &lt;&lt;next_index&gt;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql">        null;</code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql">--  dbms_output.put_line(&apos;labc7&apos;||case when exact then &apos;X&apos; else &apos;U&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">    return false; --no match</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql">    return res;</code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">  function equals(p_v1 pljson_value, p_v2 pljson, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">    cmp pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">    res boolean := true;</code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql">--  p_v1.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">--  p_v2.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql">--  dbms_output.put_line(&apos;abc1&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql">    if(p_v2 is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">      return p_v1.is_null;</code></li>
            <li class="never" data-hits="" data-linenumber="252">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql">    if(not p_v1.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">    cmp := pljson(p_v1);</code></li>
            <li class="never" data-hits="" data-linenumber="259">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">--  dbms_output.put_line(&apos;abc2&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="261">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">    if(cmp.count != p_v2.count and exact) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql">--  dbms_output.put_line(&apos;abc3&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">    declare</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">      k1 pljson_list := p_v2.get_keys;</code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql">      key_index number;</code></li>
            <li class="never" data-hits="" data-linenumber="268">
            <code class="sql">    begin</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql">      for i in 1 .. k1.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="270">
            <code class="sql">        key_index := cmp.index_of(k1.get(i).get_string);</code></li>
            <li class="never" data-hits="" data-linenumber="271">
            <code class="sql">        if(key_index = -1) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="272">
            <code class="sql">        if(exact) then</code></li>
            <li class="never" data-hits="" data-linenumber="273">
            <code class="sql">          if(not equals(p_v2.get(i), cmp.get(key_index), true)) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="274">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="275">
            <code class="sql">          --non exact</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">          declare</code></li>
            <li class="never" data-hits="" data-linenumber="277">
            <code class="sql">            v1 pljson_value := cmp.get(key_index);</code></li>
            <li class="never" data-hits="" data-linenumber="278">
            <code class="sql">            v2 pljson_value := p_v2.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="279">
            <code class="sql">          begin</code></li>
            <li class="never" data-hits="" data-linenumber="280">
            <code class="sql">--  dbms_output.put_line(&apos;abc3 1/2&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="281">
            <code class="sql">--            v1.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">--            v2.print(false);</code></li>
            <li class="never" data-hits="" data-linenumber="283">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="284">
            <code class="sql">            if(v1.is_object and v2.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">              if(not equals(v1, v2, false)) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="286">
            <code class="sql">            elsif(v1.is_array and v2.is_array) then</code></li>
            <li class="never" data-hits="" data-linenumber="287">
            <code class="sql">              if(not equals(v1, v2, false)) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="288">
            <code class="sql">            else</code></li>
            <li class="never" data-hits="" data-linenumber="289">
            <code class="sql">              if(not equals(v1, v2, true)) then return false; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql">          end;</code></li>
            <li class="never" data-hits="" data-linenumber="292">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="293">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="294">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">    end;</code></li>
            <li class="never" data-hits="" data-linenumber="296">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="297">
            <code class="sql">--  dbms_output.put_line(&apos;abc4&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="299">
            <code class="sql">    return true;</code></li>
            <li class="never" data-hits="" data-linenumber="300">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="301">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="302">
            <code class="sql">  function equals(p_v1 pljson, p_v2 pljson, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">    return equals(p_v1.to_json_value, p_v2, exact);</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="307">
            <code class="sql">  function equals(p_v1 pljson_list, p_v2 pljson_list, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql">    return equals(p_v1.to_json_value, p_v2, exact);</code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">  --contain</code></li>
            <li class="never" data-hits="" data-linenumber="313">
            <code class="sql">  function contains(p_v1 pljson, p_v2 pljson_value, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="314">
            <code class="sql">    v_values pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="315">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="316">
            <code class="sql">    if(equals(p_v1.to_json_value, p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="317">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="318">
            <code class="sql">    v_values := p_v1.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="319">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="320">
            <code class="sql">    for i in 1 .. v_values.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="321">
            <code class="sql">      declare</code></li>
            <li class="never" data-hits="" data-linenumber="322">
            <code class="sql">        v_val pljson_value := v_values.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="323">
            <code class="sql">      begin</code></li>
            <li class="never" data-hits="" data-linenumber="324">
            <code class="sql">        if(v_val.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="325">
            <code class="sql">          if(contains(pljson(v_val), p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="326">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="327">
            <code class="sql">        if(v_val.is_array) then</code></li>
            <li class="never" data-hits="" data-linenumber="328">
            <code class="sql">          if(contains(pljson_list(v_val), p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="329">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="330">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="331">
            <code class="sql">        if(equals(v_val, p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="332">
            <code class="sql">      end;</code></li>
            <li class="never" data-hits="" data-linenumber="333">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="334">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="335">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="336">
            <code class="sql">    return false;</code></li>
            <li class="never" data-hits="" data-linenumber="337">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="338">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="339">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 pljson_value, exact boolean) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="340">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="341">
            <code class="sql">    if(equals(p_v1.to_json_value, p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="342">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="343">
            <code class="sql">    for i in 1 .. p_v1.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="344">
            <code class="sql">      declare</code></li>
            <li class="never" data-hits="" data-linenumber="345">
            <code class="sql">        v_val pljson_value := p_v1.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="346">
            <code class="sql">      begin</code></li>
            <li class="never" data-hits="" data-linenumber="347">
            <code class="sql">        if(v_val.is_object) then</code></li>
            <li class="never" data-hits="" data-linenumber="348">
            <code class="sql">          if(contains(pljson(v_val), p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="349">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="350">
            <code class="sql">        if(v_val.is_array) then</code></li>
            <li class="never" data-hits="" data-linenumber="351">
            <code class="sql">          if(contains(pljson_list(v_val), p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="352">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="353">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="354">
            <code class="sql">        if(equals(v_val, p_v2, exact)) then return true; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="355">
            <code class="sql">      end;</code></li>
            <li class="never" data-hits="" data-linenumber="356">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="357">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="358">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="359">
            <code class="sql">    return false;</code></li>
            <li class="never" data-hits="" data-linenumber="360">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="361">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="362">
            <code class="sql">  function contains(p_v1 pljson, p_v2 pljson, exact boolean ) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="363">
            <code class="sql">  begin return contains(p_v1, p_v2.to_json_value, exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="364">
            <code class="sql">  function contains(p_v1 pljson, p_v2 pljson_list, exact boolean ) return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="365">
            <code class="sql">  begin return contains(p_v1, p_v2.to_json_value, exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="366">
            <code class="sql">  function contains(p_v1 pljson, p_v2 number, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="367">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="368">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="369">
            <code class="sql">  function contains(p_v1 pljson, p_v2 binary_double, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="370">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="371">
            <code class="sql">  function contains(p_v1 pljson, p_v2 varchar2, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="372">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="373">
            <code class="sql">  function contains(p_v1 pljson, p_v2 boolean, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="374">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="375">
            <code class="sql">  function contains(p_v1 pljson, p_v2 clob, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="376">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="377">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="378">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 pljson, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="379">
            <code class="sql">  return contains(p_v1, p_v2.to_json_value, exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="380">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 pljson_list, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="381">
            <code class="sql">  return contains(p_v1, p_v2.to_json_value, exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="382">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 number, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="383">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="384">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="385">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 binary_double, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="386">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="387">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 varchar2, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="388">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="389">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 boolean, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="390">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="391">
            <code class="sql">  function contains(p_v1 pljson_list, p_v2 clob, exact boolean ) return boolean as begin</code></li>
            <li class="never" data-hits="" data-linenumber="392">
            <code class="sql">  return contains(p_v1, pljson_value(p_v2), exact); end;</code></li>
            <li class="never" data-hits="" data-linenumber="393">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="394">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="395">
            <code class="sql">end pljson_helper;</code></li></ol></pre></div><div class="source_table" id="FDCEFD8C561B7FB741B71FEA0E74E3A2"><div class="header"> <h3>DEV.PLJSON_LIST</h3><h4><span class="red">2.03 %</span> covered</h4><div> <b>148</b> relevant lines. <span class="green"><b>3</b> lines covered</span> and <span class="red"><b>145</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">type body pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  constructor function pljson_list return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="14" data-linenumber="5">
              <span class="hits">14</span>
              <code class="sql">    self.list_data := pljson_value_array();</code></li>
            <li class="covered" data-hits="14" data-linenumber="6">
              <span class="hits">14</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  constructor function pljson_list(str varchar2) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="11">
              <code class="sql">    self := pljson_parser.parse_list(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="12">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  constructor function pljson_list(str clob) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="17">
              <code class="sql">    self := pljson_parser.parse_list(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="18">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">  constructor function pljson_list(cast pljson_value) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">    x number;</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="24">
              <code class="sql">    x := cast.object_or_array.getobject(self);</code></li>
            <li class="missed" data-hits="0" data-linenumber="25">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  member procedure append(self in out nocopy pljson_list, elem pljson_value, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">    indx pls_integer;</code></li>
            <li class="missed" data-hits="0" data-linenumber="31">
              <code class="sql">    insert_value pljson_value := NVL(elem, pljson_value);</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="33">
              <code class="sql">    if(position is null or position &gt; self.count) then --end of list</code></li>
            <li class="missed" data-hits="0" data-linenumber="34">
              <code class="sql">      indx := self.count + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="35">
              <code class="sql">      self.list_data.extend(1);</code></li>
            <li class="missed" data-hits="0" data-linenumber="36">
              <code class="sql">      self.list_data(indx) := insert_value;</code></li>
            <li class="missed" data-hits="0" data-linenumber="37">
              <code class="sql">    elsif(position &lt; 1) then --new first</code></li>
            <li class="missed" data-hits="0" data-linenumber="38">
              <code class="sql">      indx := self.count;</code></li>
            <li class="missed" data-hits="0" data-linenumber="39">
              <code class="sql">      self.list_data.extend(1);</code></li>
            <li class="missed" data-hits="0" data-linenumber="40">
              <code class="sql">      for x in reverse 1 .. indx loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="41">
              <code class="sql">        self.list_data(x+1) := self.list_data(x);</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">      end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="43">
              <code class="sql">      self.list_data(1) := insert_value;</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="45">
              <code class="sql">      indx := self.count;</code></li>
            <li class="missed" data-hits="0" data-linenumber="46">
              <code class="sql">      self.list_data.extend(1);</code></li>
            <li class="missed" data-hits="0" data-linenumber="47">
              <code class="sql">      for x in reverse position .. indx loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="48">
              <code class="sql">        self.list_data(x+1) := self.list_data(x);</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">      end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="50">
              <code class="sql">      self.list_data(position) := insert_value;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">  member procedure append(self in out nocopy pljson_list, elem varchar2, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="57">
              <code class="sql">    append(pljson_value(elem), position);</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">  member procedure append(self in out nocopy pljson_list, elem number, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="62">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="63">
              <code class="sql">      append(pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="65">
              <code class="sql">      append(pljson_value(elem), position);</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">  member procedure append(self in out nocopy pljson_list, elem binary_double, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="72">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="73">
              <code class="sql">      append(pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="75">
              <code class="sql">      append(pljson_value(elem), position);</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">  member procedure append(self in out nocopy pljson_list, elem boolean, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="81">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="82">
              <code class="sql">      append(pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="84">
              <code class="sql">      append(pljson_value(elem), position);</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">  member procedure append(self in out nocopy pljson_list, elem pljson_list, position pls_integer default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="90">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="91">
              <code class="sql">      append(pljson_value(), position);</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="93">
              <code class="sql">      append(elem.to_json_value, position);</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">  member procedure replace(self in out nocopy pljson_list, position pls_integer, elem pljson_value) as</code></li>
            <li class="missed" data-hits="0" data-linenumber="98">
              <code class="sql">    insert_value pljson_value := NVL(elem, pljson_value);</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">    indx number;</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="101">
              <code class="sql">    if(position &gt; self.count) then --end of list</code></li>
            <li class="missed" data-hits="0" data-linenumber="102">
              <code class="sql">      indx := self.count + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="103">
              <code class="sql">      self.list_data.extend(1);</code></li>
            <li class="missed" data-hits="0" data-linenumber="104">
              <code class="sql">      self.list_data(indx) := insert_value;</code></li>
            <li class="missed" data-hits="0" data-linenumber="105">
              <code class="sql">    elsif(position &lt; 1) then --maybe an error message here</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">      null;</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="108">
              <code class="sql">      self.list_data(position) := insert_value;</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">  member procedure replace(self in out nocopy pljson_list, position pls_integer, elem varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="114">
              <code class="sql">    replace(position, pljson_value(elem));</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">  member procedure replace(self in out nocopy pljson_list, position pls_integer, elem number) as</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="119">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="120">
              <code class="sql">      replace(position, pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="122">
              <code class="sql">      replace(position, pljson_value(elem));</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">  member procedure replace(self in out nocopy pljson_list, position pls_integer, elem binary_double) as</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="129">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="130">
              <code class="sql">      replace(position, pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="132">
              <code class="sql">      replace(position, pljson_value(elem));</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">  member procedure replace(self in out nocopy pljson_list, position pls_integer, elem boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="138">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="139">
              <code class="sql">      replace(position, pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="141">
              <code class="sql">      replace(position, pljson_value(elem));</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">  member procedure replace(self in out nocopy pljson_list, position pls_integer, elem pljson_list) as</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="147">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="148">
              <code class="sql">      replace(position, pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="150">
              <code class="sql">      replace(position, elem.to_json_value);</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">  member function count return number as</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="156">
              <code class="sql">    return self.list_data.count;</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">  member procedure remove(self in out nocopy pljson_list, position pls_integer) as</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="161">
              <code class="sql">    if(position is null or position &lt; 1 or position &gt; self.count) then return; end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="162">
              <code class="sql">    for x in (position+1) .. self.count loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="163">
              <code class="sql">      self.list_data(x-1) := self.list_data(x);</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="165">
              <code class="sql">    self.list_data.trim(1);</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">  member procedure remove_first(self in out nocopy pljson_list) as</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="170">
              <code class="sql">    for x in 2 .. self.count loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="171">
              <code class="sql">      self.list_data(x-1) := self.list_data(x);</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="173">
              <code class="sql">    if(self.count &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="174">
              <code class="sql">      self.list_data.trim(1);</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">  member procedure remove_last(self in out nocopy pljson_list) as</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="180">
              <code class="sql">    if(self.count &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="181">
              <code class="sql">      self.list_data.trim(1);</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">  member function get(position pls_integer) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="187">
              <code class="sql">    if(self.count &gt;= position and position &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="188">
              <code class="sql">      return self.list_data(position);</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="190">
              <code class="sql">    return null; -- do not throw error, just return null</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">  member function head return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="195">
              <code class="sql">    if(self.count &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="196">
              <code class="sql">      return self.list_data(self.list_data.first);</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="198">
              <code class="sql">    return null; -- do not throw error, just return null</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">  member function last return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="203">
              <code class="sql">    if(self.count &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="204">
              <code class="sql">      return self.list_data(self.list_data.last);</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="206">
              <code class="sql">    return null; -- do not throw error, just return null</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">  member function tail return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">    t pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="212">
              <code class="sql">    if(self.count &gt; 0) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="213">
              <code class="sql">      t := pljson_list(self.list_data);</code></li>
            <li class="missed" data-hits="0" data-linenumber="214">
              <code class="sql">      t.remove(1);</code></li>
            <li class="missed" data-hits="0" data-linenumber="215">
              <code class="sql">      return t;</code></li>
            <li class="missed" data-hits="0" data-linenumber="216">
              <code class="sql">    else return pljson_list(); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">  member function to_char(spaces boolean default true, chars_per_line number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="221">
              <code class="sql">    if(spaces is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="222">
              <code class="sql">      return pljson_printer.pretty_print_list(self, line_length =&gt; chars_per_line);</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="224">
              <code class="sql">      return pljson_printer.pretty_print_list(self, spaces, line_length =&gt; chars_per_line);</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">  member procedure to_clob(self in pljson_list, buf in out nocopy clob, spaces boolean default false, chars_per_line number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="230">
              <code class="sql">    if(spaces is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="231">
              <code class="sql">      pljson_printer.pretty_print_list(self, false, buf, line_length =&gt; chars_per_line, erase_clob =&gt; erase_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="233">
              <code class="sql">      pljson_printer.pretty_print_list(self, spaces, buf, line_length =&gt; chars_per_line, erase_clob =&gt; erase_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">  member procedure print(self in pljson_list, spaces boolean default true, chars_per_line number default 8192, jsonp varchar2 default null) as --32512 is the real maximum in sqldeveloper</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="240">
              <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="241">
              <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="242">
              <code class="sql">    pljson_printer.pretty_print_list(self, spaces, my_clob, case when (chars_per_line&gt;32512) then 32512 else chars_per_line end);</code></li>
            <li class="missed" data-hits="0" data-linenumber="243">
              <code class="sql">    pljson_printer.dbms_output_clob(my_clob, pljson_printer.newline_char, jsonp);</code></li>
            <li class="missed" data-hits="0" data-linenumber="244">
              <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">  member procedure htp(self in pljson_list, spaces boolean default false, chars_per_line number default 0, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="250">
              <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="251">
              <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="252">
              <code class="sql">    pljson_printer.pretty_print_list(self, spaces, my_clob, chars_per_line);</code></li>
            <li class="missed" data-hits="0" data-linenumber="253">
              <code class="sql">    pljson_printer.htp_output_clob(my_clob, jsonp);</code></li>
            <li class="missed" data-hits="0" data-linenumber="254">
              <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">  /* json path */</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">  member function path(json_path varchar2, base number default 1) return pljson_value as</code></li>
            <li class="missed" data-hits="0" data-linenumber="259">
              <code class="sql">    cp pljson_list := self;</code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="261">
              <code class="sql">    return pljson_ext.get_json_value(pljson(cp), json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">  end path;</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">  /* json path_put */</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">  member procedure path_put(self in out nocopy pljson_list, json_path varchar2, elem pljson_value, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql">    objlist pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="268">
              <code class="sql">    jp pljson_list := pljson_ext.parsePath(json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="270">
              <code class="sql">    while(jp.head().get_number() &gt; self.count) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="271">
              <code class="sql">      self.append(pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="272">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="273">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="274">
              <code class="sql">    objlist := pljson(self);</code></li>
            <li class="missed" data-hits="0" data-linenumber="275">
              <code class="sql">    pljson_ext.put(objlist, json_path, elem, base);</code></li>
            <li class="missed" data-hits="0" data-linenumber="276">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="277">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="278">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="279">
            <code class="sql">  member procedure path_put(self in out nocopy pljson_list, json_path varchar2, elem varchar2, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="280">
            <code class="sql">    objlist pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="281">
              <code class="sql">    jp pljson_list := pljson_ext.parsePath(json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="283">
              <code class="sql">    while(jp.head().get_number() &gt; self.count) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="284">
              <code class="sql">      self.append(pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="286">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="287">
              <code class="sql">    objlist := pljson(self);</code></li>
            <li class="missed" data-hits="0" data-linenumber="288">
              <code class="sql">    pljson_ext.put(objlist, json_path, elem, base);</code></li>
            <li class="missed" data-hits="0" data-linenumber="289">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="292">
            <code class="sql">  member procedure path_put(self in out nocopy pljson_list, json_path varchar2, elem number, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="293">
            <code class="sql">    objlist pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="294">
              <code class="sql">    jp pljson_list := pljson_ext.parsePath(json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="296">
              <code class="sql">    while(jp.head().get_number() &gt; self.count) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="297">
              <code class="sql">      self.append(pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="299">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="300">
              <code class="sql">    objlist := pljson(self);</code></li>
            <li class="never" data-hits="" data-linenumber="301">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="302">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="303">
              <code class="sql">      pljson_ext.put(objlist, json_path, pljson_value, base);</code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="305">
              <code class="sql">      pljson_ext.put(objlist, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="307">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql">  member procedure path_put(self in out nocopy pljson_list, json_path varchar2, elem binary_double, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">    objlist pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="313">
              <code class="sql">    jp pljson_list := pljson_ext.parsePath(json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="314">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="315">
              <code class="sql">    while(jp.head().get_number() &gt; self.count) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="316">
              <code class="sql">      self.append(pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="317">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="318">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="319">
              <code class="sql">    objlist := pljson(self);</code></li>
            <li class="never" data-hits="" data-linenumber="320">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="321">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="322">
              <code class="sql">      pljson_ext.put(objlist, json_path, pljson_value, base);</code></li>
            <li class="never" data-hits="" data-linenumber="323">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="324">
              <code class="sql">      pljson_ext.put(objlist, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="325">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="326">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="327">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="328">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="329">
            <code class="sql">  member procedure path_put(self in out nocopy pljson_list, json_path varchar2, elem boolean, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="330">
            <code class="sql">    objlist pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="331">
              <code class="sql">    jp pljson_list := pljson_ext.parsePath(json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="332">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="333">
              <code class="sql">    while(jp.head().get_number() &gt; self.count) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="334">
              <code class="sql">      self.append(pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="335">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="336">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="337">
              <code class="sql">    objlist := pljson(self);</code></li>
            <li class="missed" data-hits="0" data-linenumber="338">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="339">
              <code class="sql">      pljson_ext.put(objlist, json_path, pljson_value, base);</code></li>
            <li class="never" data-hits="" data-linenumber="340">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="341">
              <code class="sql">      pljson_ext.put(objlist, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="342">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="343">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="344">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="345">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="346">
            <code class="sql">  member procedure path_put(self in out nocopy pljson_list, json_path varchar2, elem pljson_list, base number default 1) as</code></li>
            <li class="never" data-hits="" data-linenumber="347">
            <code class="sql">    objlist pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="348">
              <code class="sql">    jp pljson_list := pljson_ext.parsePath(json_path, base);</code></li>
            <li class="never" data-hits="" data-linenumber="349">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="350">
              <code class="sql">    while(jp.head().get_number() &gt; self.count) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="351">
              <code class="sql">      self.append(pljson_value());</code></li>
            <li class="never" data-hits="" data-linenumber="352">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="353">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="354">
              <code class="sql">    objlist := pljson(self);</code></li>
            <li class="missed" data-hits="0" data-linenumber="355">
              <code class="sql">    if(elem is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="356">
              <code class="sql">      pljson_ext.put(objlist, json_path, pljson_value, base);</code></li>
            <li class="never" data-hits="" data-linenumber="357">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="358">
              <code class="sql">      pljson_ext.put(objlist, json_path, elem, base);</code></li>
            <li class="never" data-hits="" data-linenumber="359">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="360">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="361">
            <code class="sql">  end path_put;</code></li>
            <li class="never" data-hits="" data-linenumber="362">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="363">
            <code class="sql">  /* json path_remove */</code></li>
            <li class="never" data-hits="" data-linenumber="364">
            <code class="sql">  member procedure path_remove(self in out nocopy pljson_list, json_path varchar2, base number default 1) as</code></li>
            <li class="missed" data-hits="0" data-linenumber="365">
              <code class="sql">    objlist pljson := pljson(self);</code></li>
            <li class="never" data-hits="" data-linenumber="366">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="367">
              <code class="sql">    pljson_ext.remove(objlist, json_path, base);</code></li>
            <li class="missed" data-hits="0" data-linenumber="368">
              <code class="sql">    self := objlist.get_values;</code></li>
            <li class="never" data-hits="" data-linenumber="369">
            <code class="sql">  end path_remove;</code></li>
            <li class="never" data-hits="" data-linenumber="370">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="371">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="372">
            <code class="sql">  member function to_json_value return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="373">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="7" data-linenumber="374">
              <span class="hits">7</span>
              <code class="sql">    return pljson_value(sys.anydata.convertobject(self));</code></li>
            <li class="never" data-hits="" data-linenumber="375">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="376">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="377">
            <code class="sql">  /* --backwards compatibility</code></li>
            <li class="never" data-hits="" data-linenumber="378">
            <code class="sql">  member procedure add_elem(self in out nocopy json_list, elem json_value, position pls_integer default null) as begin append(elem,position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="379">
            <code class="sql">  member procedure add_elem(self in out nocopy json_list, elem varchar2, position pls_integer default null) as begin append(elem,position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="380">
            <code class="sql">  member procedure add_elem(self in out nocopy json_list, elem number, position pls_integer default null) as begin append(elem,position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="381">
            <code class="sql">  member procedure add_elem(self in out nocopy json_list, elem boolean, position pls_integer default null) as begin append(elem,position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="382">
            <code class="sql">  member procedure add_elem(self in out nocopy json_list, elem json_list, position pls_integer default null) as begin append(elem,position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="383">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="384">
            <code class="sql">  member procedure set_elem(self in out nocopy json_list, position pls_integer, elem json_value) as begin replace(position,elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="385">
            <code class="sql">  member procedure set_elem(self in out nocopy json_list, position pls_integer, elem varchar2) as begin replace(position,elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="386">
            <code class="sql">  member procedure set_elem(self in out nocopy json_list, position pls_integer, elem number) as begin replace(position,elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="387">
            <code class="sql">  member procedure set_elem(self in out nocopy json_list, position pls_integer, elem boolean) as begin replace(position,elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="388">
            <code class="sql">  member procedure set_elem(self in out nocopy json_list, position pls_integer, elem json_list) as begin replace(position,elem); end;</code></li>
            <li class="never" data-hits="" data-linenumber="389">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="390">
            <code class="sql">  member procedure remove_elem(self in out nocopy json_list, position pls_integer) as begin remove(position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="391">
            <code class="sql">  member function get_elem(position pls_integer) return json_value as begin return get(position); end;</code></li>
            <li class="never" data-hits="" data-linenumber="392">
            <code class="sql">  member function get_first return json_value as begin return head(); end;</code></li>
            <li class="never" data-hits="" data-linenumber="393">
            <code class="sql">  member function get_last return json_value as begin return last(); end;</code></li>
            <li class="never" data-hits="" data-linenumber="394">
            <code class="sql">--*/</code></li>
            <li class="never" data-hits="" data-linenumber="395">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="396">
            <code class="sql">end;</code></li></ol></pre></div><div class="source_table" id="3E7A626619B4AC32F7A62560BD5BD119"><div class="header"> <h3>DEV.PLJSON_ML</h3><h4><span class="red">0 %</span> covered</h4><div> <b>269</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>269</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_ml as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">  function get_jsonml_stylesheet return xmltype;</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  function xml2json(xml in xmltype) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">    l_json        xmltype;</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">    l_returnvalue clob;</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">    l_json := xml.transform (get_jsonml_stylesheet);</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">    l_returnvalue := l_json.getclobval();</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">    l_returnvalue := dbms_xmlgen.convert (l_returnvalue, dbms_xmlgen.entity_decode);</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">    --dbms_output.put_line(l_returnvalue);</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">    return pljson_list(l_returnvalue);</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  end xml2json;</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  function xmlstr2json(xmlstr in varchar2) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">    return xml2json(xmltype(xmlstr));</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  end xmlstr2json;</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">  function get_jsonml_stylesheet return xmltype as</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">    if(jsonml_stylesheet is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">    jsonml_stylesheet := xmltype(&apos;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">&lt;!--</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">		JsonML.xslt</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">		Created: 2006-11-15-0551</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">		Modified: 2009-02-14-0927</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">		Released under an open-source license:</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">		http://jsonml.org/License.htm</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">		This transformation converts any XML document into JsonML.</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">		It omits processing-instructions and comment-nodes.</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">		To enable comment-nodes to be emitted as JavaScript comments,</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">		uncomment the Comment() template.</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">--&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql">&lt;xsl:stylesheet version=&quot;1.0&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">				xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">	&lt;xsl:output method=&quot;text&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">				media-type=&quot;application/json&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">				encoding=&quot;UTF-8&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">				indent=&quot;no&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">				omit-xml-declaration=&quot;yes&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">	&lt;!-- constants --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">	&lt;xsl:variable name=&quot;XHTML&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">				  select=&quot;&apos;&apos;http://www.w3.org/1999/xhtml&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">	&lt;xsl:variable name=&quot;START_ELEM&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">				  select=&quot;&apos;&apos;[&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">	&lt;xsl:variable name=&quot;END_ELEM&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">				  select=&quot;&apos;&apos;]&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">	&lt;xsl:variable name=&quot;VALUE_DELIM&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">				  select=&quot;&apos;&apos;,&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">	&lt;xsl:variable name=&quot;START_ATTRIB&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">				  select=&quot;&apos;&apos;{&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">	&lt;xsl:variable name=&quot;END_ATTRIB&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">				  select=&quot;&apos;&apos;}&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">	&lt;xsl:variable name=&quot;NAME_DELIM&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">				  select=&quot;&apos;&apos;:&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">	&lt;xsl:variable name=&quot;STRING_DELIM&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">				  select=&quot;&apos;&apos;&amp;#x22;&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">	&lt;xsl:variable name=&quot;START_COMMENT&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">				  select=&quot;&apos;&apos;/*&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">	&lt;xsl:variable name=&quot;END_COMMENT&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">				  select=&quot;&apos;&apos;*/&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">	&lt;!-- root-node --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">	&lt;xsl:template match=&quot;/&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">		&lt;xsl:apply-templates select=&quot;*&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">	&lt;!-- comments --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">	&lt;xsl:template match=&quot;comment()&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">	&lt;!-- uncomment to support JSON comments --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">	&lt;!--</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">		&lt;xsl:value-of select=&quot;$START_COMMENT&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">		&lt;xsl:value-of select=&quot;.&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">					  disable-output-escaping=&quot;yes&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">		&lt;xsl:value-of select=&quot;$END_COMMENT&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">	--&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">	&lt;!-- elements --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">	&lt;xsl:template match=&quot;*&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">		&lt;xsl:value-of select=&quot;$START_ELEM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">		&lt;!-- tag-name string --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">		&lt;xsl:value-of select=&quot;$STRING_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">		&lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">			&lt;xsl:when test=&quot;namespace-uri()=$XHTML&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">				&lt;xsl:value-of select=&quot;local-name()&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">			&lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">			&lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">				&lt;xsl:value-of select=&quot;name()&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">			&lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">		&lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">		&lt;xsl:value-of select=&quot;$STRING_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">		&lt;!-- attribute object --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">		&lt;xsl:if test=&quot;count(@*)&gt;0&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">			&lt;xsl:value-of select=&quot;$VALUE_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">			&lt;xsl:value-of select=&quot;$START_ATTRIB&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">			&lt;xsl:for-each select=&quot;@*&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">				&lt;xsl:if test=&quot;position()&gt;1&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">					&lt;xsl:value-of select=&quot;$VALUE_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">				&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">				&lt;xsl:apply-templates select=&quot;.&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">			&lt;/xsl:for-each&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">			&lt;xsl:value-of select=&quot;$END_ATTRIB&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">		&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">		&lt;!-- child elements and text-nodes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">		&lt;xsl:for-each select=&quot;*|text()&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">			&lt;xsl:value-of select=&quot;$VALUE_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">			&lt;xsl:apply-templates select=&quot;.&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">		&lt;/xsl:for-each&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">		&lt;xsl:value-of select=&quot;$END_ELEM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">	&lt;!-- text-nodes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">	&lt;xsl:template match=&quot;text()&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">		&lt;xsl:call-template name=&quot;escape-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">			&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">							select=&quot;.&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">		&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">	&lt;!-- attributes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql">	&lt;xsl:template match=&quot;@*&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">		&lt;xsl:value-of select=&quot;$STRING_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">		&lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">			&lt;xsl:when test=&quot;namespace-uri()=$XHTML&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">				&lt;xsl:value-of select=&quot;local-name()&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">			&lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">			&lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">				&lt;xsl:value-of select=&quot;name()&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">			&lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">		&lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">		&lt;xsl:value-of select=&quot;$STRING_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">		&lt;xsl:value-of select=&quot;$NAME_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">		&lt;xsl:call-template name=&quot;escape-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">			&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">							select=&quot;.&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">		&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">	&lt;!-- escape-string: quotes and escapes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">	&lt;xsl:template name=&quot;escape-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">		&lt;xsl:param name=&quot;value&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">		&lt;xsl:value-of select=&quot;$STRING_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">		&lt;xsl:if test=&quot;string-length($value)&gt;0&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">			&lt;xsl:variable name=&quot;escaped-whacks&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">				&lt;!-- escape backslashes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">				&lt;xsl:call-template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">					&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">									select=&quot;$value&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">					&lt;xsl:with-param name=&quot;find&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">									select=&quot;&apos;&apos;\&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">					&lt;xsl:with-param name=&quot;replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">									select=&quot;&apos;&apos;\\&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">				&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">			&lt;/xsl:variable&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">			&lt;xsl:variable name=&quot;escaped-LF&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">				&lt;!-- escape line feeds --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">				&lt;xsl:call-template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">					&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">									select=&quot;$escaped-whacks&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">					&lt;xsl:with-param name=&quot;find&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">									select=&quot;&apos;&apos;&amp;#x0A;&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">					&lt;xsl:with-param name=&quot;replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">									select=&quot;&apos;&apos;\n&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">				&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">			&lt;/xsl:variable&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">			&lt;xsl:variable name=&quot;escaped-CR&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">				&lt;!-- escape carriage returns --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">				&lt;xsl:call-template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">					&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">									select=&quot;$escaped-LF&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">					&lt;xsl:with-param name=&quot;find&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">									select=&quot;&apos;&apos;&amp;#x0D;&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">					&lt;xsl:with-param name=&quot;replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">									select=&quot;&apos;&apos;\r&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">				&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">			&lt;/xsl:variable&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">			&lt;xsl:variable name=&quot;escaped-tabs&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">				&lt;!-- escape tabs --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">				&lt;xsl:call-template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">					&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">									select=&quot;$escaped-CR&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">					&lt;xsl:with-param name=&quot;find&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">									select=&quot;&apos;&apos;&amp;#x09;&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">					&lt;xsl:with-param name=&quot;replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">									select=&quot;&apos;&apos;\t&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">				&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">			&lt;/xsl:variable&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">			&lt;!-- escape quotes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">			&lt;xsl:call-template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">				&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">								select=&quot;$escaped-tabs&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">				&lt;xsl:with-param name=&quot;find&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">								select=&quot;&apos;&apos;&amp;quot;&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">				&lt;xsl:with-param name=&quot;replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql">								select=&quot;&apos;&apos;\&amp;quot;&apos;&apos;&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">			&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">		&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">		&lt;xsl:value-of select=&quot;$STRING_DELIM&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">	&lt;!-- string-replace: replaces occurances of one string with another --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">	&lt;xsl:template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql">		&lt;xsl:param name=&quot;value&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">		&lt;xsl:param name=&quot;find&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql">		&lt;xsl:param name=&quot;replace&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">		&lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql">			&lt;xsl:when test=&quot;contains($value,$find)&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">				&lt;!-- replace and call recursively on next --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">				&lt;xsl:value-of select=&quot;substring-before($value,$find)&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">							  disable-output-escaping=&quot;yes&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">				&lt;xsl:value-of select=&quot;$replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql">							  disable-output-escaping=&quot;yes&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">				&lt;xsl:call-template name=&quot;string-replace&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql">					&lt;xsl:with-param name=&quot;value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql">									select=&quot;substring-after($value,$find)&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql">					&lt;xsl:with-param name=&quot;find&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">									select=&quot;$find&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="252">
            <code class="sql">					&lt;xsl:with-param name=&quot;replace&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql">									select=&quot;$replace&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql">				&lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql">			&lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql">			&lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">				&lt;!-- no replacement necessary --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">				&lt;xsl:value-of select=&quot;$value&quot;</code></li>
            <li class="never" data-hits="" data-linenumber="259">
            <code class="sql">							  disable-output-escaping=&quot;yes&quot; /&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">			&lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="261">
            <code class="sql">		&lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">	&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql">&lt;/xsl:stylesheet&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">    return jsonml_stylesheet;</code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql">  end get_jsonml_stylesheet;</code></li>
            <li class="never" data-hits="" data-linenumber="268">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql">end pljson_ml;</code></li></ol></pre></div><div class="source_table" id="B2E15073521A14742461D99C0EB3054D"><div class="header"> <h3>DEV.PLJSON_PARSER</h3><h4><span class="red">63.3 %</span> covered</h4><div> <b>436</b> relevant lines. <span class="green"><b>276</b> lines covered</span> and <span class="red"><b>160</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_parser as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  Copyright (c) 2009 Jonas Krogsboell</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  Permission is hereby granted, free of charge, to any person obtaining a copy</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  of this software and associated documentation files (the &quot;Software&quot;), to deal</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  in the Software without restriction, including without limitation the rights</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  copies of the Software, and to permit persons to whom the Software is</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">  furnished to do so, subject to the following conditions:</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">  The above copyright notice and this permission notice shall be included in</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  all copies or substantial portions of the Software.</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">  THE SOFTWARE.</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="24">
              <code class="sql">  decimalpoint varchar2(1 char) := &apos;.&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">  procedure updateDecimalPoint as</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="49" data-linenumber="28">
              <span class="hits">49</span>
              <code class="sql">    SELECT substr(VALUE,1,1) into decimalpoint FROM NLS_SESSION_PARAMETERS WHERE PARAMETER = &apos;NLS_NUMERIC_CHARACTERS&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  end updateDecimalPoint;</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  /* type json_src is record (len number, offset number, src varchar2(32767), s_clob clob); */</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">  /* assertions</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">    offset: contains 0-base offset of buffer,</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">      so 1-st entry is offset + 1, 4000-th entry = offset + 4000</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql">    src: contains offset + 1 .. offset + 4000, ex. 1..4000, 4001..8000, etc.</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">  function next_char(indx number, s in out nocopy json_src) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1049" data-linenumber="39">
              <span class="hits">1049</span>
              <code class="sql">    if(indx &gt; s.len) then return null; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">    --right offset?</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">    /*  if(indx &gt; 4000 + s.offset or indx &lt; s.offset) then */</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">    /* fix for issue #37 */</code></li>
            <li class="covered" data-hits="1045" data-linenumber="43">
              <span class="hits">1045</span>
              <code class="sql">    if(indx &gt; 4000 + s.offset or indx &lt;= s.offset) then</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">    --load right offset</code></li>
            <li class="covered" data-hits="2" data-linenumber="45">
              <span class="hits">2</span>
              <code class="sql">      s.offset := indx - (indx mod 4000);</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">      /* addon fix for issue #37 */</code></li>
            <li class="covered" data-hits="2" data-linenumber="47">
              <span class="hits">2</span>
              <code class="sql">      if s.offset = indx then</code></li>
            <li class="covered" data-hits="1" data-linenumber="48">
              <span class="hits">1</span>
              <code class="sql">        s.offset := s.offset - 4000;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">      end if;</code></li>
            <li class="covered" data-hits="2" data-linenumber="50">
              <span class="hits">2</span>
              <code class="sql">      s.src := dbms_lob.substr(s.s_clob, 4000, s.offset+1);</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">    --read from s.src</code></li>
            <li class="covered" data-hits="1045" data-linenumber="53">
              <span class="hits">1045</span>
              <code class="sql">    return substr(s.src, indx-s.offset, 1);</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  function next_char2(indx number, s in out nocopy json_src, amount number default 1) return varchar2 as</code></li>
            <li class="covered" data-hits="17" data-linenumber="57">
              <span class="hits">17</span>
              <code class="sql">    buf varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="90" data-linenumber="59">
              <span class="hits">90</span>
              <code class="sql">    for i in 1..amount loop</code></li>
            <li class="covered" data-hits="73" data-linenumber="60">
              <span class="hits">73</span>
              <code class="sql">      buf := buf || next_char(indx-1+i,s);</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">    end loop;</code></li>
            <li class="covered" data-hits="17" data-linenumber="62">
              <span class="hits">17</span>
              <code class="sql">    return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">  function prepareClob(buf clob) return pljson_parser.json_src as</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">    temp pljson_parser.json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="68">
              <span class="hits">1</span>
              <code class="sql">    temp.s_clob := buf;</code></li>
            <li class="covered" data-hits="1" data-linenumber="69">
              <span class="hits">1</span>
              <code class="sql">    temp.offset := 0;</code></li>
            <li class="covered" data-hits="1" data-linenumber="70">
              <span class="hits">1</span>
              <code class="sql">    temp.src := dbms_lob.substr(buf, 4000, temp.offset+1);</code></li>
            <li class="covered" data-hits="1" data-linenumber="71">
              <span class="hits">1</span>
              <code class="sql">    temp.len := dbms_lob.getlength(buf);</code></li>
            <li class="covered" data-hits="1" data-linenumber="72">
              <span class="hits">1</span>
              <code class="sql">    return temp;</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql">  function prepareVarchar2(buf varchar2) return pljson_parser.json_src as</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">    temp pljson_parser.json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="50" data-linenumber="78">
              <span class="hits">50</span>
              <code class="sql">    temp.s_clob := buf;</code></li>
            <li class="covered" data-hits="50" data-linenumber="79">
              <span class="hits">50</span>
              <code class="sql">    temp.offset := 0;</code></li>
            <li class="covered" data-hits="50" data-linenumber="80">
              <span class="hits">50</span>
              <code class="sql">    temp.src := substr(buf, 1, 4000);</code></li>
            <li class="covered" data-hits="50" data-linenumber="81">
              <span class="hits">50</span>
              <code class="sql">    temp.len := length(buf);</code></li>
            <li class="covered" data-hits="50" data-linenumber="82">
              <span class="hits">50</span>
              <code class="sql">    return temp;</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">  procedure debug(text varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">    dbms_output.put_line(text);</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">  procedure print_token(t rToken) as</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="92">
              <code class="sql">    dbms_output.put_line(&apos;Line: &apos;||t.line||&apos; - Column: &apos;||t.col||&apos; - Type: &apos;||t.type_name||&apos; - Content: &apos;||t.data);</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">  end print_token;</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  /* SCANNER FUNCTIONS START */</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">  procedure s_error(text varchar2, line number, col number) as</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="6" data-linenumber="98">
              <span class="hits">6</span>
              <code class="sql">    raise_application_error(-20100, &apos;JSON Scanner exception @ line: &apos;||line||&apos; column: &apos;||col||&apos; - &apos;||text);</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">  procedure s_error(text varchar2, tok rToken) as</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="8" data-linenumber="103">
              <span class="hits">8</span>
              <code class="sql">    raise_application_error(-20100, &apos;JSON Scanner exception @ line: &apos;||tok.line||&apos; column: &apos;||tok.col||&apos; - &apos;||text);</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">  function mt(t varchar2, l pls_integer, c pls_integer, d varchar2) return rToken as</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">    token rToken;</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="270" data-linenumber="109">
              <span class="hits">270</span>
              <code class="sql">    token.type_name := t;</code></li>
            <li class="covered" data-hits="270" data-linenumber="110">
              <span class="hits">270</span>
              <code class="sql">    token.line := l;</code></li>
            <li class="covered" data-hits="270" data-linenumber="111">
              <span class="hits">270</span>
              <code class="sql">    token.col := c;</code></li>
            <li class="covered" data-hits="270" data-linenumber="112">
              <span class="hits">270</span>
              <code class="sql">    token.data := d;</code></li>
            <li class="covered" data-hits="270" data-linenumber="113">
              <span class="hits">270</span>
              <code class="sql">    return token;</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">  function lexNumber(jsrc in out nocopy json_src, tok in out nocopy rToken, indx in out nocopy pls_integer) return pls_integer as</code></li>
            <li class="covered" data-hits="23" data-linenumber="117">
              <span class="hits">23</span>
              <code class="sql">    numbuf varchar2(4000) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">    buf varchar2(4);</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">    checkLoop boolean;</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="23" data-linenumber="121">
              <span class="hits">23</span>
              <code class="sql">    buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="23" data-linenumber="122">
              <span class="hits">23</span>
              <code class="sql">    if(buf = &apos;-&apos;) then numbuf := &apos;-&apos;; indx := indx + 1; end if;</code></li>
            <li class="covered" data-hits="23" data-linenumber="123">
              <span class="hits">23</span>
              <code class="sql">    buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">    --0 or [1-9]([0-9])*</code></li>
            <li class="covered" data-hits="23" data-linenumber="125">
              <span class="hits">23</span>
              <code class="sql">    if(buf = &apos;0&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="126">
              <code class="sql">      numbuf := numbuf || &apos;0&apos;; indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="127">
              <code class="sql">      buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="23" data-linenumber="128">
              <span class="hits">23</span>
              <code class="sql">    elsif(buf &gt;= &apos;1&apos; and buf &lt;= &apos;9&apos;) then</code></li>
            <li class="covered" data-hits="46" data-linenumber="129">
              <span class="hits">46</span>
              <code class="sql">      numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">      --read digits</code></li>
            <li class="covered" data-hits="23" data-linenumber="131">
              <span class="hits">23</span>
              <code class="sql">      buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="34" data-linenumber="132">
              <span class="hits">34</span>
              <code class="sql">      while(buf &gt;= &apos;0&apos; and buf &lt;= &apos;9&apos;) loop</code></li>
            <li class="covered" data-hits="22" data-linenumber="133">
              <span class="hits">22</span>
              <code class="sql">        numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="covered" data-hits="11" data-linenumber="134">
              <span class="hits">11</span>
              <code class="sql">        buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">    --fraction</code></li>
            <li class="covered" data-hits="23" data-linenumber="138">
              <span class="hits">23</span>
              <code class="sql">    if(buf = &apos;.&apos;) then</code></li>
            <li class="covered" data-hits="14" data-linenumber="139">
              <span class="hits">14</span>
              <code class="sql">      numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="covered" data-hits="7" data-linenumber="140">
              <span class="hits">7</span>
              <code class="sql">      buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="7" data-linenumber="141">
              <span class="hits">7</span>
              <code class="sql">      checkLoop := FALSE;</code></li>
            <li class="covered" data-hits="14" data-linenumber="142">
              <span class="hits">14</span>
              <code class="sql">      while(buf &gt;= &apos;0&apos; and buf &lt;= &apos;9&apos;) loop</code></li>
            <li class="covered" data-hits="7" data-linenumber="143">
              <span class="hits">7</span>
              <code class="sql">        checkLoop := TRUE;</code></li>
            <li class="covered" data-hits="14" data-linenumber="144">
              <span class="hits">14</span>
              <code class="sql">        numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="covered" data-hits="7" data-linenumber="145">
              <span class="hits">7</span>
              <code class="sql">        buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">      end loop;</code></li>
            <li class="covered" data-hits="7" data-linenumber="147">
              <span class="hits">7</span>
              <code class="sql">      if(not checkLoop) then</code></li>
            <li class="covered" data-hits="2" data-linenumber="148">
              <span class="hits">2</span>
              <code class="sql">        s_error(&apos;Expected: digits in fraction&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">    --exp part</code></li>
            <li class="covered" data-hits="21" data-linenumber="152">
              <span class="hits">21</span>
              <code class="sql">    if(buf in (&apos;e&apos;, &apos;E&apos;)) then</code></li>
            <li class="covered" data-hits="8" data-linenumber="153">
              <span class="hits">8</span>
              <code class="sql">      numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="covered" data-hits="4" data-linenumber="154">
              <span class="hits">4</span>
              <code class="sql">      buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="4" data-linenumber="155">
              <span class="hits">4</span>
              <code class="sql">      if(buf = &apos;+&apos; or buf = &apos;-&apos;) then</code></li>
            <li class="covered" data-hits="4" data-linenumber="156">
              <span class="hits">4</span>
              <code class="sql">        numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="covered" data-hits="2" data-linenumber="157">
              <span class="hits">2</span>
              <code class="sql">        buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">      end if;</code></li>
            <li class="covered" data-hits="4" data-linenumber="159">
              <span class="hits">4</span>
              <code class="sql">      checkLoop := FALSE;</code></li>
            <li class="covered" data-hits="8" data-linenumber="160">
              <span class="hits">8</span>
              <code class="sql">      while(buf &gt;= &apos;0&apos; and buf &lt;= &apos;9&apos;) loop</code></li>
            <li class="covered" data-hits="4" data-linenumber="161">
              <span class="hits">4</span>
              <code class="sql">        checkLoop := TRUE;</code></li>
            <li class="covered" data-hits="8" data-linenumber="162">
              <span class="hits">8</span>
              <code class="sql">        numbuf := numbuf || buf; indx := indx + 1;</code></li>
            <li class="covered" data-hits="4" data-linenumber="163">
              <span class="hits">4</span>
              <code class="sql">        buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">      end loop;</code></li>
            <li class="covered" data-hits="4" data-linenumber="165">
              <span class="hits">4</span>
              <code class="sql">      if(not checkLoop) then</code></li>
            <li class="covered" data-hits="2" data-linenumber="166">
              <span class="hits">2</span>
              <code class="sql">        s_error(&apos;Expected: digits in exp&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql"></code></li>
            <li class="covered" data-hits="19" data-linenumber="170">
              <span class="hits">19</span>
              <code class="sql">    tok.data := numbuf;</code></li>
            <li class="covered" data-hits="19" data-linenumber="171">
              <span class="hits">19</span>
              <code class="sql">    return indx;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">  end lexNumber;</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">  -- [a-zA-Z]([a-zA-Z0-9])*</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">  function lexName(jsrc in out nocopy json_src, tok in out nocopy rToken, indx in out nocopy pls_integer) return pls_integer as</code></li>
            <li class="missed" data-hits="0" data-linenumber="176">
              <code class="sql">    varbuf varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">    buf varchar(4);</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">    num number;</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="180">
              <code class="sql">    buf := next_char(indx, jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="181">
              <code class="sql">    while(REGEXP_LIKE(buf, &apos;^[[:alnum:]\_]$&apos;, &apos;i&apos;)) loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="182">
              <code class="sql">      varbuf := varbuf || buf;</code></li>
            <li class="missed" data-hits="0" data-linenumber="183">
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="184">
              <code class="sql">      buf := next_char(indx, jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="185">
              <code class="sql">      if (buf is null) then</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">        goto retname;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">        --debug(&apos;Premature string ending&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">    &lt;&lt;retname&gt;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">    --could check for reserved keywords here</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">    --debug(varbuf);</code></li>
            <li class="missed" data-hits="0" data-linenumber="194">
              <code class="sql">    tok.data := varbuf;</code></li>
            <li class="missed" data-hits="0" data-linenumber="195">
              <code class="sql">    return indx-1;</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">  end lexName;</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">  procedure updateClob(v_extended in out nocopy clob, v_str varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="200">
              <code class="sql">    dbms_lob.writeappend(v_extended, length(v_str), v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">  end updateClob;</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">  function lexString(jsrc in out nocopy json_src, tok in out nocopy rToken, indx in out nocopy pls_integer, endChar char) return pls_integer as</code></li>
            <li class="covered" data-hits="130" data-linenumber="204">
              <span class="hits">130</span>
              <code class="sql">    v_extended clob := null; v_count number := 0;</code></li>
            <li class="covered" data-hits="65" data-linenumber="205">
              <span class="hits">65</span>
              <code class="sql">    varbuf varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">    buf varchar(4);</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">    wrong boolean;</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="65" data-linenumber="209">
              <span class="hits">65</span>
              <code class="sql">    indx := indx +1;</code></li>
            <li class="covered" data-hits="65" data-linenumber="210">
              <span class="hits">65</span>
              <code class="sql">    buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="398" data-linenumber="211">
              <span class="hits">398</span>
              <code class="sql">    while(buf != endChar) loop</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">      --clob control</code></li>
            <li class="covered" data-hits="336" data-linenumber="213">
              <span class="hits">336</span>
              <code class="sql">      if(v_count &gt; 8191) then --crazy oracle error (16383 is the highest working length with unistr - 8192 choosen to be safe)</code></li>
            <li class="missed" data-hits="0" data-linenumber="214">
              <code class="sql">        if(v_extended is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="215">
              <code class="sql">          v_extended := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="216">
              <code class="sql">          dbms_lob.createtemporary(v_extended, true);</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">        end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="218">
              <code class="sql">        updateClob(v_extended, unistr(varbuf));</code></li>
            <li class="missed" data-hits="0" data-linenumber="219">
              <code class="sql">        varbuf := &apos;&apos;; v_count := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">      end if;</code></li>
            <li class="covered" data-hits="336" data-linenumber="221">
              <span class="hits">336</span>
              <code class="sql">      if(buf = Chr(13) or buf = CHR(9) or buf = CHR(10)) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="222">
              <code class="sql">        s_error(&apos;Control characters not allowed (CHR(9),CHR(10)CHR(13))&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="224">
              <code class="sql">      if(buf = &apos;\&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">        --varbuf := varbuf || buf;</code></li>
            <li class="covered" data-hits="12" data-linenumber="226">
              <span class="hits">12</span>
              <code class="sql">        indx := indx + 1;</code></li>
            <li class="covered" data-hits="12" data-linenumber="227">
              <span class="hits">12</span>
              <code class="sql">        buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="12" data-linenumber="228">
              <span class="hits">12</span>
              <code class="sql">        case</code></li>
            <li class="covered" data-hits="12" data-linenumber="229">
              <span class="hits">12</span>
              <code class="sql">          when buf in (&apos;\&apos;) then</code></li>
            <li class="covered" data-hits="2" data-linenumber="230">
              <span class="hits">2</span>
              <code class="sql">            varbuf := varbuf || buf || buf; v_count := v_count + 2;</code></li>
            <li class="covered" data-hits="1" data-linenumber="231">
              <span class="hits">1</span>
              <code class="sql">            indx := indx + 1;</code></li>
            <li class="covered" data-hits="1" data-linenumber="232">
              <span class="hits">1</span>
              <code class="sql">            buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="11" data-linenumber="233">
              <span class="hits">11</span>
              <code class="sql">          when buf in (&apos;&quot;&apos;, &apos;/&apos;) then</code></li>
            <li class="covered" data-hits="4" data-linenumber="234">
              <span class="hits">4</span>
              <code class="sql">            varbuf := varbuf || buf; v_count := v_count + 1;</code></li>
            <li class="covered" data-hits="2" data-linenumber="235">
              <span class="hits">2</span>
              <code class="sql">            indx := indx + 1;</code></li>
            <li class="covered" data-hits="2" data-linenumber="236">
              <span class="hits">2</span>
              <code class="sql">            buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="9" data-linenumber="237">
              <span class="hits">9</span>
              <code class="sql">          when buf = &apos;&apos;&apos;&apos; then</code></li>
            <li class="missed" data-hits="0" data-linenumber="238">
              <code class="sql">            if(json_strict = false) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="239">
              <code class="sql">              varbuf := varbuf || buf; v_count := v_count + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="240">
              <code class="sql">              indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="241">
              <code class="sql">              buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">            else</code></li>
            <li class="missed" data-hits="0" data-linenumber="243">
              <code class="sql">              s_error(&apos;strictmode - expected: &quot; \ / b f n r t u &apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">            end if;</code></li>
            <li class="covered" data-hits="9" data-linenumber="245">
              <span class="hits">9</span>
              <code class="sql">          when buf in (&apos;b&apos;, &apos;f&apos;, &apos;n&apos;, &apos;r&apos;, &apos;t&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql">            --backspace b = U+0008</code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">            --formfeed  f = U+000C</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql">            --newline   n = U+000A</code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql">            --carret    r = U+000D</code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql">            --tabulator t = U+0009</code></li>
            <li class="covered" data-hits="5" data-linenumber="251">
              <span class="hits">5</span>
              <code class="sql">            case buf</code></li>
            <li class="covered" data-hits="6" data-linenumber="252">
              <span class="hits">6</span>
              <code class="sql">            when &apos;b&apos; then varbuf := varbuf || chr(8);</code></li>
            <li class="covered" data-hits="5" data-linenumber="253">
              <span class="hits">5</span>
              <code class="sql">            when &apos;f&apos; then varbuf := varbuf || chr(12);</code></li>
            <li class="covered" data-hits="4" data-linenumber="254">
              <span class="hits">4</span>
              <code class="sql">            when &apos;n&apos; then varbuf := varbuf || chr(10);</code></li>
            <li class="covered" data-hits="3" data-linenumber="255">
              <span class="hits">3</span>
              <code class="sql">            when &apos;r&apos; then varbuf := varbuf || chr(13);</code></li>
            <li class="covered" data-hits="2" data-linenumber="256">
              <span class="hits">2</span>
              <code class="sql">            when &apos;t&apos; then varbuf := varbuf || chr(9);</code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">            end case;</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">            --varbuf := varbuf || buf;</code></li>
            <li class="covered" data-hits="5" data-linenumber="259">
              <span class="hits">5</span>
              <code class="sql">            v_count := v_count + 1;</code></li>
            <li class="covered" data-hits="5" data-linenumber="260">
              <span class="hits">5</span>
              <code class="sql">            indx := indx + 1;</code></li>
            <li class="covered" data-hits="5" data-linenumber="261">
              <span class="hits">5</span>
              <code class="sql">            buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="4" data-linenumber="262">
              <span class="hits">4</span>
              <code class="sql">          when buf = &apos;u&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql">            --four hexidecimal chars</code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql">            declare</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">              four varchar2(4);</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">            begin</code></li>
            <li class="covered" data-hits="3" data-linenumber="267">
              <span class="hits">3</span>
              <code class="sql">              four := next_char2(indx+1, jsrc, 4);</code></li>
            <li class="covered" data-hits="3" data-linenumber="268">
              <span class="hits">3</span>
              <code class="sql">              wrong := FALSE;</code></li>
            <li class="covered" data-hits="3" data-linenumber="269">
              <span class="hits">3</span>
              <code class="sql">              if(upper(substr(four, 1,1)) not in (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;,&apos;e&apos;,&apos;f&apos;)) then wrong := TRUE; end if;</code></li>
            <li class="covered" data-hits="3" data-linenumber="270">
              <span class="hits">3</span>
              <code class="sql">              if(upper(substr(four, 2,1)) not in (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;,&apos;e&apos;,&apos;f&apos;)) then wrong := TRUE; end if;</code></li>
            <li class="covered" data-hits="3" data-linenumber="271">
              <span class="hits">3</span>
              <code class="sql">              if(upper(substr(four, 3,1)) not in (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;,&apos;e&apos;,&apos;f&apos;)) then wrong := TRUE; end if;</code></li>
            <li class="covered" data-hits="5" data-linenumber="272">
              <span class="hits">5</span>
              <code class="sql">              if(upper(substr(four, 4,1)) not in (&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;,&apos;A&apos;,&apos;B&apos;,&apos;C&apos;,&apos;D&apos;,&apos;E&apos;,&apos;F&apos;,&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;,&apos;e&apos;,&apos;f&apos;)) then wrong := TRUE; end if;</code></li>
            <li class="covered" data-hits="3" data-linenumber="273">
              <span class="hits">3</span>
              <code class="sql">              if(wrong) then</code></li>
            <li class="covered" data-hits="2" data-linenumber="274">
              <span class="hits">2</span>
              <code class="sql">                s_error(&apos;expected: &quot; \u([0-9][A-F]){4}&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="275">
            <code class="sql">              end if;</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">              --varbuf := varbuf || buf || four;</code></li>
            <li class="covered" data-hits="1" data-linenumber="277">
              <span class="hits">1</span>
              <code class="sql">              varbuf := varbuf || &apos;\&apos;||four; --chr(to_number(four,&apos;XXXX&apos;));</code></li>
            <li class="covered" data-hits="1" data-linenumber="278">
              <span class="hits">1</span>
              <code class="sql">              v_count := v_count + 5;</code></li>
            <li class="covered" data-hits="1" data-linenumber="279">
              <span class="hits">1</span>
              <code class="sql">              indx := indx + 5;</code></li>
            <li class="covered" data-hits="1" data-linenumber="280">
              <span class="hits">1</span>
              <code class="sql">              buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="281">
            <code class="sql">              end;</code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">          else</code></li>
            <li class="covered" data-hits="1" data-linenumber="283">
              <span class="hits">1</span>
              <code class="sql">            s_error(&apos;expected: &quot; \ / b f n r t u &apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="284">
            <code class="sql">        end case;</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">      else</code></li>
            <li class="covered" data-hits="648" data-linenumber="286">
              <span class="hits">648</span>
              <code class="sql">        varbuf := varbuf || buf; v_count := v_count + 1;</code></li>
            <li class="covered" data-hits="324" data-linenumber="287">
              <span class="hits">324</span>
              <code class="sql">        indx := indx + 1;</code></li>
            <li class="covered" data-hits="324" data-linenumber="288">
              <span class="hits">324</span>
              <code class="sql">        buf := next_char(indx, jsrc);</code></li>
            <li class="never" data-hits="" data-linenumber="289">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql"></code></li>
            <li class="covered" data-hits="62" data-linenumber="292">
              <span class="hits">62</span>
              <code class="sql">    if (buf is null) then</code></li>
            <li class="covered" data-hits="1" data-linenumber="293">
              <span class="hits">1</span>
              <code class="sql">      s_error(&apos;string ending not found&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="294">
            <code class="sql">      --debug(&apos;Premature string ending&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="296">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="297">
            <code class="sql">    --debug(varbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql">    --dbms_output.put_line(varbuf);</code></li>
            <li class="missed" data-hits="0" data-linenumber="299">
              <code class="sql">    if(v_extended is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="300">
              <code class="sql">      updateClob(v_extended, unistr(varbuf));</code></li>
            <li class="missed" data-hits="0" data-linenumber="301">
              <code class="sql">      tok.data_overflow := v_extended;</code></li>
            <li class="missed" data-hits="0" data-linenumber="302">
              <code class="sql">      tok.data := dbms_lob.substr(v_extended, 1, 32767);</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql">    else</code></li>
            <li class="covered" data-hits="61" data-linenumber="304">
              <span class="hits">61</span>
              <code class="sql">      tok.data := unistr(varbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql">    end if;</code></li>
            <li class="covered" data-hits="61" data-linenumber="306">
              <span class="hits">61</span>
              <code class="sql">    return indx;</code></li>
            <li class="never" data-hits="" data-linenumber="307">
            <code class="sql">  end lexString;</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql">  /* scanner tokens:</code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">    &apos;{&apos;, &apos;}&apos;, &apos;,&apos;, &apos;:&apos;, &apos;[&apos;, &apos;]&apos;, STRING, NUMBER, TRUE, FALSE, NULL</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">  function lexer(jsrc in out nocopy json_src) return lTokens as</code></li>
            <li class="never" data-hits="" data-linenumber="313">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="covered" data-hits="50" data-linenumber="314">
              <span class="hits">50</span>
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="covered" data-hits="50" data-linenumber="315">
              <span class="hits">50</span>
              <code class="sql">    tok_indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="316">
            <code class="sql">    buf varchar2(4);</code></li>
            <li class="covered" data-hits="50" data-linenumber="317">
              <span class="hits">50</span>
              <code class="sql">    lin_no number := 1;</code></li>
            <li class="covered" data-hits="50" data-linenumber="318">
              <span class="hits">50</span>
              <code class="sql">    col_no number := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="319">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="485" data-linenumber="320">
              <span class="hits">485</span>
              <code class="sql">    while (indx &lt;= jsrc.len) loop</code></li>
            <li class="never" data-hits="" data-linenumber="321">
            <code class="sql">      --read into buf</code></li>
            <li class="covered" data-hits="449" data-linenumber="322">
              <span class="hits">449</span>
              <code class="sql">      buf := next_char(indx, jsrc);</code></li>
            <li class="covered" data-hits="449" data-linenumber="323">
              <span class="hits">449</span>
              <code class="sql">      col_no := col_no + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="324">
            <code class="sql">      --convert to switch case</code></li>
            <li class="covered" data-hits="449" data-linenumber="325">
              <span class="hits">449</span>
              <code class="sql">      case</code></li>
            <li class="covered" data-hits="547" data-linenumber="326">
              <span class="hits">547</span>
              <code class="sql">        when buf = &apos;{&apos; then tokens(tok_indx) := mt(&apos;{&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="462" data-linenumber="327">
              <span class="hits">462</span>
              <code class="sql">        when buf = &apos;}&apos; then tokens(tok_indx) := mt(&apos;}&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="401" data-linenumber="328">
              <span class="hits">401</span>
              <code class="sql">        when buf = &apos;,&apos; then tokens(tok_indx) := mt(&apos;,&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="455" data-linenumber="329">
              <span class="hits">455</span>
              <code class="sql">        when buf = &apos;:&apos; then tokens(tok_indx) := mt(&apos;:&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="330" data-linenumber="330">
              <span class="hits">330</span>
              <code class="sql">        when buf = &apos;[&apos; then tokens(tok_indx) := mt(&apos;[&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="308" data-linenumber="331">
              <span class="hits">308</span>
              <code class="sql">        when buf = &apos;]&apos; then tokens(tok_indx) := mt(&apos;]&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="278" data-linenumber="332">
              <span class="hits">278</span>
              <code class="sql">        when buf = &apos;t&apos; then</code></li>
            <li class="covered" data-hits="7" data-linenumber="333">
              <span class="hits">7</span>
              <code class="sql">          if(next_char2(indx, jsrc, 4) != &apos;true&apos;) then</code></li>
            <li class="covered" data-hits="1" data-linenumber="334">
              <span class="hits">1</span>
              <code class="sql">            if(json_strict = false and REGEXP_LIKE(buf, &apos;^[[:alpha:]]$&apos;, &apos;i&apos;)) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="335">
              <code class="sql">              tokens(tok_indx) := mt(&apos;STRING&apos;, lin_no, col_no, null);</code></li>
            <li class="missed" data-hits="0" data-linenumber="336">
              <code class="sql">              indx := lexName(jsrc, tokens(tok_indx), indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="337">
              <code class="sql">              col_no := col_no + length(tokens(tok_indx).data) + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="338">
              <code class="sql">              tok_indx := tok_indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="339">
            <code class="sql">            else</code></li>
            <li class="covered" data-hits="1" data-linenumber="340">
              <span class="hits">1</span>
              <code class="sql">              s_error(&apos;Expected: &apos;&apos;true&apos;&apos;&apos;, lin_no, col_no);</code></li>
            <li class="never" data-hits="" data-linenumber="341">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="342">
            <code class="sql">          else</code></li>
            <li class="covered" data-hits="12" data-linenumber="343">
              <span class="hits">12</span>
              <code class="sql">            tokens(tok_indx) := mt(&apos;TRUE&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="6" data-linenumber="344">
              <span class="hits">6</span>
              <code class="sql">            indx := indx + 3;</code></li>
            <li class="covered" data-hits="6" data-linenumber="345">
              <span class="hits">6</span>
              <code class="sql">            col_no := col_no + 3;</code></li>
            <li class="never" data-hits="" data-linenumber="346">
            <code class="sql">          end if;</code></li>
            <li class="covered" data-hits="271" data-linenumber="347">
              <span class="hits">271</span>
              <code class="sql">        when buf = &apos;n&apos; then</code></li>
            <li class="covered" data-hits="2" data-linenumber="348">
              <span class="hits">2</span>
              <code class="sql">          if(next_char2(indx, jsrc, 4) != &apos;null&apos;) then</code></li>
            <li class="covered" data-hits="1" data-linenumber="349">
              <span class="hits">1</span>
              <code class="sql">            if(json_strict = false and REGEXP_LIKE(buf, &apos;^[[:alpha:]]$&apos;, &apos;i&apos;)) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="350">
              <code class="sql">              tokens(tok_indx) := mt(&apos;STRING&apos;, lin_no, col_no, null);</code></li>
            <li class="missed" data-hits="0" data-linenumber="351">
              <code class="sql">              indx := lexName(jsrc, tokens(tok_indx), indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="352">
              <code class="sql">              col_no := col_no + length(tokens(tok_indx).data) + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="353">
              <code class="sql">              tok_indx := tok_indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="354">
            <code class="sql">            else</code></li>
            <li class="covered" data-hits="1" data-linenumber="355">
              <span class="hits">1</span>
              <code class="sql">              s_error(&apos;Expected: &apos;&apos;null&apos;&apos;&apos;, lin_no, col_no);</code></li>
            <li class="never" data-hits="" data-linenumber="356">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="357">
            <code class="sql">          else</code></li>
            <li class="covered" data-hits="2" data-linenumber="358">
              <span class="hits">2</span>
              <code class="sql">            tokens(tok_indx) := mt(&apos;NULL&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="1" data-linenumber="359">
              <span class="hits">1</span>
              <code class="sql">            indx := indx + 3;</code></li>
            <li class="covered" data-hits="1" data-linenumber="360">
              <span class="hits">1</span>
              <code class="sql">            col_no := col_no + 3;</code></li>
            <li class="never" data-hits="" data-linenumber="361">
            <code class="sql">          end if;</code></li>
            <li class="covered" data-hits="269" data-linenumber="362">
              <span class="hits">269</span>
              <code class="sql">        when buf = &apos;f&apos; then</code></li>
            <li class="covered" data-hits="5" data-linenumber="363">
              <span class="hits">5</span>
              <code class="sql">          if(next_char2(indx, jsrc, 5) != &apos;false&apos;) then</code></li>
            <li class="covered" data-hits="1" data-linenumber="364">
              <span class="hits">1</span>
              <code class="sql">            if(json_strict = false and REGEXP_LIKE(buf, &apos;^[[:alpha:]]$&apos;, &apos;i&apos;)) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="365">
              <code class="sql">              tokens(tok_indx) := mt(&apos;STRING&apos;, lin_no, col_no, null);</code></li>
            <li class="missed" data-hits="0" data-linenumber="366">
              <code class="sql">              indx := lexName(jsrc, tokens(tok_indx), indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="367">
              <code class="sql">              col_no := col_no + length(tokens(tok_indx).data) + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="368">
              <code class="sql">              tok_indx := tok_indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="369">
            <code class="sql">            else</code></li>
            <li class="covered" data-hits="1" data-linenumber="370">
              <span class="hits">1</span>
              <code class="sql">              s_error(&apos;Expected: &apos;&apos;false&apos;&apos;&apos;, lin_no, col_no);</code></li>
            <li class="never" data-hits="" data-linenumber="371">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="372">
            <code class="sql">          else</code></li>
            <li class="covered" data-hits="8" data-linenumber="373">
              <span class="hits">8</span>
              <code class="sql">            tokens(tok_indx) := mt(&apos;FALSE&apos;, lin_no, col_no, null); tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="4" data-linenumber="374">
              <span class="hits">4</span>
              <code class="sql">            indx := indx + 4;</code></li>
            <li class="covered" data-hits="4" data-linenumber="375">
              <span class="hits">4</span>
              <code class="sql">            col_no := col_no + 4;</code></li>
            <li class="never" data-hits="" data-linenumber="376">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="377">
            <code class="sql">        /* -- 9 = TAB, 10 = \n, 13 = \r (Linux = \n, Windows = \r\n, Mac = \r */</code></li>
            <li class="covered" data-hits="264" data-linenumber="378">
              <span class="hits">264</span>
              <code class="sql">        when (buf = Chr(10)) then --linux newlines</code></li>
            <li class="covered" data-hits="6" data-linenumber="379">
              <span class="hits">6</span>
              <code class="sql">          lin_no := lin_no + 1;</code></li>
            <li class="covered" data-hits="6" data-linenumber="380">
              <span class="hits">6</span>
              <code class="sql">          col_no := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="381">
            <code class="sql"></code></li>
            <li class="covered" data-hits="258" data-linenumber="382">
              <span class="hits">258</span>
              <code class="sql">        when (buf = Chr(13)) then --Windows or Mac way</code></li>
            <li class="missed" data-hits="0" data-linenumber="383">
              <code class="sql">          lin_no := lin_no + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="384">
              <code class="sql">          col_no := 0;</code></li>
            <li class="missed" data-hits="0" data-linenumber="385">
              <code class="sql">          if(jsrc.len &gt;= indx +1) then -- better safe than sorry</code></li>
            <li class="missed" data-hits="0" data-linenumber="386">
              <code class="sql">            buf := next_char(indx+1, jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="387">
              <code class="sql">            if(buf = Chr(10)) then --\r\n</code></li>
            <li class="missed" data-hits="0" data-linenumber="388">
              <code class="sql">              indx := indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="389">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="390">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="391">
            <code class="sql"></code></li>
            <li class="covered" data-hits="258" data-linenumber="392">
              <span class="hits">258</span>
              <code class="sql">        when (buf = CHR(9)) then null; --tabbing</code></li>
            <li class="covered" data-hits="258" data-linenumber="393">
              <span class="hits">258</span>
              <code class="sql">        when (buf in (&apos;-&apos;, &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;)) then --number</code></li>
            <li class="covered" data-hits="23" data-linenumber="394">
              <span class="hits">23</span>
              <code class="sql">          tokens(tok_indx) := mt(&apos;NUMBER&apos;, lin_no, col_no, null);</code></li>
            <li class="covered" data-hits="23" data-linenumber="395">
              <span class="hits">23</span>
              <code class="sql">          indx := lexNumber(jsrc, tokens(tok_indx), indx)-1;</code></li>
            <li class="covered" data-hits="19" data-linenumber="396">
              <span class="hits">19</span>
              <code class="sql">          col_no := col_no + length(tokens(tok_indx).data);</code></li>
            <li class="covered" data-hits="19" data-linenumber="397">
              <span class="hits">19</span>
              <code class="sql">          tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="235" data-linenumber="398">
              <span class="hits">235</span>
              <code class="sql">        when buf = &apos;&quot;&apos; then --number</code></li>
            <li class="covered" data-hits="65" data-linenumber="399">
              <span class="hits">65</span>
              <code class="sql">          tokens(tok_indx) := mt(&apos;STRING&apos;, lin_no, col_no, null);</code></li>
            <li class="covered" data-hits="65" data-linenumber="400">
              <span class="hits">65</span>
              <code class="sql">          indx := lexString(jsrc, tokens(tok_indx), indx, &apos;&quot;&apos;);</code></li>
            <li class="covered" data-hits="61" data-linenumber="401">
              <span class="hits">61</span>
              <code class="sql">          col_no := col_no + length(tokens(tok_indx).data) + 1;</code></li>
            <li class="covered" data-hits="61" data-linenumber="402">
              <span class="hits">61</span>
              <code class="sql">          tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="170" data-linenumber="403">
              <span class="hits">170</span>
              <code class="sql">        when buf = &apos;&apos;&apos;&apos; and json_strict = false then --number</code></li>
            <li class="missed" data-hits="0" data-linenumber="404">
              <code class="sql">          tokens(tok_indx) := mt(&apos;STRING&apos;, lin_no, col_no, null);</code></li>
            <li class="missed" data-hits="0" data-linenumber="405">
              <code class="sql">          indx := lexString(jsrc, tokens(tok_indx), indx, &apos;&apos;&apos;&apos;);</code></li>
            <li class="missed" data-hits="0" data-linenumber="406">
              <code class="sql">          col_no := col_no + length(tokens(tok_indx).data) + 1; --hovsa her</code></li>
            <li class="missed" data-hits="0" data-linenumber="407">
              <code class="sql">          tok_indx := tok_indx + 1;</code></li>
            <li class="covered" data-hits="170" data-linenumber="408">
              <span class="hits">170</span>
              <code class="sql">        when json_strict = false and REGEXP_LIKE(buf, &apos;^[[:alpha:]]$&apos;, &apos;i&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="409">
              <code class="sql">          tokens(tok_indx) := mt(&apos;STRING&apos;, lin_no, col_no, null);</code></li>
            <li class="missed" data-hits="0" data-linenumber="410">
              <code class="sql">          indx := lexName(jsrc, tokens(tok_indx), indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="411">
              <code class="sql">          if(tokens(tok_indx).data_overflow is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="412">
              <code class="sql">            col_no := col_no + dbms_lob.getlength(tokens(tok_indx).data_overflow) + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="413">
            <code class="sql">          else</code></li>
            <li class="missed" data-hits="0" data-linenumber="414">
              <code class="sql">            col_no := col_no + length(tokens(tok_indx).data) + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="415">
            <code class="sql">          end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="416">
              <code class="sql">          tok_indx := tok_indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="417">
              <code class="sql">        when json_strict = false and buf||next_char(indx+1, jsrc) = &apos;/*&apos; then --strip comments</code></li>
            <li class="never" data-hits="" data-linenumber="418">
            <code class="sql">          declare</code></li>
            <li class="missed" data-hits="0" data-linenumber="419">
              <code class="sql">            saveindx number := indx;</code></li>
            <li class="never" data-hits="" data-linenumber="420">
            <code class="sql">            un_esc clob;</code></li>
            <li class="never" data-hits="" data-linenumber="421">
            <code class="sql">          begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="422">
              <code class="sql">            indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="423">
              <code class="sql">            loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="424">
              <code class="sql">              indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="425">
              <code class="sql">              buf := next_char(indx, jsrc)||next_char(indx+1, jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="426">
              <code class="sql">              exit when buf = &apos;*/&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="427">
              <code class="sql">              exit when buf is null;</code></li>
            <li class="never" data-hits="" data-linenumber="428">
            <code class="sql">            end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="429">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="430">
              <code class="sql">            if(indx = saveindx+2) then</code></li>
            <li class="never" data-hits="" data-linenumber="431">
            <code class="sql">              --enter unescaped mode</code></li>
            <li class="never" data-hits="" data-linenumber="432">
            <code class="sql">              --dbms_output.put_line(&apos;Entering unescaped mode&apos;);</code></li>
            <li class="missed" data-hits="0" data-linenumber="433">
              <code class="sql">              un_esc := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="434">
              <code class="sql">              dbms_lob.createtemporary(un_esc, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="435">
              <code class="sql">              indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="436">
              <code class="sql">              loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="437">
              <code class="sql">                indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="438">
              <code class="sql">                buf := next_char(indx, jsrc)||next_char(indx+1, jsrc)||next_char(indx+2, jsrc)||next_char(indx+3, jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="439">
              <code class="sql">                exit when buf = &apos;/**/&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="440">
              <code class="sql">                if buf is null then</code></li>
            <li class="missed" data-hits="0" data-linenumber="441">
              <code class="sql">                  s_error(&apos;Unexpected sequence /**/ to end unescaped data: &apos;||buf, lin_no, col_no);</code></li>
            <li class="never" data-hits="" data-linenumber="442">
            <code class="sql">                end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="443">
              <code class="sql">                buf := next_char(indx, jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="444">
              <code class="sql">                dbms_lob.writeappend(un_esc, length(buf), buf);</code></li>
            <li class="never" data-hits="" data-linenumber="445">
            <code class="sql">              end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="446">
              <code class="sql">              tokens(tok_indx) := mt(&apos;ESTRING&apos;, lin_no, col_no, null);</code></li>
            <li class="missed" data-hits="0" data-linenumber="447">
              <code class="sql">              tokens(tok_indx).data_overflow := un_esc;</code></li>
            <li class="missed" data-hits="0" data-linenumber="448">
              <code class="sql">              col_no := col_no + dbms_lob.getlength(un_esc) + 1; --note: line count won&apos;t work properly</code></li>
            <li class="missed" data-hits="0" data-linenumber="449">
              <code class="sql">              tok_indx := tok_indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="450">
              <code class="sql">              indx := indx + 2;</code></li>
            <li class="never" data-hits="" data-linenumber="451">
            <code class="sql">            end if;</code></li>
            <li class="never" data-hits="" data-linenumber="452">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="453">
            <code class="sql">            indx := indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="454">
            <code class="sql">          end;</code></li>
            <li class="covered" data-hits="170" data-linenumber="455">
              <span class="hits">170</span>
              <code class="sql">        when buf = &apos; &apos; then null; --space</code></li>
            <li class="never" data-hits="" data-linenumber="456">
            <code class="sql">        else</code></li>
            <li class="covered" data-hits="3" data-linenumber="457">
              <span class="hits">3</span>
              <code class="sql">          s_error(&apos;Unexpected char: &apos;||buf, lin_no, col_no);</code></li>
            <li class="never" data-hits="" data-linenumber="458">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="459">
            <code class="sql"></code></li>
            <li class="covered" data-hits="435" data-linenumber="460">
              <span class="hits">435</span>
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="461">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="462">
            <code class="sql"></code></li>
            <li class="covered" data-hits="36" data-linenumber="463">
              <span class="hits">36</span>
              <code class="sql">    return tokens;</code></li>
            <li class="never" data-hits="" data-linenumber="464">
            <code class="sql">  end lexer;</code></li>
            <li class="never" data-hits="" data-linenumber="465">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="466">
            <code class="sql">  /* SCANNER END */</code></li>
            <li class="never" data-hits="" data-linenumber="467">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="468">
            <code class="sql">  /* PARSER FUNCTIONS START */</code></li>
            <li class="never" data-hits="" data-linenumber="469">
            <code class="sql">  procedure p_error(text varchar2, tok rToken) as</code></li>
            <li class="never" data-hits="" data-linenumber="470">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="17" data-linenumber="471">
              <span class="hits">17</span>
              <code class="sql">    raise_application_error(-20101, &apos;JSON Parser exception @ line: &apos;||tok.line||&apos; column: &apos;||tok.col||&apos; - &apos;||text);</code></li>
            <li class="never" data-hits="" data-linenumber="472">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="473">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="474">
            <code class="sql">  function parseObj(tokens lTokens, indx in out nocopy pls_integer) return pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="475">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="476">
            <code class="sql">  function parseArr(tokens lTokens, indx in out nocopy pls_integer) return pljson_list as</code></li>
            <li class="covered" data-hits="14" data-linenumber="477">
              <span class="hits">14</span>
              <code class="sql">    e_arr pljson_value_array := pljson_value_array();</code></li>
            <li class="covered" data-hits="14" data-linenumber="478">
              <span class="hits">14</span>
              <code class="sql">    ret_list pljson_list := pljson_list();</code></li>
            <li class="covered" data-hits="14" data-linenumber="479">
              <span class="hits">14</span>
              <code class="sql">    v_count number := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="480">
            <code class="sql">    tok rToken;</code></li>
            <li class="never" data-hits="" data-linenumber="481">
            <code class="sql">    pv pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="482">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="483">
            <code class="sql">    --value, value, value ]</code></li>
            <li class="covered" data-hits="15" data-linenumber="484">
              <span class="hits">15</span>
              <code class="sql">    if(indx &gt; tokens.count) then p_error(&apos;more elements in array was excepted&apos;, tok); end if;</code></li>
            <li class="covered" data-hits="13" data-linenumber="485">
              <span class="hits">13</span>
              <code class="sql">    tok := tokens(indx);</code></li>
            <li class="covered" data-hits="13" data-linenumber="486">
              <span class="hits">13</span>
              <code class="sql">    while(tok.type_name != &apos;]&apos;) loop</code></li>
            <li class="covered" data-hits="17" data-linenumber="487">
              <span class="hits">17</span>
              <code class="sql">      e_arr.extend;</code></li>
            <li class="covered" data-hits="17" data-linenumber="488">
              <span class="hits">17</span>
              <code class="sql">      v_count := v_count + 1;</code></li>
            <li class="covered" data-hits="17" data-linenumber="489">
              <span class="hits">17</span>
              <code class="sql">      case tok.type_name</code></li>
            <li class="covered" data-hits="19" data-linenumber="490">
              <span class="hits">19</span>
              <code class="sql">        when &apos;TRUE&apos; then e_arr(v_count) := pljson_value(true);</code></li>
            <li class="covered" data-hits="16" data-linenumber="491">
              <span class="hits">16</span>
              <code class="sql">        when &apos;FALSE&apos; then e_arr(v_count) := pljson_value(false);</code></li>
            <li class="covered" data-hits="14" data-linenumber="492">
              <span class="hits">14</span>
              <code class="sql">        when &apos;NULL&apos; then e_arr(v_count) := pljson_value;</code></li>
            <li class="covered" data-hits="16" data-linenumber="493">
              <span class="hits">16</span>
              <code class="sql">        when &apos;STRING&apos; then e_arr(v_count) := case when tok.data_overflow is not null then pljson_value(tok.data_overflow) else pljson_value(tok.data) end;</code></li>
            <li class="covered" data-hits="12" data-linenumber="494">
              <span class="hits">12</span>
              <code class="sql">        when &apos;ESTRING&apos; then e_arr(v_count) := pljson_value(tok.data_overflow, false);</code></li>
            <li class="never" data-hits="" data-linenumber="495">
            <code class="sql">        /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="496">
            <code class="sql">        --when &apos;NUMBER&apos; then e_arr(v_count) := pljson_value(to_number(replace(tok.data, &apos;.&apos;, decimalpoint)));</code></li>
            <li class="covered" data-hits="12" data-linenumber="497">
              <span class="hits">12</span>
              <code class="sql">        when &apos;NUMBER&apos; then</code></li>
            <li class="covered" data-hits="6" data-linenumber="498">
              <span class="hits">6</span>
              <code class="sql">          pv := pljson_value(0);</code></li>
            <li class="covered" data-hits="6" data-linenumber="499">
              <span class="hits">6</span>
              <code class="sql">          pv.parse_number(replace(tok.data, &apos;.&apos;, decimalpoint));</code></li>
            <li class="covered" data-hits="6" data-linenumber="500">
              <span class="hits">6</span>
              <code class="sql">          e_arr(v_count) := pv;</code></li>
            <li class="covered" data-hits="6" data-linenumber="501">
              <span class="hits">6</span>
              <code class="sql">        when &apos;[&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="502">
            <code class="sql">          declare e_list pljson_list; begin</code></li>
            <li class="covered" data-hits="3" data-linenumber="503">
              <span class="hits">3</span>
              <code class="sql">            indx := indx + 1;</code></li>
            <li class="covered" data-hits="3" data-linenumber="504">
              <span class="hits">3</span>
              <code class="sql">            e_list := parseArr(tokens, indx);</code></li>
            <li class="covered" data-hits="3" data-linenumber="505">
              <span class="hits">3</span>
              <code class="sql">            e_arr(v_count) := e_list.to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="506">
            <code class="sql">          end;</code></li>
            <li class="covered" data-hits="3" data-linenumber="507">
              <span class="hits">3</span>
              <code class="sql">        when &apos;{&apos; then</code></li>
            <li class="missed" data-hits="0" data-linenumber="508">
              <code class="sql">          indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="509">
              <code class="sql">          e_arr(v_count) := parseObj(tokens, indx).to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="510">
            <code class="sql">        else</code></li>
            <li class="covered" data-hits="3" data-linenumber="511">
              <span class="hits">3</span>
              <code class="sql">          p_error(&apos;Expected a value&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="512">
            <code class="sql">      end case;</code></li>
            <li class="covered" data-hits="14" data-linenumber="513">
              <span class="hits">14</span>
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="covered" data-hits="15" data-linenumber="514">
              <span class="hits">15</span>
              <code class="sql">      if(indx &gt; tokens.count) then p_error(&apos;] not found&apos;, tok); end if;</code></li>
            <li class="covered" data-hits="13" data-linenumber="515">
              <span class="hits">13</span>
              <code class="sql">      tok := tokens(indx);</code></li>
            <li class="covered" data-hits="13" data-linenumber="516">
              <span class="hits">13</span>
              <code class="sql">      if(tok.type_name = &apos;,&apos;) then --advance</code></li>
            <li class="covered" data-hits="6" data-linenumber="517">
              <span class="hits">6</span>
              <code class="sql">        indx := indx + 1;</code></li>
            <li class="covered" data-hits="6" data-linenumber="518">
              <span class="hits">6</span>
              <code class="sql">        if(indx &gt; tokens.count) then p_error(&apos;more elements in array was excepted&apos;, tok); end if;</code></li>
            <li class="covered" data-hits="6" data-linenumber="519">
              <span class="hits">6</span>
              <code class="sql">        tok := tokens(indx);</code></li>
            <li class="covered" data-hits="6" data-linenumber="520">
              <span class="hits">6</span>
              <code class="sql">        if(tok.type_name = &apos;]&apos;) then --premature exit</code></li>
            <li class="missed" data-hits="0" data-linenumber="521">
              <code class="sql">          p_error(&apos;Premature exit in array&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="522">
            <code class="sql">        end if;</code></li>
            <li class="covered" data-hits="7" data-linenumber="523">
              <span class="hits">7</span>
              <code class="sql">      elsif(tok.type_name != &apos;]&apos;) then --error</code></li>
            <li class="covered" data-hits="2" data-linenumber="524">
              <span class="hits">2</span>
              <code class="sql">        p_error(&apos;Expected , or ]&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="525">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="526">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="527">
            <code class="sql">    end loop;</code></li>
            <li class="covered" data-hits="7" data-linenumber="528">
              <span class="hits">7</span>
              <code class="sql">    ret_list.list_data := e_arr;</code></li>
            <li class="covered" data-hits="7" data-linenumber="529">
              <span class="hits">7</span>
              <code class="sql">    return ret_list;</code></li>
            <li class="never" data-hits="" data-linenumber="530">
            <code class="sql">  end parseArr;</code></li>
            <li class="never" data-hits="" data-linenumber="531">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="532">
            <code class="sql">  function parseMem(tokens lTokens, indx in out pls_integer, mem_name varchar2, mem_indx number) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="533">
            <code class="sql">    mem pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="534">
            <code class="sql">    tok rToken;</code></li>
            <li class="never" data-hits="" data-linenumber="535">
            <code class="sql">    pv pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="536">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="34" data-linenumber="537">
              <span class="hits">34</span>
              <code class="sql">    tok := tokens(indx);</code></li>
            <li class="covered" data-hits="34" data-linenumber="538">
              <span class="hits">34</span>
              <code class="sql">    case tok.type_name</code></li>
            <li class="covered" data-hits="37" data-linenumber="539">
              <span class="hits">37</span>
              <code class="sql">      when &apos;TRUE&apos; then mem := pljson_value(true);</code></li>
            <li class="covered" data-hits="34" data-linenumber="540">
              <span class="hits">34</span>
              <code class="sql">      when &apos;FALSE&apos; then mem := pljson_value(false);</code></li>
            <li class="covered" data-hits="29" data-linenumber="541">
              <span class="hits">29</span>
              <code class="sql">      when &apos;NULL&apos; then mem := pljson_value;</code></li>
            <li class="covered" data-hits="31" data-linenumber="542">
              <span class="hits">31</span>
              <code class="sql">      when &apos;STRING&apos; then mem := case when tok.data_overflow is not null then pljson_value(tok.data_overflow) else pljson_value(tok.data) end;</code></li>
            <li class="covered" data-hits="23" data-linenumber="543">
              <span class="hits">23</span>
              <code class="sql">      when &apos;ESTRING&apos; then mem := pljson_value(tok.data_overflow, false);</code></li>
            <li class="never" data-hits="" data-linenumber="544">
            <code class="sql">      /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="545">
            <code class="sql">      --when &apos;NUMBER&apos; then mem := pljson_value(to_number(replace(tok.data, &apos;.&apos;, decimalpoint)));</code></li>
            <li class="covered" data-hits="23" data-linenumber="546">
              <span class="hits">23</span>
              <code class="sql">      when &apos;NUMBER&apos; then</code></li>
            <li class="covered" data-hits="10" data-linenumber="547">
              <span class="hits">10</span>
              <code class="sql">        pv := pljson_value(0);</code></li>
            <li class="covered" data-hits="10" data-linenumber="548">
              <span class="hits">10</span>
              <code class="sql">        pv.parse_number(replace(tok.data, &apos;.&apos;, decimalpoint));</code></li>
            <li class="covered" data-hits="10" data-linenumber="549">
              <span class="hits">10</span>
              <code class="sql">        mem := pv;</code></li>
            <li class="covered" data-hits="13" data-linenumber="550">
              <span class="hits">13</span>
              <code class="sql">      when &apos;[&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="551">
            <code class="sql">        declare</code></li>
            <li class="never" data-hits="" data-linenumber="552">
            <code class="sql">          e_list pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="553">
            <code class="sql">        begin</code></li>
            <li class="covered" data-hits="11" data-linenumber="554">
              <span class="hits">11</span>
              <code class="sql">          indx := indx + 1;</code></li>
            <li class="covered" data-hits="11" data-linenumber="555">
              <span class="hits">11</span>
              <code class="sql">          e_list := parseArr(tokens, indx);</code></li>
            <li class="covered" data-hits="4" data-linenumber="556">
              <span class="hits">4</span>
              <code class="sql">          mem := e_list.to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="557">
            <code class="sql">        end;</code></li>
            <li class="covered" data-hits="2" data-linenumber="558">
              <span class="hits">2</span>
              <code class="sql">      when &apos;{&apos; then</code></li>
            <li class="covered" data-hits="1" data-linenumber="559">
              <span class="hits">1</span>
              <code class="sql">        indx := indx + 1;</code></li>
            <li class="covered" data-hits="1" data-linenumber="560">
              <span class="hits">1</span>
              <code class="sql">        mem := parseObj(tokens, indx).to_json_value;</code></li>
            <li class="never" data-hits="" data-linenumber="561">
            <code class="sql">      else</code></li>
            <li class="covered" data-hits="1" data-linenumber="562">
              <span class="hits">1</span>
              <code class="sql">        p_error(&apos;Found &apos;||tok.type_name, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="563">
            <code class="sql">    end case;</code></li>
            <li class="covered" data-hits="26" data-linenumber="564">
              <span class="hits">26</span>
              <code class="sql">    mem.mapname := mem_name;</code></li>
            <li class="covered" data-hits="26" data-linenumber="565">
              <span class="hits">26</span>
              <code class="sql">    mem.mapindx := mem_indx;</code></li>
            <li class="never" data-hits="" data-linenumber="566">
            <code class="sql"></code></li>
            <li class="covered" data-hits="26" data-linenumber="567">
              <span class="hits">26</span>
              <code class="sql">    indx := indx + 1;</code></li>
            <li class="covered" data-hits="26" data-linenumber="568">
              <span class="hits">26</span>
              <code class="sql">    return mem;</code></li>
            <li class="never" data-hits="" data-linenumber="569">
            <code class="sql">  end parseMem;</code></li>
            <li class="never" data-hits="" data-linenumber="570">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="571">
            <code class="sql">  /*procedure test_duplicate_members(arr in json_member_array, mem_name in varchar2, wheretok rToken) as</code></li>
            <li class="never" data-hits="" data-linenumber="572">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="573">
            <code class="sql">    for i in 1 .. arr.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="574">
            <code class="sql">      if(arr(i).member_name = mem_name) then</code></li>
            <li class="never" data-hits="" data-linenumber="575">
            <code class="sql">        p_error(&apos;Duplicate member name&apos;, wheretok);</code></li>
            <li class="never" data-hits="" data-linenumber="576">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="577">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="578">
            <code class="sql">  end test_duplicate_members;*/</code></li>
            <li class="never" data-hits="" data-linenumber="579">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="580">
            <code class="sql">  function parseObj(tokens lTokens, indx in out nocopy pls_integer) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="581">
            <code class="sql">    type memmap is table of number index by varchar2(4000); -- i&apos;ve read somewhere that this is not possible - but it is!</code></li>
            <li class="never" data-hits="" data-linenumber="582">
            <code class="sql">    mymap memmap;</code></li>
            <li class="covered" data-hits="36" data-linenumber="583">
              <span class="hits">36</span>
              <code class="sql">    nullelemfound boolean := false;</code></li>
            <li class="never" data-hits="" data-linenumber="584">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="585">
            <code class="sql">    obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="586">
            <code class="sql">    tok rToken;</code></li>
            <li class="never" data-hits="" data-linenumber="587">
            <code class="sql">    mem_name varchar(4000);</code></li>
            <li class="covered" data-hits="36" data-linenumber="588">
              <span class="hits">36</span>
              <code class="sql">    arr pljson_value_array := pljson_value_array();</code></li>
            <li class="never" data-hits="" data-linenumber="589">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="590">
            <code class="sql">    --what to expect?</code></li>
            <li class="covered" data-hits="59" data-linenumber="591">
              <span class="hits">59</span>
              <code class="sql">    while(indx &lt;= tokens.count) loop</code></li>
            <li class="covered" data-hits="58" data-linenumber="592">
              <span class="hits">58</span>
              <code class="sql">      tok := tokens(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="593">
            <code class="sql">      --debug(&apos;E: &apos;||tok.type_name);</code></li>
            <li class="covered" data-hits="58" data-linenumber="594">
              <span class="hits">58</span>
              <code class="sql">      case tok.type_name</code></li>
            <li class="covered" data-hits="58" data-linenumber="595">
              <span class="hits">58</span>
              <code class="sql">      when &apos;STRING&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="596">
            <code class="sql">        --member</code></li>
            <li class="covered" data-hits="39" data-linenumber="597">
              <span class="hits">39</span>
              <code class="sql">        mem_name := substr(tok.data, 1, 4000);</code></li>
            <li class="never" data-hits="" data-linenumber="598">
            <code class="sql">        begin</code></li>
            <li class="covered" data-hits="39" data-linenumber="599">
              <span class="hits">39</span>
              <code class="sql">          if(mem_name is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="600">
              <code class="sql">            if(nullelemfound) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="601">
              <code class="sql">              p_error(&apos;Duplicate empty member: &apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="602">
            <code class="sql">            else</code></li>
            <li class="missed" data-hits="0" data-linenumber="603">
              <code class="sql">              nullelemfound := true;</code></li>
            <li class="never" data-hits="" data-linenumber="604">
            <code class="sql">            end if;</code></li>
            <li class="covered" data-hits="39" data-linenumber="605">
              <span class="hits">39</span>
              <code class="sql">          elsif(mymap(mem_name) is not null) then</code></li>
            <li class="covered" data-hits="2" data-linenumber="606">
              <span class="hits">2</span>
              <code class="sql">            p_error(&apos;Duplicate member name: &apos;||mem_name, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="607">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="608">
            <code class="sql">        exception</code></li>
            <li class="covered" data-hits="74" data-linenumber="609">
              <span class="hits">74</span>
              <code class="sql">          when no_data_found then mymap(mem_name) := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="610">
            <code class="sql">        end;</code></li>
            <li class="never" data-hits="" data-linenumber="611">
            <code class="sql"></code></li>
            <li class="covered" data-hits="37" data-linenumber="612">
              <span class="hits">37</span>
              <code class="sql">        indx := indx + 1;</code></li>
            <li class="covered" data-hits="38" data-linenumber="613">
              <span class="hits">38</span>
              <code class="sql">        if(indx &gt; tokens.count) then p_error(&apos;Unexpected end of input&apos;, tok); end if;</code></li>
            <li class="covered" data-hits="36" data-linenumber="614">
              <span class="hits">36</span>
              <code class="sql">        tok := tokens(indx);</code></li>
            <li class="covered" data-hits="36" data-linenumber="615">
              <span class="hits">36</span>
              <code class="sql">        indx := indx + 1;</code></li>
            <li class="covered" data-hits="37" data-linenumber="616">
              <span class="hits">37</span>
              <code class="sql">        if(indx &gt; tokens.count) then p_error(&apos;Unexpected end of input&apos;, tok); end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="617">
              <code class="sql">        if(tok.type_name = &apos;:&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="618">
            <code class="sql">          --parse</code></li>
            <li class="never" data-hits="" data-linenumber="619">
            <code class="sql">          declare</code></li>
            <li class="never" data-hits="" data-linenumber="620">
            <code class="sql">            jmb pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="621">
            <code class="sql">            x number;</code></li>
            <li class="never" data-hits="" data-linenumber="622">
            <code class="sql">          begin</code></li>
            <li class="covered" data-hits="34" data-linenumber="623">
              <span class="hits">34</span>
              <code class="sql">            x := arr.count + 1;</code></li>
            <li class="covered" data-hits="34" data-linenumber="624">
              <span class="hits">34</span>
              <code class="sql">            jmb := parseMem(tokens, indx, mem_name, x);</code></li>
            <li class="covered" data-hits="26" data-linenumber="625">
              <span class="hits">26</span>
              <code class="sql">            arr.extend;</code></li>
            <li class="covered" data-hits="26" data-linenumber="626">
              <span class="hits">26</span>
              <code class="sql">            arr(x) := jmb;</code></li>
            <li class="never" data-hits="" data-linenumber="627">
            <code class="sql">          end;</code></li>
            <li class="never" data-hits="" data-linenumber="628">
            <code class="sql">        else</code></li>
            <li class="covered" data-hits="1" data-linenumber="629">
              <span class="hits">1</span>
              <code class="sql">          p_error(&apos;Expected &apos;&apos;:&apos;&apos;&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="630">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="631">
            <code class="sql">        --move indx forward if &apos;,&apos; is found</code></li>
            <li class="covered" data-hits="27" data-linenumber="632">
              <span class="hits">27</span>
              <code class="sql">        if(indx &gt; tokens.count) then p_error(&apos;Unexpected end of input&apos;, tok); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="633">
            <code class="sql"></code></li>
            <li class="covered" data-hits="25" data-linenumber="634">
              <span class="hits">25</span>
              <code class="sql">        tok := tokens(indx);</code></li>
            <li class="covered" data-hits="25" data-linenumber="635">
              <span class="hits">25</span>
              <code class="sql">        if(tok.type_name = &apos;,&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="636">
            <code class="sql">          --debug(&apos;found ,&apos;);</code></li>
            <li class="covered" data-hits="7" data-linenumber="637">
              <span class="hits">7</span>
              <code class="sql">          indx := indx + 1;</code></li>
            <li class="covered" data-hits="7" data-linenumber="638">
              <span class="hits">7</span>
              <code class="sql">          tok := tokens(indx);</code></li>
            <li class="covered" data-hits="7" data-linenumber="639">
              <span class="hits">7</span>
              <code class="sql">          if(tok.type_name = &apos;}&apos;) then --premature exit</code></li>
            <li class="covered" data-hits="1" data-linenumber="640">
              <span class="hits">1</span>
              <code class="sql">            p_error(&apos;Premature exit in json object&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="641">
            <code class="sql">          end if;</code></li>
            <li class="covered" data-hits="18" data-linenumber="642">
              <span class="hits">18</span>
              <code class="sql">        elsif(tok.type_name != &apos;}&apos;) then</code></li>
            <li class="covered" data-hits="1" data-linenumber="643">
              <span class="hits">1</span>
              <code class="sql">           p_error(&apos;A comma seperator is probably missing&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="644">
            <code class="sql">        end if;</code></li>
            <li class="covered" data-hits="19" data-linenumber="645">
              <span class="hits">19</span>
              <code class="sql">      when &apos;}&apos; then</code></li>
            <li class="covered" data-hits="19" data-linenumber="646">
              <span class="hits">19</span>
              <code class="sql">        obj := pljson();</code></li>
            <li class="covered" data-hits="19" data-linenumber="647">
              <span class="hits">19</span>
              <code class="sql">        obj.json_data := arr;</code></li>
            <li class="covered" data-hits="19" data-linenumber="648">
              <span class="hits">19</span>
              <code class="sql">        return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="649">
            <code class="sql">      else</code></li>
            <li class="missed" data-hits="0" data-linenumber="650">
              <code class="sql">        p_error(&apos;Expected string or }&apos;, tok);</code></li>
            <li class="never" data-hits="" data-linenumber="651">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="652">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="653">
            <code class="sql"></code></li>
            <li class="covered" data-hits="1" data-linenumber="654">
              <span class="hits">1</span>
              <code class="sql">    p_error(&apos;} not found&apos;, tokens(indx-1));</code></li>
            <li class="never" data-hits="" data-linenumber="655">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="656">
              <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="657">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="658">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="659">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="660">
            <code class="sql">  function parser(str varchar2) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="661">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="never" data-hits="" data-linenumber="662">
            <code class="sql">    obj pljson;</code></li>
            <li class="covered" data-hits="49" data-linenumber="663">
              <span class="hits">49</span>
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="664">
            <code class="sql">    jsrc json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="665">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="49" data-linenumber="666">
              <span class="hits">49</span>
              <code class="sql">    updateDecimalPoint();</code></li>
            <li class="covered" data-hits="49" data-linenumber="667">
              <span class="hits">49</span>
              <code class="sql">    jsrc := prepareVarchar2(str);</code></li>
            <li class="covered" data-hits="49" data-linenumber="668">
              <span class="hits">49</span>
              <code class="sql">    tokens := lexer(jsrc);</code></li>
            <li class="covered" data-hits="36" data-linenumber="669">
              <span class="hits">36</span>
              <code class="sql">    if(tokens(indx).type_name = &apos;{&apos;) then</code></li>
            <li class="covered" data-hits="35" data-linenumber="670">
              <span class="hits">35</span>
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="covered" data-hits="35" data-linenumber="671">
              <span class="hits">35</span>
              <code class="sql">      obj := parseObj(tokens, indx);</code></li>
            <li class="never" data-hits="" data-linenumber="672">
            <code class="sql">    else</code></li>
            <li class="covered" data-hits="1" data-linenumber="673">
              <span class="hits">1</span>
              <code class="sql">      raise_application_error(-20101, &apos;JSON Parser exception - no { start found&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="674">
            <code class="sql">    end if;</code></li>
            <li class="covered" data-hits="18" data-linenumber="675">
              <span class="hits">18</span>
              <code class="sql">    if(tokens.count != indx) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="676">
              <code class="sql">      p_error(&apos;} should end the JSON object&apos;, tokens(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="677">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="678">
            <code class="sql"></code></li>
            <li class="covered" data-hits="18" data-linenumber="679">
              <span class="hits">18</span>
              <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="680">
            <code class="sql">  end parser;</code></li>
            <li class="never" data-hits="" data-linenumber="681">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="682">
            <code class="sql">  function parse_list(str varchar2) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="683">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="never" data-hits="" data-linenumber="684">
            <code class="sql">    obj pljson_list;</code></li>
            <li class="missed" data-hits="0" data-linenumber="685">
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="686">
            <code class="sql">    jsrc json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="687">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="688">
              <code class="sql">    updateDecimalPoint();</code></li>
            <li class="missed" data-hits="0" data-linenumber="689">
              <code class="sql">    jsrc := prepareVarchar2(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="690">
              <code class="sql">    tokens := lexer(jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="691">
              <code class="sql">    if(tokens(indx).type_name = &apos;[&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="692">
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="693">
              <code class="sql">      obj := parseArr(tokens, indx);</code></li>
            <li class="never" data-hits="" data-linenumber="694">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="695">
              <code class="sql">      raise_application_error(-20101, &apos;JSON List Parser exception - no [ start found&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="696">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="697">
              <code class="sql">    if(tokens.count != indx) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="698">
              <code class="sql">      p_error(&apos;] should end the JSON List object&apos;, tokens(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="699">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="700">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="701">
              <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="702">
            <code class="sql">  end parse_list;</code></li>
            <li class="never" data-hits="" data-linenumber="703">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="704">
            <code class="sql">  function parse_list(str clob) return pljson_list as</code></li>
            <li class="never" data-hits="" data-linenumber="705">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="never" data-hits="" data-linenumber="706">
            <code class="sql">    obj pljson_list;</code></li>
            <li class="missed" data-hits="0" data-linenumber="707">
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="708">
            <code class="sql">    jsrc json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="709">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="710">
              <code class="sql">    updateDecimalPoint();</code></li>
            <li class="missed" data-hits="0" data-linenumber="711">
              <code class="sql">    jsrc := prepareClob(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="712">
              <code class="sql">    tokens := lexer(jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="713">
              <code class="sql">    if(tokens(indx).type_name = &apos;[&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="714">
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="715">
              <code class="sql">      obj := parseArr(tokens, indx);</code></li>
            <li class="never" data-hits="" data-linenumber="716">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="717">
              <code class="sql">      raise_application_error(-20101, &apos;JSON List Parser exception - no [ start found&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="718">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="719">
              <code class="sql">    if(tokens.count != indx) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="720">
              <code class="sql">      p_error(&apos;] should end the JSON List object&apos;, tokens(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="721">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="722">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="723">
              <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="724">
            <code class="sql">  end parse_list;</code></li>
            <li class="never" data-hits="" data-linenumber="725">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="726">
            <code class="sql">  function parser(str clob) return pljson as</code></li>
            <li class="never" data-hits="" data-linenumber="727">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="never" data-hits="" data-linenumber="728">
            <code class="sql">    obj pljson;</code></li>
            <li class="missed" data-hits="0" data-linenumber="729">
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="730">
            <code class="sql">    jsrc json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="731">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="732">
              <code class="sql">    updateDecimalPoint();</code></li>
            <li class="never" data-hits="" data-linenumber="733">
            <code class="sql">    --dbms_output.put_line(&apos;Using clob&apos;);</code></li>
            <li class="missed" data-hits="0" data-linenumber="734">
              <code class="sql">    jsrc := prepareClob(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="735">
              <code class="sql">    tokens := lexer(jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="736">
              <code class="sql">    if(tokens(indx).type_name = &apos;{&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="737">
              <code class="sql">      indx := indx + 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="738">
              <code class="sql">      obj := parseObj(tokens, indx);</code></li>
            <li class="never" data-hits="" data-linenumber="739">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="740">
              <code class="sql">      raise_application_error(-20101, &apos;JSON Parser exception - no { start found&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="741">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="742">
              <code class="sql">    if(tokens.count != indx) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="743">
              <code class="sql">      p_error(&apos;} should end the JSON object&apos;, tokens(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="744">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="745">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="746">
              <code class="sql">    return obj;</code></li>
            <li class="never" data-hits="" data-linenumber="747">
            <code class="sql">  end parser;</code></li>
            <li class="never" data-hits="" data-linenumber="748">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="749">
            <code class="sql">  function parse_any(str varchar2) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="750">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="never" data-hits="" data-linenumber="751">
            <code class="sql">    obj pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="752">
            <code class="sql">    ret pljson_value;</code></li>
            <li class="missed" data-hits="0" data-linenumber="753">
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="754">
            <code class="sql">    jsrc json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="755">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="756">
              <code class="sql">    updateDecimalPoint();</code></li>
            <li class="missed" data-hits="0" data-linenumber="757">
              <code class="sql">    jsrc := prepareVarchar2(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="758">
              <code class="sql">    tokens := lexer(jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="759">
              <code class="sql">    tokens(tokens.count+1).type_name := &apos;]&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="760">
              <code class="sql">    obj := parseArr(tokens, indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="761">
              <code class="sql">    if(tokens.count != indx) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="762">
              <code class="sql">      p_error(&apos;] should end the JSON List object&apos;, tokens(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="763">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="764">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="765">
              <code class="sql">    return obj.head();</code></li>
            <li class="never" data-hits="" data-linenumber="766">
            <code class="sql">  end parse_any;</code></li>
            <li class="never" data-hits="" data-linenumber="767">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="768">
            <code class="sql">  function parse_any(str clob) return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="769">
            <code class="sql">    tokens lTokens;</code></li>
            <li class="never" data-hits="" data-linenumber="770">
            <code class="sql">    obj pljson_list;</code></li>
            <li class="missed" data-hits="0" data-linenumber="771">
              <code class="sql">    indx pls_integer := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="772">
            <code class="sql">    jsrc json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="773">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="774">
              <code class="sql">    jsrc := prepareClob(str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="775">
              <code class="sql">    tokens := lexer(jsrc);</code></li>
            <li class="missed" data-hits="0" data-linenumber="776">
              <code class="sql">    tokens(tokens.count+1).type_name := &apos;]&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="777">
              <code class="sql">    obj := parseArr(tokens, indx);</code></li>
            <li class="missed" data-hits="0" data-linenumber="778">
              <code class="sql">    if(tokens.count != indx) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="779">
              <code class="sql">      p_error(&apos;] should end the JSON List object&apos;, tokens(indx));</code></li>
            <li class="never" data-hits="" data-linenumber="780">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="781">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="782">
              <code class="sql">    return obj.head();</code></li>
            <li class="never" data-hits="" data-linenumber="783">
            <code class="sql">  end parse_any;</code></li>
            <li class="never" data-hits="" data-linenumber="784">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="785">
            <code class="sql">  /* last entry is the one to keep */</code></li>
            <li class="never" data-hits="" data-linenumber="786">
            <code class="sql">  procedure remove_duplicates(obj in out nocopy pljson) as</code></li>
            <li class="never" data-hits="" data-linenumber="787">
            <code class="sql">    type memberlist is table of pljson_value index by varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="788">
            <code class="sql">    members memberlist;</code></li>
            <li class="missed" data-hits="0" data-linenumber="789">
              <code class="sql">    nulljsonvalue pljson_value := null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="790">
              <code class="sql">    validated pljson := pljson();</code></li>
            <li class="never" data-hits="" data-linenumber="791">
            <code class="sql">    indx varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="792">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="793">
              <code class="sql">    for i in 1 .. obj.count loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="794">
              <code class="sql">      if(obj.get(i).mapname is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="795">
              <code class="sql">        nulljsonvalue := obj.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="796">
            <code class="sql">      else</code></li>
            <li class="missed" data-hits="0" data-linenumber="797">
              <code class="sql">        members(obj.get(i).mapname) := obj.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="798">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="799">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="800">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="801">
              <code class="sql">    validated.check_duplicate(false);</code></li>
            <li class="missed" data-hits="0" data-linenumber="802">
              <code class="sql">    indx := members.first;</code></li>
            <li class="missed" data-hits="0" data-linenumber="803">
              <code class="sql">    loop</code></li>
            <li class="missed" data-hits="0" data-linenumber="804">
              <code class="sql">      exit when indx is null;</code></li>
            <li class="missed" data-hits="0" data-linenumber="805">
              <code class="sql">      validated.put(indx, members(indx));</code></li>
            <li class="missed" data-hits="0" data-linenumber="806">
              <code class="sql">      indx := members.next(indx);</code></li>
            <li class="never" data-hits="" data-linenumber="807">
            <code class="sql">    end loop;</code></li>
            <li class="missed" data-hits="0" data-linenumber="808">
              <code class="sql">    if(nulljsonvalue is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="809">
              <code class="sql">      validated.put(&apos;&apos;, nulljsonvalue);</code></li>
            <li class="never" data-hits="" data-linenumber="810">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="811">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="812">
              <code class="sql">    validated.check_for_duplicate := obj.check_for_duplicate;</code></li>
            <li class="never" data-hits="" data-linenumber="813">
            <code class="sql"></code></li>
            <li class="missed" data-hits="0" data-linenumber="814">
              <code class="sql">    obj := validated;</code></li>
            <li class="never" data-hits="" data-linenumber="815">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="816">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="817">
            <code class="sql">  function get_version return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="818">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="819">
              <code class="sql">    return &apos;PL/JSON v2.0.0&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="820">
            <code class="sql">  end get_version;</code></li>
            <li class="never" data-hits="" data-linenumber="821">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="822">
            <code class="sql">end pljson_parser;</code></li></ol></pre></div><div class="source_table" id="762EF77D357D91F6A44C37FF45ABE261"><div class="header"> <h3>DEV.PLJSON_PARSER_TEST</h3><h4><span class="green">91.03 %</span> covered</h4><div> <b>78</b> relevant lines. <span class="green"><b>71</b> lines covered</span> and <span class="red"><b>7</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_parser_test is</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  scanner_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  pragma exception_init(scanner_exception, -20100);</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  parser_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  pragma exception_init(parser_exception, -20101);</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">  procedure pass(str varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="32" data-linenumber="10">
              <span class="hits">32</span>
              <code class="sql">    ut.expect(true,str).to_be_true;</code></li>
            <li class="covered" data-hits="32" data-linenumber="11">
              <span class="hits">32</span>
              <code class="sql">    null;</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  procedure assertFail(json_str varchar2, testname varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">    obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="31" data-linenumber="17">
              <span class="hits">31</span>
              <code class="sql">    obj := pljson(json_str);</code></li>
            <li class="missed" data-hits="0" data-linenumber="18">
              <code class="sql">    ut.fail(testname);</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">  exception</code></li>
            <li class="covered" data-hits="31" data-linenumber="20">
              <span class="hits">31</span>
              <code class="sql">    when scanner_exception or parser_exception then</code></li>
            <li class="covered" data-hits="31" data-linenumber="21">
              <span class="hits">31</span>
              <code class="sql">      pass(testname);</code></li>
            <li class="missed" data-hits="0" data-linenumber="22">
              <code class="sql">    when others then</code></li>
            <li class="missed" data-hits="0" data-linenumber="23">
              <code class="sql">      ut.fail(testname||chr(13)||dbms_utility.format_error_backtrace);</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">  procedure assertPass(json_str varchar2, testname varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">    obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="17" data-linenumber="29">
              <span class="hits">17</span>
              <code class="sql">    obj := pljson(json_str);</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">    --ut.expect(obj.to_char(spaces =&gt; false),testname).to_equal(json_str);</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  exception</code></li>
            <li class="missed" data-hits="0" data-linenumber="32">
              <code class="sql">    when others then</code></li>
            <li class="missed" data-hits="0" data-linenumber="33">
              <code class="sql">      ut.fail(testname||chr(13)||dbms_utility.format_error_backtrace);</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">  procedure set_json_strict is</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="2" data-linenumber="38">
              <span class="hits">2</span>
              <code class="sql">    pljson_parser.json_strict := true;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">  procedure test_scanner_digits is</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="43">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: .23 }&apos;,&apos;number test A&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">  procedure test_digit_fraction is</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="48">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: 23. }&apos;,&apos;digits test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="49">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: 23.h }&apos;,&apos;digits test B&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="50">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: 23.123 }&apos;,&apos;digits test C&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">  procedure test_digits_in_exp is</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="55">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: 23.3e23 }&apos;,&apos;digits exp test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="56">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: 23.1e-23 }&apos;,&apos;digits exp test B&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="57">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: 23.3eg3 }&apos;,&apos;digits exp test C&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="58">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: 23.1e- }&apos;,&apos;digits exp test D&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">  procedure test_strings is</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="63">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: &quot;23.3e23&quot; }&apos;,&apos;string test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="64">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: &quot;\u34d6&quot; }&apos;,&apos;unicode character test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="65">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: &quot;\u345g&quot; }&apos;,&apos;unicode character test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="66">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: &quot;\u345&quot; }&apos;,&apos;unicode character test B&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="67">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: &quot;\&quot; \\ \/ \b \f \n \r \t &quot; }&apos;,&apos;escape character test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="68">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: &quot;\3 &quot; }&apos;,&apos;escape character test B&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">  procedure test_bools is</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="73">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: truE }&apos;,&apos;boolean test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="74">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: TRUE }&apos;,&apos;boolean test B&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="75">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: true }&apos;,&apos;boolean test C&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="76">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: falruE }&apos;,&apos;boolean test D&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="77">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: false }&apos;,&apos;boolean test E&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">  procedure test_nulls is</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="82">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: nULL }&apos;,&apos;null test A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="83">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: null }&apos;,&apos;null test B&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">  procedure test_unexpected_char_l_266 is</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">    obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="89">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: NULL }&apos;,&apos;unexpected char l.226&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">  procedure test_unicode_char is</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">    obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="95">
              <span class="hits">1</span>
              <code class="sql">    obj := pljson(&apos;{&quot;?ao&quot;: &quot;A?O&quot;}&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">  procedure test_object_member is</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="100">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: ,}}&apos;,&apos;wrong member start test&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="101">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: 2, &quot;b&quot;: false, &quot;c&quot;: 2}&apos;,&apos;normal members test&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="102">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: 2, &quot;b&quot;: false, &quot;a&quot;: true}&apos;,&apos;same membername in same scope test&apos;);--could yield error - specs doesn&apos;t say anything</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">  procedure test_objects is</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">    --object testing</code></li>
            <li class="covered" data-hits="1" data-linenumber="108">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot; &apos;,&apos;Object suddently ends&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="109">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot; &quot;lala&quot; }&apos;,&apos;missing :&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="110">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot; :&apos;,&apos;missing value&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="111">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot; : true, }&apos;,&apos;another pair expected&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="112">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot; : true&apos;,&apos;} not found&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="113">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot; : {}}&apos;,&apos;empty object A&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="114">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{}&apos;,&apos;empty object B&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">  procedure test_duplicates is</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="119">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">      &quot;abcdefghijklmnopqrstuvxyzabcdefghijklmnopqrstuvxyz&quot; : 52,</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">      &quot;abcdefghijklmnopqrstuvxyzabcdefghijklmnopqrstuvxyz&quot; : 52</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">    }&apos;, &apos;Duplicate 1&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql"></code></li>
            <li class="covered" data-hits="1" data-linenumber="124">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">      &quot;abcdefghijklmnopqrstuvxyzabcdefghijklmnopqrstuvxyz1&quot; : 53,</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">      &quot;abcdefghijklmnopqrstuvxyzabcdefghijklmnopqrstuvxyz2&quot; : 53</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">    }&apos;, &apos;Duplicate 2&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">  procedure test_parser is</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">    obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="133">
              <span class="hits">1</span>
              <code class="sql">    pljson_parser.json_strict := true;</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql"></code></li>
            <li class="covered" data-hits="1" data-linenumber="135">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [}]}&apos;,&apos;array expecting value got }&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="136">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [,]}&apos;,&apos;premature exit from array&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="137">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [,&apos;,&apos;premature exit from array2&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="138">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [2&apos;,&apos;premature exit from array3&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="139">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [&apos;,&apos;premature exit from array4&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="140">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [ 2 2 ]}&apos;,&apos;commas between values in array 1&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="141">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: [ 2, 2 ]}&apos;,&apos;commas between values in array 2&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="142">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: [ 2, 2 }&apos;,&apos;remember to end array&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="143">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: []}&apos;,&apos;empty array&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="144">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: [[]]}&apos;,&apos;empty array in array&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="145">
              <span class="hits">1</span>
              <code class="sql">    assertPass(&apos;{ &quot;a&quot;: [true, [true, false], &quot;my fancy array&quot;, [&quot;you could call it a list&quot;]]}&apos;,&apos;wild array&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">    --start parser</code></li>
            <li class="covered" data-hits="1" data-linenumber="148">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos; &quot;a&quot; &apos;,&apos;{ missing&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="149">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{&apos;,&apos;} missing&apos;);</code></li>
            <li class="covered" data-hits="1" data-linenumber="150">
              <span class="hits">1</span>
              <code class="sql">    assertFail(&apos;{ &quot;a&quot;: 1 &quot;b&quot;: 2 }&apos;,&apos;, missing&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">  procedure test_string_ending is</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">    tokens pljson_parser.ltokens;</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">    src    pljson_parser.json_src;</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="157">
              <span class="hits">1</span>
              <code class="sql">    src    := pljson_parser.preparevarchar2(&apos;&quot;kbwkbwkbkb&apos;); /* since 0.84*/</code></li>
            <li class="covered" data-hits="1" data-linenumber="158">
              <span class="hits">1</span>
              <code class="sql">    tokens := pljson_parser.lexer(src);</code></li>
            <li class="missed" data-hits="0" data-linenumber="159">
              <code class="sql">    ut.fail(&apos;scanner exception not raised&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">  exception</code></li>
            <li class="covered" data-hits="1" data-linenumber="161">
              <span class="hits">1</span>
              <code class="sql">    when scanner_exception then</code></li>
            <li class="covered" data-hits="1" data-linenumber="162">
              <span class="hits">1</span>
              <code class="sql">      ut.expect(sqlerrm).to_be_like(&apos;%string ending not found%&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">    E.I.Sarmas (github.com/dsnz)   2016-04-12</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">    issue #37 test</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">    proposed by Borodulin Maxim (github.com/boriborm)</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">  procedure test_issue_37 is</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">    test_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">    test_buff varchar2(100);</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">    amount number;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">    src pljson_parser.json_src;</code></li>
            <li class="covered" data-hits="1" data-linenumber="175">
              <span class="hits">1</span>
              <code class="sql">    test_str varchar2(100) := &apos;issue #37&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="177">
              <span class="hits">1</span>
              <code class="sql">    test_buff := &apos;abcdefghijklmnopqrstuvwxyz&apos;;</code></li>
            <li class="covered" data-hits="1" data-linenumber="178">
              <span class="hits">1</span>
              <code class="sql">    dbms_lob.createtemporary(test_clob, false, DBMS_LOB.SESSION);</code></li>
            <li class="covered" data-hits="1" data-linenumber="179">
              <span class="hits">1</span>
              <code class="sql">    amount := length(test_buff);</code></li>
            <li class="covered" data-hits="1" data-linenumber="180">
              <span class="hits">1</span>
              <code class="sql">    dbms_lob.write(test_clob, amount, 3995, test_buff);</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql"></code></li>
            <li class="covered" data-hits="1" data-linenumber="182">
              <span class="hits">1</span>
              <code class="sql">    src := pljson_parser.prepareClob(test_clob);</code></li>
            <li class="covered" data-hits="12" data-linenumber="183">
              <span class="hits">12</span>
              <code class="sql">    for i in reverse 3995..4005 loop</code></li>
            <li class="covered" data-hits="11" data-linenumber="184">
              <span class="hits">11</span>
              <code class="sql">      ut.expect(substr(test_buff, i-3995+1, 1)).to_equal(pljson_parser.next_char(i, src));</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql"></code></li>
            <li class="covered" data-hits="1" data-linenumber="187">
              <span class="hits">1</span>
              <code class="sql">    dbms_lob.freetemporary(test_clob);</code></li>
            <li class="covered" data-hits="1" data-linenumber="188">
              <span class="hits">1</span>
              <code class="sql">    pass(test_str);</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">  exception</code></li>
            <li class="missed" data-hits="0" data-linenumber="190">
              <code class="sql">    when others then ut.fail(test_str);</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">end pljson_parser_test;</code></li></ol></pre></div><div class="source_table" id="0BF2DDD14219D82617803C19CBDF2AE1"><div class="header"> <h3>DEV.PLJSON_PRINTER</h3><h4><span class="red">0 %</span> covered</h4><div> <b>620</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>620</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_printer as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">  max_line_len number := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  cur_line_len number := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  -- associative array used inside escapeString to cache the escaped version of every character</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  -- escaped so far  (example: char_map(&apos;&quot;&apos;) contains the  &apos;\&quot;&apos; string)</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  -- (if the character does not need to be escaped, the character is stored unchanged in the array itself)</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">  -- type Rmap_char is record(buf varchar2(40), len integer);</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  type Tmap_char_string is table of varchar2(40) index by varchar2(1 char); /* index by unicode char */</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">  char_map Tmap_char_string;</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">  -- since char_map the associative array is a global variable reused across multiple calls to escapeString,</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">  -- i need to be able to detect that the escape_solidus or ascii_output global parameters have been changed,</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  -- in order to clear it and avoid using escape sequences that have been cached using the previous values</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  char_map_escape_solidus boolean := escape_solidus;</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  char_map_ascii_output boolean := ascii_output;</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  function llcheck(str in varchar2) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">    --dbms_output.put_line(cur_line_len || &apos; : &apos;|| str);</code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">    if(max_line_len &gt; 0 and length(str)+cur_line_len &gt; max_line_len) then</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">      cur_line_len := length(str);</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">      return newline_char || str;</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">      cur_line_len := cur_line_len + length(str);</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">      return str;</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">  end llcheck;</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  -- escapes a single character.</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql">  function escapeChar(ch char) return varchar2 deterministic is</code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">     result varchar2(20);</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">      --backspace b = U+0008</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">      --formfeed  f = U+000C</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql">      --newline   n = U+000A</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">      --carret    r = U+000D</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">      --tabulator t = U+0009</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">      result := ch;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">      case ch</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">      when chr( 8) then result := &apos;\b&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">      when chr( 9) then result := &apos;\t&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">      when chr(10) then result := &apos;\n&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">      when chr(12) then result := &apos;\f&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">      when chr(13) then result := &apos;\r&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">      when chr(34) then result := &apos;\&quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">      when chr(47) then if(escape_solidus) then result := &apos;\/&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">      when chr(92) then result := &apos;\\&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">      else if(ascii(ch) &lt; 32) then</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">             result :=  &apos;\u&apos;||replace(substr(to_char(ascii(ch), &apos;XXXX&apos;),2,4), &apos; &apos;, &apos;0&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">        elsif (ascii_output) then</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">             result := replace(asciistr(ch), &apos;\&apos;, &apos;\u&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">      return result;</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  function escapeString(str varchar2) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">    sb varchar2(32767 byte) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">    buf varchar2(40);</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">    ch varchar2(1 char); /* unicode char */</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">    if(str is null) then return &apos;&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">    -- clear the cache if global parameters have been changed</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">    if char_map_escape_solidus &lt;&gt; escape_solidus or</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">       char_map_ascii_output   &lt;&gt; ascii_output</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">    then</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">       char_map.delete;</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">       char_map_escape_solidus := escape_solidus;</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">       char_map_ascii_output := ascii_output;</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">    for i in 1 .. length(str) loop</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql">      ch := substr(str, i, 1 ) ;</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">      begin</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">         -- it this char has already been processed, I have cached its escaped value</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">         buf:=char_map(ch);</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">      exception when no_Data_found then</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">         -- otherwise, i convert the value and add it to the cache</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">         buf := escapeChar(ch);</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">         char_map(ch) := buf;</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">      end;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">      sb := sb || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">    return sb;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">  end escapeString;</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">  function newline(spaces boolean) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">    cur_line_len := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">    if(spaces) then return newline_char; else return &apos;&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">/*  function get_schema return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">    return sys_context(&apos;userenv&apos;, &apos;current_schema&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">*/</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">  function tab(indent number, spaces boolean) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">    i varchar(200) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">    if(not spaces) then return &apos;&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">    for x in 1 .. indent loop i := i || indent_string; end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">    return i;</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">  function getCommaSep(spaces boolean) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">    if(spaces) then return &apos;, &apos;; else return &apos;,&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">  function getMemName(mem pljson_value, spaces boolean) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">    if(spaces) then</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">      return llcheck(&apos;&quot;&apos;||escapeString(mem.mapname)||&apos;&quot;&apos;) || llcheck(&apos; : &apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">      return llcheck(&apos;&quot;&apos;||escapeString(mem.mapname)||&apos;&quot;&apos;) || llcheck(&apos;:&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">  /* Clob method start here */</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">  procedure add_to_clob(buf_lob in out nocopy clob, buf_str in out nocopy varchar2, str varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">    if(lengthb(str) &gt; 32767 - lengthb(buf_str)) then</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">--      dbms_lob.append(buf_lob, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">      dbms_lob.writeappend(buf_lob, length(buf_str), buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">      buf_str := str;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">      buf_str := buf_str || str;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">  end add_to_clob;</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">  procedure flush_clob(buf_lob in out nocopy clob, buf_str in out nocopy varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">    --dbms_lob.append(buf_lob, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">    dbms_lob.writeappend(buf_lob, length(buf_str), buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">  end flush_clob;</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">  procedure ppObj(obj pljson, indent number, buf in out nocopy clob, spaces boolean, buf_str in out nocopy varchar2);</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql">  procedure ppString(elem pljson_value, buf in out nocopy clob, buf_str in out nocopy varchar2) is</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">    offset number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">    /* E.I.Sarmas (github.com/dsnz)   2016-01-21   limit to 5000 chars */</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">    v_str varchar(5000 char);</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">    amount number := 5000; /* chunk size for use in escapeString; maximum escaped unicode string size for chunk may be 6 one-byte chars * 5000 chunk size in multi-byte chars = 30000 1-byte chars (maximum value is 32767 1-byte chars) */</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">    if empty_string_as_null and elem.extended_str is null and elem.str is null then</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">      add_to_clob(buf, buf_str, &apos;null&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">      add_to_clob(buf, buf_str, case when elem.num = 1 then &apos;&quot;&apos; else &apos;/**/&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">      if(elem.extended_str is not null) then --clob implementation</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">        while(offset &lt;= dbms_lob.getlength(elem.extended_str)) loop</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">          dbms_lob.read(elem.extended_str, amount, offset, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">          if(elem.num = 1) then</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">            add_to_clob(buf, buf_str, escapeString(v_str));</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">            add_to_clob(buf, buf_str, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">          offset := offset + amount;</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">        if(elem.num = 1) then</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">          while(offset&lt;=length(elem.str)) loop</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">            v_str:=substr(elem.str, offset, amount);</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">            add_to_clob(buf, buf_str, escapeString(v_str));</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">            offset := offset + amount;</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">          add_to_clob(buf, buf_str, elem.str);</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">      add_to_clob(buf, buf_str, case when elem.num = 1 then &apos;&quot;&apos; else &apos;/**/&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">  procedure ppEA(input pljson_list, indent number, buf in out nocopy clob, spaces boolean, buf_str in out nocopy varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">    elem pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">    arr pljson_value_array := input.list_data;</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">    numbuf varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">    for y in 1 .. arr.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">      elem := arr(y);</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">      if(elem is not null) then</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">      case elem.get_type</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">        when &apos;number&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">          numbuf := elem.number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">          add_to_clob(buf, buf_str, llcheck(numbuf));</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">        when &apos;string&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">          ppString(elem, buf, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">        when &apos;bool&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">          if(elem.get_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">            add_to_clob(buf, buf_str, llcheck(&apos;true&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">            add_to_clob(buf, buf_str, llcheck(&apos;false&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">        when &apos;null&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">          add_to_clob(buf, buf_str, llcheck(&apos;null&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">        when &apos;array&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">          add_to_clob(buf, buf_str, llcheck(&apos;[&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">          ppEA(pljson_list(elem), indent, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">          add_to_clob(buf, buf_str, llcheck(&apos;]&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">        when &apos;object&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">          ppObj(pljson(elem), indent, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">        else add_to_clob(buf, buf_str, llcheck(elem.get_type));</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">      if(y != arr.count) then add_to_clob(buf, buf_str, llcheck(getCommaSep(spaces))); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">  end ppEA;</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">  procedure ppMem(mem pljson_value, indent number, buf in out nocopy clob, spaces boolean, buf_str in out nocopy varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">    numbuf varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">    add_to_clob(buf, buf_str, llcheck(tab(indent, spaces)) || llcheck(getMemName(mem, spaces)));</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">    case mem.get_type</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">      when &apos;number&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">        numbuf := mem.number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">        add_to_clob(buf, buf_str, llcheck(numbuf));</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">      when &apos;string&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">        ppString(mem, buf, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">      when &apos;bool&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">        if(mem.get_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">          add_to_clob(buf, buf_str, llcheck(&apos;true&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">          add_to_clob(buf, buf_str, llcheck(&apos;false&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql">      when &apos;null&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">        add_to_clob(buf, buf_str, llcheck(&apos;null&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">      when &apos;array&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql">        add_to_clob(buf, buf_str, llcheck(&apos;[&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">        ppEA(pljson_list(mem), indent, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">        add_to_clob(buf, buf_str, llcheck(&apos;]&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql">      when &apos;object&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">        ppObj(pljson(mem), indent, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql">      else add_to_clob(buf, buf_str, llcheck(mem.get_type));</code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql">    end case;</code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">  end ppMem;</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">  procedure ppObj(obj pljson, indent number, buf in out nocopy clob, spaces boolean, buf_str in out nocopy varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">    add_to_clob(buf, buf_str, llcheck(&apos;{&apos;) || newline(spaces));</code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">    for m in 1 .. obj.json_data.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql">      ppMem(obj.json_data(m), indent+1, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">      if(m != obj.json_data.count) then</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql">        add_to_clob(buf, buf_str, llcheck(&apos;,&apos;) || newline(spaces));</code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql">        add_to_clob(buf, buf_str, newline(spaces));</code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="252">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql">    add_to_clob(buf, buf_str, llcheck(tab(indent, spaces)) || llcheck(&apos;}&apos;)); -- || chr(13);</code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql">  end ppObj;</code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql">  procedure pretty_print(obj pljson, spaces boolean default true, buf in out nocopy clob, line_length number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">    buf_str varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">    amount number := dbms_lob.getlength(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="259">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">    if(erase_clob and amount &gt; 0) then dbms_lob.trim(buf, 0); dbms_lob.erase(buf, amount); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="261">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">    max_line_len := line_length;</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql">    cur_line_len := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql">    ppObj(obj, 0, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">    flush_clob(buf, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="268">
            <code class="sql">  procedure pretty_print_list(obj pljson_list, spaces boolean default true, buf in out nocopy clob, line_length number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql">    buf_str varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="270">
            <code class="sql">    amount number := dbms_lob.getlength(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="271">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="272">
            <code class="sql">    if(erase_clob and amount &gt; 0) then dbms_lob.trim(buf, 0); dbms_lob.erase(buf, amount); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="273">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="274">
            <code class="sql">    max_line_len := line_length;</code></li>
            <li class="never" data-hits="" data-linenumber="275">
            <code class="sql">    cur_line_len := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">    add_to_clob(buf, buf_str, llcheck(&apos;[&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="277">
            <code class="sql">    ppEA(obj, 0, buf, spaces, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="278">
            <code class="sql">    add_to_clob(buf, buf_str, llcheck(&apos;]&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="279">
            <code class="sql">    flush_clob(buf, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="280">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="281">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">  procedure pretty_print_any(json_part pljson_value, spaces boolean default true, buf in out nocopy clob, line_length number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="283">
            <code class="sql">    buf_str varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="284">
            <code class="sql">    numbuf varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">    amount number := dbms_lob.getlength(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="286">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="287">
            <code class="sql">    if(erase_clob and amount &gt; 0) then dbms_lob.trim(buf, 0); dbms_lob.erase(buf, amount); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="288">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="289">
            <code class="sql">    case json_part.get_type</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">      when &apos;number&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql">        numbuf := json_part.number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="292">
            <code class="sql">        add_to_clob(buf, buf_str, numbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="293">
            <code class="sql">      when &apos;string&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="294">
            <code class="sql">        ppString(json_part, buf, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">      when &apos;bool&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="296">
            <code class="sql">        if(json_part.get_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="297">
            <code class="sql">          add_to_clob(buf, buf_str, &apos;true&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="299">
            <code class="sql">          add_to_clob(buf, buf_str, &apos;false&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="300">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="301">
            <code class="sql">      when &apos;null&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="302">
            <code class="sql">        add_to_clob(buf, buf_str, &apos;null&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql">      when &apos;array&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">        pretty_print_list(pljson_list(json_part), spaces, buf, line_length);</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql">        return;</code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql">      when &apos;object&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="307">
            <code class="sql">        pretty_print(pljson(json_part), spaces, buf, line_length);</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql">        return;</code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql">      else add_to_clob(buf, buf_str, &apos;unknown type:&apos;|| json_part.get_type);</code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">    end case;</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql">    flush_clob(buf, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="313">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="314">
            <code class="sql">  /* Clob method end here */</code></li>
            <li class="never" data-hits="" data-linenumber="315">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="316">
            <code class="sql">  /* Varchar2 method start here */</code></li>
            <li class="never" data-hits="" data-linenumber="317">
            <code class="sql">  procedure add_buf (buf in out nocopy varchar2, str in varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="318">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="319">
            <code class="sql">    if(lengthb(str)&gt;32767-lengthb(buf)) then</code></li>
            <li class="never" data-hits="" data-linenumber="320">
            <code class="sql">      raise_application_error(-20001,&apos;Length of result JSON more than 32767 bytes. Use to_clob() procedures&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="321">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="322">
            <code class="sql">    buf := buf || str;</code></li>
            <li class="never" data-hits="" data-linenumber="323">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="324">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="325">
            <code class="sql">  procedure ppString(elem pljson_value, buf in out nocopy varchar2) is</code></li>
            <li class="never" data-hits="" data-linenumber="326">
            <code class="sql">    offset number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="327">
            <code class="sql">    /* E.I.Sarmas (github.com/dsnz)   2016-01-21   limit to 5000 chars */</code></li>
            <li class="never" data-hits="" data-linenumber="328">
            <code class="sql">    v_str varchar(5000 char);</code></li>
            <li class="never" data-hits="" data-linenumber="329">
            <code class="sql">    amount number := 5000; /* chunk size for use in escapeString; maximum escaped unicode string size for chunk may be 6 one-byte chars * 5000 chunk size in multi-byte chars = 30000 1-byte chars (maximum value is 32767 1-byte chars) */</code></li>
            <li class="never" data-hits="" data-linenumber="330">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="331">
            <code class="sql">    if empty_string_as_null and elem.extended_str is null and elem.str is null then</code></li>
            <li class="never" data-hits="" data-linenumber="332">
            <code class="sql">      add_buf(buf, &apos;null&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="333">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="334">
            <code class="sql">      add_buf(buf, case when elem.num = 1 then &apos;&quot;&apos; else &apos;/**/&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="335">
            <code class="sql">      if(elem.extended_str is not null) then --clob implementation</code></li>
            <li class="never" data-hits="" data-linenumber="336">
            <code class="sql">        while(offset &lt;= dbms_lob.getlength(elem.extended_str)) loop</code></li>
            <li class="never" data-hits="" data-linenumber="337">
            <code class="sql">          dbms_lob.read(elem.extended_str, amount, offset, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="338">
            <code class="sql">          if(elem.num = 1) then</code></li>
            <li class="never" data-hits="" data-linenumber="339">
            <code class="sql">            add_buf(buf, escapeString(v_str));</code></li>
            <li class="never" data-hits="" data-linenumber="340">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="341">
            <code class="sql">            add_buf(buf, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="342">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="343">
            <code class="sql">          offset := offset + amount;</code></li>
            <li class="never" data-hits="" data-linenumber="344">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="345">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="346">
            <code class="sql">        if(elem.num = 1) then</code></li>
            <li class="never" data-hits="" data-linenumber="347">
            <code class="sql">          while(offset&lt;=length(elem.str)) loop</code></li>
            <li class="never" data-hits="" data-linenumber="348">
            <code class="sql">            v_str:=substr(elem.str, offset, amount);</code></li>
            <li class="never" data-hits="" data-linenumber="349">
            <code class="sql">            add_buf(buf, escapeString(v_str));</code></li>
            <li class="never" data-hits="" data-linenumber="350">
            <code class="sql">            offset := offset + amount;</code></li>
            <li class="never" data-hits="" data-linenumber="351">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="352">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="353">
            <code class="sql">          add_buf(buf, elem.str);</code></li>
            <li class="never" data-hits="" data-linenumber="354">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="355">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="356">
            <code class="sql">      add_buf(buf, case when elem.num = 1 then &apos;&quot;&apos; else &apos;/**/&apos; end);</code></li>
            <li class="never" data-hits="" data-linenumber="357">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="358">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="359">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="360">
            <code class="sql">  procedure ppObj(obj pljson, indent number, buf in out nocopy varchar2, spaces boolean);</code></li>
            <li class="never" data-hits="" data-linenumber="361">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="362">
            <code class="sql">  procedure ppEA(input pljson_list, indent number, buf in out varchar2, spaces boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="363">
            <code class="sql">    elem pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="364">
            <code class="sql">    arr pljson_value_array := input.list_data;</code></li>
            <li class="never" data-hits="" data-linenumber="365">
            <code class="sql">    str varchar2(400);</code></li>
            <li class="never" data-hits="" data-linenumber="366">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="367">
            <code class="sql">    for y in 1 .. arr.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="368">
            <code class="sql">      elem := arr(y);</code></li>
            <li class="never" data-hits="" data-linenumber="369">
            <code class="sql">      if(elem is not null) then</code></li>
            <li class="never" data-hits="" data-linenumber="370">
            <code class="sql">      case elem.get_type</code></li>
            <li class="never" data-hits="" data-linenumber="371">
            <code class="sql">        when &apos;number&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="372">
            <code class="sql">          str := elem.number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="373">
            <code class="sql">          add_buf(buf, llcheck(str));</code></li>
            <li class="never" data-hits="" data-linenumber="374">
            <code class="sql">        when &apos;string&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="375">
            <code class="sql">          ppString(elem, buf);</code></li>
            <li class="never" data-hits="" data-linenumber="376">
            <code class="sql">        when &apos;bool&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="377">
            <code class="sql">          if(elem.get_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="378">
            <code class="sql">            add_buf (buf, llcheck(&apos;true&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="379">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="380">
            <code class="sql">            add_buf (buf, llcheck(&apos;false&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="381">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="382">
            <code class="sql">        when &apos;null&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="383">
            <code class="sql">          add_buf (buf, llcheck(&apos;null&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="384">
            <code class="sql">        when &apos;array&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="385">
            <code class="sql">          add_buf( buf, llcheck(&apos;[&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="386">
            <code class="sql">          ppEA(pljson_list(elem), indent, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="387">
            <code class="sql">          add_buf( buf, llcheck(&apos;]&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="388">
            <code class="sql">        when &apos;object&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="389">
            <code class="sql">          ppObj(pljson(elem), indent, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="390">
            <code class="sql">        else add_buf (buf, llcheck(elem.get_type)); /* should never happen */</code></li>
            <li class="never" data-hits="" data-linenumber="391">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="392">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="393">
            <code class="sql">      if(y != arr.count) then add_buf(buf, llcheck(getCommaSep(spaces))); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="394">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="395">
            <code class="sql">  end ppEA;</code></li>
            <li class="never" data-hits="" data-linenumber="396">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="397">
            <code class="sql">  procedure ppMem(mem pljson_value, indent number, buf in out nocopy varchar2, spaces boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="398">
            <code class="sql">    str varchar2(400) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="399">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="400">
            <code class="sql">    add_buf(buf, llcheck(tab(indent, spaces)) || getMemName(mem, spaces));</code></li>
            <li class="never" data-hits="" data-linenumber="401">
            <code class="sql">    case mem.get_type</code></li>
            <li class="never" data-hits="" data-linenumber="402">
            <code class="sql">      when &apos;number&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="403">
            <code class="sql">        str := mem.number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="404">
            <code class="sql">        add_buf(buf, llcheck(str));</code></li>
            <li class="never" data-hits="" data-linenumber="405">
            <code class="sql">      when &apos;string&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="406">
            <code class="sql">        ppString(mem, buf);</code></li>
            <li class="never" data-hits="" data-linenumber="407">
            <code class="sql">      when &apos;bool&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="408">
            <code class="sql">        if(mem.get_bool) then</code></li>
            <li class="never" data-hits="" data-linenumber="409">
            <code class="sql">          add_buf(buf, llcheck(&apos;true&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="410">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="411">
            <code class="sql">          add_buf(buf, llcheck(&apos;false&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="412">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="413">
            <code class="sql">      when &apos;null&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="414">
            <code class="sql">        add_buf(buf, llcheck(&apos;null&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="415">
            <code class="sql">      when &apos;array&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="416">
            <code class="sql">        add_buf(buf, llcheck(&apos;[&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="417">
            <code class="sql">        ppEA(pljson_list(mem), indent, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="418">
            <code class="sql">        add_buf(buf, llcheck(&apos;]&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="419">
            <code class="sql">      when &apos;object&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="420">
            <code class="sql">        ppObj(pljson(mem), indent, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="421">
            <code class="sql">      else add_buf(buf, llcheck(mem.get_type)); /* should never happen */</code></li>
            <li class="never" data-hits="" data-linenumber="422">
            <code class="sql">    end case;</code></li>
            <li class="never" data-hits="" data-linenumber="423">
            <code class="sql">  end ppMem;</code></li>
            <li class="never" data-hits="" data-linenumber="424">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="425">
            <code class="sql">  procedure ppObj(obj pljson, indent number, buf in out nocopy varchar2, spaces boolean) as</code></li>
            <li class="never" data-hits="" data-linenumber="426">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="427">
            <code class="sql">    add_buf (buf, llcheck(&apos;{&apos;) || newline(spaces));</code></li>
            <li class="never" data-hits="" data-linenumber="428">
            <code class="sql">    for m in 1 .. obj.json_data.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="429">
            <code class="sql">      ppMem(obj.json_data(m), indent+1, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="430">
            <code class="sql">      if(m != obj.json_data.count) then add_buf(buf, llcheck(&apos;,&apos;) || newline(spaces));</code></li>
            <li class="never" data-hits="" data-linenumber="431">
            <code class="sql">      else add_buf(buf, newline(spaces)); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="432">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="433">
            <code class="sql">    add_buf(buf, llcheck(tab(indent, spaces)) || llcheck(&apos;}&apos;)); -- || chr(13);</code></li>
            <li class="never" data-hits="" data-linenumber="434">
            <code class="sql">  end ppObj;</code></li>
            <li class="never" data-hits="" data-linenumber="435">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="436">
            <code class="sql">  function pretty_print(obj pljson, spaces boolean default true, line_length number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="437">
            <code class="sql">    buf varchar2(32767 byte) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="438">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="439">
            <code class="sql">    max_line_len := line_length;</code></li>
            <li class="never" data-hits="" data-linenumber="440">
            <code class="sql">    cur_line_len := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="441">
            <code class="sql">    ppObj(obj, 0, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="442">
            <code class="sql">    return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="443">
            <code class="sql">  end pretty_print;</code></li>
            <li class="never" data-hits="" data-linenumber="444">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="445">
            <code class="sql">  function pretty_print_list(obj pljson_list, spaces boolean default true, line_length number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="446">
            <code class="sql">    buf varchar2(32767 byte) :=&apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="447">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="448">
            <code class="sql">    max_line_len := line_length;</code></li>
            <li class="never" data-hits="" data-linenumber="449">
            <code class="sql">    cur_line_len := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="450">
            <code class="sql">    add_buf(buf, llcheck(&apos;[&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="451">
            <code class="sql">    ppEA(obj, 0, buf, spaces);</code></li>
            <li class="never" data-hits="" data-linenumber="452">
            <code class="sql">    add_buf(buf, llcheck(&apos;]&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="453">
            <code class="sql">    return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="454">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="455">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="456">
            <code class="sql">  function pretty_print_any(json_part pljson_value, spaces boolean default true, line_length number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="457">
            <code class="sql">    buf varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="458">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="459">
            <code class="sql">    case json_part.get_type</code></li>
            <li class="never" data-hits="" data-linenumber="460">
            <code class="sql">      when &apos;number&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="461">
            <code class="sql">        buf := json_part.number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="462">
            <code class="sql">      when &apos;string&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="463">
            <code class="sql">        ppString(json_part, buf);</code></li>
            <li class="never" data-hits="" data-linenumber="464">
            <code class="sql">      when &apos;bool&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="465">
            <code class="sql">        if(json_part.get_bool) then buf := &apos;true&apos;; else buf := &apos;false&apos;; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="466">
            <code class="sql">      when &apos;null&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="467">
            <code class="sql">        buf := &apos;null&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="468">
            <code class="sql">      when &apos;array&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="469">
            <code class="sql">        buf := pretty_print_list(pljson_list(json_part), spaces, line_length);</code></li>
            <li class="never" data-hits="" data-linenumber="470">
            <code class="sql">      when &apos;object&apos; then</code></li>
            <li class="never" data-hits="" data-linenumber="471">
            <code class="sql">        buf := pretty_print(pljson(json_part), spaces, line_length);</code></li>
            <li class="never" data-hits="" data-linenumber="472">
            <code class="sql">      else buf := &apos;weird error: &apos;|| json_part.get_type;</code></li>
            <li class="never" data-hits="" data-linenumber="473">
            <code class="sql">    end case;</code></li>
            <li class="never" data-hits="" data-linenumber="474">
            <code class="sql">    return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="475">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="476">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="477">
            <code class="sql">  procedure dbms_output_clob(my_clob clob, delim varchar2, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="478">
            <code class="sql">    prev number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="479">
            <code class="sql">    indx number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="480">
            <code class="sql">    size_of_nl number := lengthb(delim);</code></li>
            <li class="never" data-hits="" data-linenumber="481">
            <code class="sql">    v_str varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="482">
            <code class="sql">    amount number := 8191; /* max unicode chars */</code></li>
            <li class="never" data-hits="" data-linenumber="483">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="484">
            <code class="sql">    if(jsonp is not null) then dbms_output.put_line(jsonp||&apos;(&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="485">
            <code class="sql">    while(indx != 0) loop</code></li>
            <li class="never" data-hits="" data-linenumber="486">
            <code class="sql">      --read every line</code></li>
            <li class="never" data-hits="" data-linenumber="487">
            <code class="sql">      indx := dbms_lob.instr(my_clob, delim, prev+1);</code></li>
            <li class="never" data-hits="" data-linenumber="488">
            <code class="sql">      --dbms_output.put_line(prev || &apos; to &apos; || indx);</code></li>
            <li class="never" data-hits="" data-linenumber="489">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="490">
            <code class="sql">      if(indx = 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="491">
            <code class="sql">        --emit from prev to end;</code></li>
            <li class="never" data-hits="" data-linenumber="492">
            <code class="sql">        amount := 8191; /* max unicode chars */</code></li>
            <li class="never" data-hits="" data-linenumber="493">
            <code class="sql">        --dbms_output.put_line(&apos; mycloblen &apos; || dbms_lob.getlength(my_clob));</code></li>
            <li class="never" data-hits="" data-linenumber="494">
            <code class="sql">        loop</code></li>
            <li class="never" data-hits="" data-linenumber="495">
            <code class="sql">          dbms_lob.read(my_clob, amount, prev, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="496">
            <code class="sql">          dbms_output.put_line(v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="497">
            <code class="sql">          prev := prev+amount-1;</code></li>
            <li class="never" data-hits="" data-linenumber="498">
            <code class="sql">          exit when prev &gt;= dbms_lob.getlength(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="499">
            <code class="sql">        end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="500">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="501">
            <code class="sql">        amount := indx - prev;</code></li>
            <li class="never" data-hits="" data-linenumber="502">
            <code class="sql">        if(amount &gt; 8191) then /* max unicode chars */</code></li>
            <li class="never" data-hits="" data-linenumber="503">
            <code class="sql">          amount := 8191; /* max unicode chars */</code></li>
            <li class="never" data-hits="" data-linenumber="504">
            <code class="sql">          --dbms_output.put_line(&apos; mycloblen &apos; || dbms_lob.getlength(my_clob));</code></li>
            <li class="never" data-hits="" data-linenumber="505">
            <code class="sql">          loop</code></li>
            <li class="never" data-hits="" data-linenumber="506">
            <code class="sql">            dbms_lob.read(my_clob, amount, prev, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="507">
            <code class="sql">            dbms_output.put_line(v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="508">
            <code class="sql">            prev := prev+amount-1;</code></li>
            <li class="never" data-hits="" data-linenumber="509">
            <code class="sql">            amount := indx - prev;</code></li>
            <li class="never" data-hits="" data-linenumber="510">
            <code class="sql">            exit when prev &gt;= indx - 1;</code></li>
            <li class="never" data-hits="" data-linenumber="511">
            <code class="sql">            if(amount &gt; 8191) then amount := 8191; end if; /* max unicode chars */</code></li>
            <li class="never" data-hits="" data-linenumber="512">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="513">
            <code class="sql">          prev := indx + size_of_nl;</code></li>
            <li class="never" data-hits="" data-linenumber="514">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="515">
            <code class="sql">          dbms_lob.read(my_clob, amount, prev, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="516">
            <code class="sql">          dbms_output.put_line(v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="517">
            <code class="sql">          prev := indx + size_of_nl;</code></li>
            <li class="never" data-hits="" data-linenumber="518">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="519">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="520">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="521">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="522">
            <code class="sql">    if(jsonp is not null) then dbms_output.put_line(&apos;)&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="523">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="524">
            <code class="sql">/*    while (amount != 0) loop</code></li>
            <li class="never" data-hits="" data-linenumber="525">
            <code class="sql">      indx := dbms_lob.instr(my_clob, delim, prev+1);</code></li>
            <li class="never" data-hits="" data-linenumber="526">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="527">
            <code class="sql">--      dbms_output.put_line(prev || &apos; to &apos; || indx);</code></li>
            <li class="never" data-hits="" data-linenumber="528">
            <code class="sql">      if(indx = 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="529">
            <code class="sql">        indx := dbms_lob.getlength(my_clob)+1;</code></li>
            <li class="never" data-hits="" data-linenumber="530">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="531">
            <code class="sql">      if(indx-prev &gt; 32767) then</code></li>
            <li class="never" data-hits="" data-linenumber="532">
            <code class="sql">        indx := prev+32767;</code></li>
            <li class="never" data-hits="" data-linenumber="533">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="534">
            <code class="sql">--      dbms_output.put_line(prev || &apos; to &apos; || indx);</code></li>
            <li class="never" data-hits="" data-linenumber="535">
            <code class="sql">      --substr doesnt work properly on all platforms! (come on oracle - error on Oracle VM for virtualbox)</code></li>
            <li class="never" data-hits="" data-linenumber="536">
            <code class="sql">--        dbms_output.put_line(dbms_lob.substr(my_clob, indx-prev, prev));</code></li>
            <li class="never" data-hits="" data-linenumber="537">
            <code class="sql">      amount := indx-prev;</code></li>
            <li class="never" data-hits="" data-linenumber="538">
            <code class="sql">--        dbms_output.put_line(&apos;amount&apos;||amount);</code></li>
            <li class="never" data-hits="" data-linenumber="539">
            <code class="sql">      dbms_lob.read(my_clob, amount, prev, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="540">
            <code class="sql">      dbms_output.put_line(v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="541">
            <code class="sql">      prev := indx+size_of_nl;</code></li>
            <li class="never" data-hits="" data-linenumber="542">
            <code class="sql">      if(amount = 32767) then prev := prev-size_of_nl-1; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="543">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="544">
            <code class="sql">    if(jsonp is not null) then dbms_output.put_line(&apos;)&apos;); end if;*/</code></li>
            <li class="never" data-hits="" data-linenumber="545">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="546">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="547">
            <code class="sql">/*  procedure dbms_output_clob(my_clob clob, delim varchar2, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="548">
            <code class="sql">    prev number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="549">
            <code class="sql">    indx number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="550">
            <code class="sql">    size_of_nl number := lengthb(delim);</code></li>
            <li class="never" data-hits="" data-linenumber="551">
            <code class="sql">    v_str varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="552">
            <code class="sql">    amount number;</code></li>
            <li class="never" data-hits="" data-linenumber="553">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="554">
            <code class="sql">    if(jsonp is not null) then dbms_output.put_line(jsonp||&apos;(&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="555">
            <code class="sql">    while (indx != 0) loop</code></li>
            <li class="never" data-hits="" data-linenumber="556">
            <code class="sql">      indx := dbms_lob.instr(my_clob, delim, prev+1);</code></li>
            <li class="never" data-hits="" data-linenumber="557">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="558">
            <code class="sql">      --dbms_output.put_line(prev || &apos; to &apos; || indx);</code></li>
            <li class="never" data-hits="" data-linenumber="559">
            <code class="sql">      if(indx-prev &gt; 32767) then</code></li>
            <li class="never" data-hits="" data-linenumber="560">
            <code class="sql">        indx := prev+32767;</code></li>
            <li class="never" data-hits="" data-linenumber="561">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="562">
            <code class="sql">      --dbms_output.put_line(prev || &apos; to &apos; || indx);</code></li>
            <li class="never" data-hits="" data-linenumber="563">
            <code class="sql">      --substr doesnt work properly on all platforms! (come on oracle - error on Oracle VM for virtualbox)</code></li>
            <li class="never" data-hits="" data-linenumber="564">
            <code class="sql">      if(indx = 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="565">
            <code class="sql">        --dbms_output.put_line(dbms_lob.substr(my_clob, dbms_lob.getlength(my_clob)-prev+size_of_nl, prev));</code></li>
            <li class="never" data-hits="" data-linenumber="566">
            <code class="sql">        amount := dbms_lob.getlength(my_clob)-prev+size_of_nl;</code></li>
            <li class="never" data-hits="" data-linenumber="567">
            <code class="sql">        dbms_lob.read(my_clob, amount, prev, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="568">
            <code class="sql">      else</code></li>
            <li class="never" data-hits="" data-linenumber="569">
            <code class="sql">        --dbms_output.put_line(dbms_lob.substr(my_clob, indx-prev, prev));</code></li>
            <li class="never" data-hits="" data-linenumber="570">
            <code class="sql">        amount := indx-prev;</code></li>
            <li class="never" data-hits="" data-linenumber="571">
            <code class="sql">        --dbms_output.put_line(&apos;amount&apos;||amount);</code></li>
            <li class="never" data-hits="" data-linenumber="572">
            <code class="sql">        dbms_lob.read(my_clob, amount, prev, v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="573">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="574">
            <code class="sql">      dbms_output.put_line(v_str);</code></li>
            <li class="never" data-hits="" data-linenumber="575">
            <code class="sql">      prev := indx+size_of_nl;</code></li>
            <li class="never" data-hits="" data-linenumber="576">
            <code class="sql">      if(amount = 32767) then prev := prev-size_of_nl-1; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="577">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="578">
            <code class="sql">    if(jsonp is not null) then dbms_output.put_line(&apos;)&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="579">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="580">
            <code class="sql">*/</code></li>
            <li class="never" data-hits="" data-linenumber="581">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="582">
            <code class="sql">  procedure htp_output_clob(my_clob clob, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="583">
            <code class="sql">    /*amount number := 4096;</code></li>
            <li class="never" data-hits="" data-linenumber="584">
            <code class="sql">    pos number := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="585">
            <code class="sql">    len number;</code></li>
            <li class="never" data-hits="" data-linenumber="586">
            <code class="sql">    */</code></li>
            <li class="never" data-hits="" data-linenumber="587">
            <code class="sql">    l_amt    number default 30;</code></li>
            <li class="never" data-hits="" data-linenumber="588">
            <code class="sql">    l_off   number default 1;</code></li>
            <li class="never" data-hits="" data-linenumber="589">
            <code class="sql">    l_str   varchar2(4096);</code></li>
            <li class="never" data-hits="" data-linenumber="590">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="591">
            <code class="sql">    if(jsonp is not null) then htp.prn(jsonp||&apos;(&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="592">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="593">
            <code class="sql">    begin</code></li>
            <li class="never" data-hits="" data-linenumber="594">
            <code class="sql">      loop</code></li>
            <li class="never" data-hits="" data-linenumber="595">
            <code class="sql">        dbms_lob.read( my_clob, l_amt, l_off, l_str );</code></li>
            <li class="never" data-hits="" data-linenumber="596">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="597">
            <code class="sql">        -- it is vital to use htp.PRN to avoid</code></li>
            <li class="never" data-hits="" data-linenumber="598">
            <code class="sql">        -- spurious line feeds getting added to your</code></li>
            <li class="never" data-hits="" data-linenumber="599">
            <code class="sql">        -- document</code></li>
            <li class="never" data-hits="" data-linenumber="600">
            <code class="sql">        htp.prn( l_str  );</code></li>
            <li class="never" data-hits="" data-linenumber="601">
            <code class="sql">        l_off := l_off+l_amt;</code></li>
            <li class="never" data-hits="" data-linenumber="602">
            <code class="sql">        l_amt := 4096;</code></li>
            <li class="never" data-hits="" data-linenumber="603">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="604">
            <code class="sql">    exception</code></li>
            <li class="never" data-hits="" data-linenumber="605">
            <code class="sql">      when no_data_found then NULL;</code></li>
            <li class="never" data-hits="" data-linenumber="606">
            <code class="sql">    end;</code></li>
            <li class="never" data-hits="" data-linenumber="607">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="608">
            <code class="sql">    /*</code></li>
            <li class="never" data-hits="" data-linenumber="609">
            <code class="sql">    len := dbms_lob.getlength(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="610">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="611">
            <code class="sql">    while(pos &lt; len) loop</code></li>
            <li class="never" data-hits="" data-linenumber="612">
            <code class="sql">      htp.prn(dbms_lob.substr(my_clob, amount, pos)); -- should I replace substr with dbms_lob.read?</code></li>
            <li class="never" data-hits="" data-linenumber="613">
            <code class="sql">      --dbms_output.put_line(dbms_lob.substr(my_clob, amount, pos));</code></li>
            <li class="never" data-hits="" data-linenumber="614">
            <code class="sql">      pos := pos + amount;</code></li>
            <li class="never" data-hits="" data-linenumber="615">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="616">
            <code class="sql">    */</code></li>
            <li class="never" data-hits="" data-linenumber="617">
            <code class="sql">    if(jsonp is not null) then htp.prn(&apos;)&apos;); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="618">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="619">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="620">
            <code class="sql">end pljson_printer;</code></li></ol></pre></div><div class="source_table" id="054F3C7DC9A5D6BF522C518AF47F1C0A"><div class="header"> <h3>DEV.PLJSON_TABLE_IMPL</h3><h4><span class="red">0 %</span> covered</h4><div> <b>237</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>237</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">type body pljson_table_impl as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  Copyright (c) 2016 E.I.Sarmas (github.com/dsnz)</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  Permission is hereby granted, free of charge, to any person obtaining a copy</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  of this software and associated documentation files (the &quot;Software&quot;), to deal</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">  in the Software without restriction, including without limitation the rights</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">  copies of the Software, and to permit persons to whom the Software is</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">  furnished to do so, subject to the following conditions:</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  The above copyright notice and this permission notice shall be included in</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  all copies or substantial portions of the Software.</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql">  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">  THE SOFTWARE.</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">  E.I.Sarmas (github.com/dsnz)   2016-02-09</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">  implementation and demo for json_table.json_table() functionality</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  modelled after Oracle 12c json_table()</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  this type/package is intended to work within the</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">  pljson library (https://github.com/pljson)</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql">  static function ODCITableDescribe(rtype out anytype,</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">    str clob, paths pljson_varray, names pljson_varray := null) return number is</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">    atyp anytype;</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql">    --dbms_output.put_line(&apos;&gt;&gt;Describe&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">    anytype.begincreate(dbms_types.typecode_object, atyp);</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">    if names is null then</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">      for i in paths.FIRST .. paths.LAST loop</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">        atyp.addattr(&apos;JSON_&apos; || ltrim(to_char(i)), dbms_types.typecode_varchar2, null, null, 32767, null, null);</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">      for i in names.FIRST .. names.LAST loop</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">        atyp.addattr(upper(names(i)), dbms_types.typecode_varchar2, null, null, 32767, null, null);</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">    atyp.endcreate;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">    anytype.begincreate(dbms_types.typecode_table, rtype);</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">    rtype.SetInfo(null, null, null, null, null, atyp, dbms_types.typecode_object, 0);</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">    rtype.endcreate();</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">    return odciconst.success;</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  exception</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">    when others then</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">      return odciconst.error;</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">  static function ODCITablePrepare(sctx out pljson_table_impl, ti in sys.ODCITabFuncInfo,</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">    str clob, paths pljson_varray, names pljson_varray := null) return number is</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">    elem_typ sys.anytype;</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">    prec  pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">    scale pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">    len   pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">    csid  pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">    csfrm pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">    tc    pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">    aname varchar2(30);</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">    --dbms_output.put_line(&apos;&gt;&gt;Prepare&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">    tc := ti.RetType.GetAttrElemInfo(1, prec, scale, len, csid, csfrm, elem_typ, aname);</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">    sctx := pljson_table_impl(str, paths, names, pljson_vtab(), pljson_narray(), elem_typ);</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">    return odciconst.success;</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">  static function ODCITableStart(sctx in out pljson_table_impl,</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">    str clob, paths pljson_varray, names pljson_varray := null) return number is</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">    json_obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">    json_val pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">    buf varchar2(32767);</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">    --data_tab pljson_vtab := pljson_vtab();</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">    json_array pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">    json_elem pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">    value_array pljson_varray := pljson_varray();</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">    --dbms_output.put_line(&apos;&gt;&gt;Start&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">    sctx.data_tab.delete;</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">    --dbms_output.put_line(&apos;json_str=&apos;||str);</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">    json_obj := pljson(str);</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">    for i in paths.FIRST .. paths.LAST loop</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">      --dbms_output.put_line(&apos;path=&apos;||paths(i));</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">      json_val := pljson_ext.get_json_value(json_obj, paths(i));</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">      --dbms_output.put_line(&apos;type=&apos;||json_val.get_type());</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">      case json_val.typeval</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">        --when 1 then &apos;object&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">        when 2 then -- &apos;array&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">          json_array := pljson_list(json_val);</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">          value_array.delete;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">          for j in 1 .. json_array.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">            json_elem := json_array.get(j);</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">            case json_elem.typeval</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">              --when 1 then &apos;object&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">              --when 2 then -- &apos;array&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">              when 3 then -- &apos;string&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">                buf := json_elem.get_string();</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">                --dbms_output.put_line(&apos;res[]=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">                value_array.extend(); value_array(value_array.LAST) := buf;</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">              when 4 then -- &apos;number&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">                buf := to_char(json_elem.get_number());</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">                --dbms_output.put_line(&apos;res[]=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">                value_array.extend(); value_array(value_array.LAST) := buf;</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">              when 5 then -- &apos;bool&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">                buf := case json_elem.get_bool() when true then &apos;true&apos; when false then &apos;false&apos; end;</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">                --dbms_output.put_line(&apos;res[]=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">                value_array.extend(); value_array(value_array.LAST) := buf;</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">              when 6 then -- &apos;null&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">                buf := null;</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">                --dbms_output.put_line(&apos;res[]=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">                value_array.extend(); value_array(value_array.LAST) := buf;</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">              else</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">                -- if object is unknown or does not exist add new element of type null</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">                buf := null;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">                --dbms_output.put_line(&apos;res=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">                sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := pljson_varray(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">            end case;</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">          end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">          sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := value_array;</code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">        when 3 then -- &apos;string&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">          buf := json_val.get_string();</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">          --dbms_output.put_line(&apos;res=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">          sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := pljson_varray(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">        when 4 then -- &apos;number&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">          buf := to_char(json_val.get_number());</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">          --dbms_output.put_line(&apos;res=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">          sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := pljson_varray(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">        when 5 then -- &apos;bool&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">          buf := case json_val.get_bool() when true then &apos;true&apos; when false then &apos;false&apos; end;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql">          --dbms_output.put_line(&apos;res=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">          sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := pljson_varray(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">        when 6 then -- &apos;null&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">          buf := null;</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">          --dbms_output.put_line(&apos;res=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">          sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := pljson_varray(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">          -- if object is unknown or does not exist add new element of type null</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">          buf := null;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">          --dbms_output.put_line(&apos;res=&apos;||buf);</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">          sctx.data_tab.extend(); sctx.data_tab(sctx.data_tab.LAST) := pljson_varray(buf);</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">    --dbms_output.put_line(&apos;initialize row indexes&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">    sctx.row_inds.delete;</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">    --for i in data_tab.FIRST .. data_tab.LAST loop</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">    for i in paths.FIRST .. paths.LAST loop</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql">      sctx.row_inds.extend();</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">      sctx.row_inds(sctx.row_inds.LAST) := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">    return odciconst.success;</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">  member function ODCITableFetch(self in out pljson_table_impl, nrows in number, outset out anydataset) return number is</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">    --data_row pljson_varray := pljson_varray();</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">    --type index_array is table of number;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">    --row_inds index_array := index_array();</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">    j number;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">    num_rows number := 0;</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql">    --dbms_output.put_line(&apos;&gt;&gt;Fetch, nrows = &apos; || nrows);</code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">    outset := null;</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">    if (row_inds(1) = 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">      --dbms_output.put_line(&apos;&gt;&gt;Fetch End&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">      return odciconst.success;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">    anydataset.begincreate(dbms_types.typecode_object, self.ret_type, outset);</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">    /* iterative cartesian product algorithm */</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">    &lt;&lt;main_loop&gt;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">    while True loop</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">      exit when num_rows = nrows or row_inds(1) = 0;</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">      --data_row.delete;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">      outset.addinstance;</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">      outset.piecewise();</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">      --dbms_output.put_line(&apos;put one row piece&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">      for i in data_tab.FIRST .. data_tab.LAST loop</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">        --data_row.extend();</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">        --data_row(data_row.LAST) := data_tab(i)(row_inds(i));</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">        --dbms_output.put_line(&apos;json_&apos;||ltrim(to_char(i)));</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">        --dbms_output.put_line(&apos;[&apos;||ltrim(to_char(row_inds(i)))||&apos;]&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">        --dbms_output.put_line(&apos;=&apos;||data_tab(i)(row_inds(i)));</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">        outset.setvarchar2(data_tab(i)(row_inds(i)));</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">      --pipe row(data_row);</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">      num_rows := num_rows + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">      --dbms_output.put_line(&apos;adjust row indexes&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">      j := row_inds.COUNT;</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">      &lt;&lt;index_loop&gt;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">      while True loop</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">        row_inds(j) := row_inds(j) + 1;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">        if row_inds(j) &lt;= data_tab(j).COUNT then</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">          exit index_loop;</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">        row_inds(j) := 1;</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">        j := j - 1;</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">        if j &lt; 1 then</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">          row_inds(1) := 0; -- hack to indicate end of all fetches</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">          exit main_loop;</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql">    --dbms_output.put_line(&apos;&gt;&gt;Fetch Complete, rows = &apos; || num_rows || &apos;, row_inds(1) = &apos; || row_inds(1));</code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">    /* check for possible bug if by chance no new rows produced */</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">    --dbms_output.put_line(&apos;finish, num_rows=&apos;||ltrim(to_char(num_rows)));</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">    outset.endcreate;</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">    return odciconst.success;</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">  member function ODCITableClose(self in pljson_table_impl) return number is</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql">    --dbms_output.put_line(&apos;&gt;&gt;Close&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">    return odciconst.success;</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">end;</code></li></ol></pre></div><div class="source_table" id="DCD3F257FD70169AFA76532687F65E08"><div class="header"> <h3>DEV.PLJSON_UTIL_PKG</h3><h4><span class="red">0 %</span> covered</h4><div> <b>322</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>322</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_util_pkg as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql">  scanner_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  pragma exception_init(scanner_exception, -20100);</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  parser_exception exception;</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">  pragma exception_init(parser_exception, -20101);</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">  Purpose:    JSON utilities for PL/SQL</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">  Remarks:</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">  Who     Date        Description</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  ------  ----------  -------------------------------------</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">  MBR     30.01.2010  Created</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">  g_json_null_object             constant varchar2(20) := &apos;{ }&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">function get_xml_to_json_stylesheet return varchar2</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">as</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">begin</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  Purpose:    return XSLT stylesheet for XML to JSON transformation</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  Remarks:    see http://code.google.com/p/xml2json-xslt/</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">  Who     Date        Description</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">  ------  ----------  -------------------------------------</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql">  MBR     30.01.2010  Created</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">  MBR     30.01.2010  Added fix for nulls</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">  return q&apos;^&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">&lt;!--</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">  Copyright (c) 2006,2008 Doeke Zanstra</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">  All rights reserved.</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql">  Redistribution and use in source and binary forms, with or without modification,</code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">  are permitted provided that the following conditions are met:</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">  Redistributions of source code must retain the above copyright notice, this</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">  list of conditions and the following disclaimer. Redistributions in binary</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">  form must reproduce the above copyright notice, this list of conditions and the</code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">  following disclaimer in the documentation and/or other materials provided with</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">  the distribution.</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">  OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">  THE POSSIBILITY OF SUCH DAMAGE.</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">--&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">  &lt;xsl:output indent=&quot;no&quot; omit-xml-declaration=&quot;yes&quot; method=&quot;text&quot; encoding=&quot;UTF-8&quot; media-type=&quot;text/x-json&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">        &lt;xsl:strip-space elements=&quot;*&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">  &lt;!--contant--&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">  &lt;xsl:variable name=&quot;d&quot;&gt;0123456789&lt;/xsl:variable&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">  &lt;!-- ignore document text --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">  &lt;xsl:template match=&quot;text()[preceding-sibling::node() or following-sibling::node()]&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">  &lt;!-- string --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">  &lt;xsl:template match=&quot;text()&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">    &lt;xsl:call-template name=&quot;escape-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">      &lt;xsl:with-param name=&quot;s&quot; select=&quot;.&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">    &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">  &lt;!-- Main template for escaping strings; used by above template and for object-properties</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">       Responsibilities: placed quotes around string, and chain up to next filter, escape-bs-string --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">  &lt;xsl:template name=&quot;escape-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">    &lt;xsl:param name=&quot;s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql">    &lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">    &lt;xsl:call-template name=&quot;escape-bs-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">      &lt;xsl:with-param name=&quot;s&quot; select=&quot;$s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">    &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">    &lt;xsl:text&gt;&quot;&lt;/xsl:text&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">  &lt;!-- Escape the backslash (\) before everything else. --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">  &lt;xsl:template name=&quot;escape-bs-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">    &lt;xsl:param name=&quot;s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">    &lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">      &lt;xsl:when test=&quot;contains($s,&apos;\&apos;)&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql">        &lt;xsl:call-template name=&quot;escape-quot-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;concat(substring-before($s,&apos;\&apos;),&apos;\\&apos;)&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">        &lt;xsl:call-template name=&quot;escape-bs-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;substring-after($s,&apos;\&apos;)&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">      &lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql">      &lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">        &lt;xsl:call-template name=&quot;escape-quot-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;$s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">      &lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">    &lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">  &lt;!-- Escape the double quote (&quot;). --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">  &lt;xsl:template name=&quot;escape-quot-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">    &lt;xsl:param name=&quot;s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">    &lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="118">
            <code class="sql">      &lt;xsl:when test=&quot;contains($s,&apos;&amp;quot;&apos;)&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">        &lt;xsl:call-template name=&quot;encode-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;concat(substring-before($s,&apos;&amp;quot;&apos;),&apos;\&amp;quot;&apos;)&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">        &lt;xsl:call-template name=&quot;escape-quot-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="123">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;substring-after($s,&apos;&amp;quot;&apos;)&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="124">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="125">
            <code class="sql">      &lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">      &lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="127">
            <code class="sql">        &lt;xsl:call-template name=&quot;encode-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;$s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">      &lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql">    &lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="134">
            <code class="sql">  &lt;!-- Replace tab, line feed and/or carriage return by its matching escape code. Can&apos;t escape backslash</code></li>
            <li class="never" data-hits="" data-linenumber="135">
            <code class="sql">       or double quote here, because they don&apos;t replace characters (&amp;#x0; becomes \t), but they prefix</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">       characters (\ becomes \\). Besides, backslash should be seperate anyway, because it should be</code></li>
            <li class="never" data-hits="" data-linenumber="137">
            <code class="sql">       processed first. This function can&apos;t do that. --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">  &lt;xsl:template name=&quot;encode-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql">    &lt;xsl:param name=&quot;s&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">    &lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">      &lt;!-- tab --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">      &lt;xsl:when test=&quot;contains($s,&apos;&amp;#x9;&apos;)&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="143">
            <code class="sql">        &lt;xsl:call-template name=&quot;encode-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="144">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;concat(substring-before($s,&apos;&amp;#x9;&apos;),&apos;\t&apos;,substring-after($s,&apos;&amp;#x9;&apos;))&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="146">
            <code class="sql">      &lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">      &lt;!-- line feed --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql">      &lt;xsl:when test=&quot;contains($s,&apos;&amp;#xA;&apos;)&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">        &lt;xsl:call-template name=&quot;encode-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;concat(substring-before($s,&apos;&amp;#xA;&apos;),&apos;\n&apos;,substring-after($s,&apos;&amp;#xA;&apos;))&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="151">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="152">
            <code class="sql">      &lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">      &lt;!-- carriage return --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="154">
            <code class="sql">      &lt;xsl:when test=&quot;contains($s,&apos;&amp;#xD;&apos;)&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">        &lt;xsl:call-template name=&quot;encode-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql">          &lt;xsl:with-param name=&quot;s&quot; select=&quot;concat(substring-before($s,&apos;&amp;#xD;&apos;),&apos;\r&apos;,substring-after($s,&apos;&amp;#xD;&apos;))&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">        &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">      &lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="159">
            <code class="sql">      &lt;xsl:otherwise&gt;&lt;xsl:value-of select=&quot;$s&quot;/&gt;&lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="160">
            <code class="sql">    &lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="162">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">  &lt;!-- number (no support for javascript mantissa) --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql">  &lt;xsl:template match=&quot;text()[not(string(number())=&apos;NaN&apos; or</code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">                      (starts-with(.,&apos;0&apos; ) and . != &apos;0&apos; and</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">not(starts-with(.,&apos;0.&apos; ))) or</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">                      (starts-with(.,&apos;-0&apos; ) and . != &apos;-0&apos; and</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">not(starts-with(.,&apos;-0.&apos; )))</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">                      )]&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">    &lt;xsl:value-of select=&quot;.&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">  &lt;!-- boolean, case-insensitive --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">  &lt;xsl:template match=&quot;text()[translate(.,&apos;TRUE&apos;,&apos;true&apos;)=&apos;true&apos;]&quot;&gt;true&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">  &lt;xsl:template match=&quot;text()[translate(.,&apos;FALSE&apos;,&apos;false&apos;)=&apos;false&apos;]&quot;&gt;false&lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="176">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="177">
            <code class="sql">  &lt;!-- object --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">  &lt;xsl:template match=&quot;*&quot; name=&quot;base&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="179">
            <code class="sql">    &lt;xsl:if test=&quot;not(preceding-sibling::*)&quot;&gt;{&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">    &lt;xsl:call-template name=&quot;escape-string&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql">      &lt;xsl:with-param name=&quot;s&quot; select=&quot;name()&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">    &lt;/xsl:call-template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">    &lt;xsl:text&gt;:&lt;/xsl:text&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">    &lt;!-- check type of node --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="185">
            <code class="sql">    &lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="186">
            <code class="sql">      &lt;!-- null nodes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">      &lt;xsl:when test=&quot;count(child::node())=0&quot;&gt;null&lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="188">
            <code class="sql">      &lt;!-- other nodes --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">      &lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql">        &lt;xsl:apply-templates select=&quot;child::node()&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">      &lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">    &lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">    &lt;!-- end of type check --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">    &lt;xsl:if test=&quot;following-sibling::*&quot;&gt;,&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">    &lt;xsl:if test=&quot;not(following-sibling::*)&quot;&gt;}&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">  &lt;!-- array --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="199">
            <code class="sql">  &lt;xsl:template match=&quot;*[count(../*[name(../*)=name(.)])=count(../*) and count(../*)&amp;gt;1]&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="200">
            <code class="sql">    &lt;xsl:if test=&quot;not(preceding-sibling::*)&quot;&gt;[&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">    &lt;xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="202">
            <code class="sql">      &lt;xsl:when test=&quot;not(child::node())&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="203">
            <code class="sql">        &lt;xsl:text&gt;null&lt;/xsl:text&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="204">
            <code class="sql">      &lt;/xsl:when&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="205">
            <code class="sql">      &lt;xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="206">
            <code class="sql">        &lt;xsl:apply-templates select=&quot;child::node()&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="207">
            <code class="sql">      &lt;/xsl:otherwise&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">    &lt;/xsl:choose&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="209">
            <code class="sql">    &lt;xsl:if test=&quot;following-sibling::*&quot;&gt;,&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="210">
            <code class="sql">    &lt;xsl:if test=&quot;not(following-sibling::*)&quot;&gt;]&lt;/xsl:if&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql">  &lt;!-- convert root element to an anonymous container --&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">  &lt;xsl:template match=&quot;/&quot;&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">    &lt;xsl:apply-templates select=&quot;node()&quot;/&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">  &lt;/xsl:template&gt;</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">&lt;/xsl:stylesheet&gt;^&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">end get_xml_to_json_stylesheet;</code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="222">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="223">
            <code class="sql">function ref_cursor_to_json (p_ref_cursor in sys_refcursor,</code></li>
            <li class="never" data-hits="" data-linenumber="224">
            <code class="sql">                             p_max_rows in number := null,</code></li>
            <li class="never" data-hits="" data-linenumber="225">
            <code class="sql">                             p_skip_rows in number := null) return pljson_list</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">as</code></li>
            <li class="never" data-hits="" data-linenumber="227">
            <code class="sql">  l_ctx         dbms_xmlgen.ctxhandle;</code></li>
            <li class="never" data-hits="" data-linenumber="228">
            <code class="sql">  l_num_rows    pls_integer;</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">  l_xml         xmltype;</code></li>
            <li class="never" data-hits="" data-linenumber="230">
            <code class="sql">  l_json        xmltype;</code></li>
            <li class="never" data-hits="" data-linenumber="231">
            <code class="sql">  l_returnvalue clob;</code></li>
            <li class="never" data-hits="" data-linenumber="232">
            <code class="sql">begin</code></li>
            <li class="never" data-hits="" data-linenumber="233">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="234">
            <code class="sql">  /*</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="236">
            <code class="sql">  Purpose:    generate JSON from REF Cursor</code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="238">
            <code class="sql">  Remarks:</code></li>
            <li class="never" data-hits="" data-linenumber="239">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">  Who     Date        Description</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql">  ------  ----------  -------------------------------------</code></li>
            <li class="never" data-hits="" data-linenumber="242">
            <code class="sql">  MBR     30.01.2010  Created</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">  JKR     01.05.2010  Edited to fit in PL/JSON</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="245">
            <code class="sql">  */</code></li>
            <li class="never" data-hits="" data-linenumber="246">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="247">
            <code class="sql">  l_ctx := dbms_xmlgen.newcontext (p_ref_cursor);</code></li>
            <li class="never" data-hits="" data-linenumber="248">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="249">
            <code class="sql">  dbms_xmlgen.setnullhandling (l_ctx, dbms_xmlgen.empty_tag);</code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">  -- for pagination</code></li>
            <li class="never" data-hits="" data-linenumber="252">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql">  if p_max_rows is not null then</code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql">    dbms_xmlgen.setmaxrows (l_ctx, p_max_rows);</code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql">  end if;</code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">  if p_skip_rows is not null then</code></li>
            <li class="never" data-hits="" data-linenumber="258">
            <code class="sql">    dbms_xmlgen.setskiprows (l_ctx, p_skip_rows);</code></li>
            <li class="never" data-hits="" data-linenumber="259">
            <code class="sql">  end if;</code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="261">
            <code class="sql">  -- get the XML content</code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">  l_xml := dbms_xmlgen.getxmltype (l_ctx, dbms_xmlgen.none);</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql">  l_num_rows := dbms_xmlgen.getnumrowsprocessed (l_ctx);</code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">  dbms_xmlgen.closecontext (l_ctx);</code></li>
            <li class="never" data-hits="" data-linenumber="267">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="268">
            <code class="sql">  close p_ref_cursor;</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="270">
            <code class="sql">  if l_num_rows &gt; 0 then</code></li>
            <li class="never" data-hits="" data-linenumber="271">
            <code class="sql">    -- perform the XSL transformation</code></li>
            <li class="never" data-hits="" data-linenumber="272">
            <code class="sql">    l_json := l_xml.transform (xmltype(get_xml_to_json_stylesheet));</code></li>
            <li class="never" data-hits="" data-linenumber="273">
            <code class="sql">    l_returnvalue := l_json.getclobval();</code></li>
            <li class="never" data-hits="" data-linenumber="274">
            <code class="sql">  else</code></li>
            <li class="never" data-hits="" data-linenumber="275">
            <code class="sql">    l_returnvalue := g_json_null_object;</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">  end if;</code></li>
            <li class="never" data-hits="" data-linenumber="277">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="278">
            <code class="sql">  l_returnvalue := dbms_xmlgen.convert (l_returnvalue, dbms_xmlgen.entity_decode);</code></li>
            <li class="never" data-hits="" data-linenumber="279">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="280">
            <code class="sql">  if(l_num_rows = 0) then</code></li>
            <li class="never" data-hits="" data-linenumber="281">
            <code class="sql">    return pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">  else</code></li>
            <li class="never" data-hits="" data-linenumber="283">
            <code class="sql">    if(l_num_rows = 1) then</code></li>
            <li class="never" data-hits="" data-linenumber="284">
            <code class="sql">      declare ret pljson_list := pljson_list();</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">      begin</code></li>
            <li class="never" data-hits="" data-linenumber="286">
            <code class="sql">        ret.append(</code></li>
            <li class="never" data-hits="" data-linenumber="287">
            <code class="sql">          pljson(</code></li>
            <li class="never" data-hits="" data-linenumber="288">
            <code class="sql">            pljson(l_returnvalue).get(&apos;ROWSET&apos;)</code></li>
            <li class="never" data-hits="" data-linenumber="289">
            <code class="sql">          ).get(&apos;ROW&apos;)</code></li>
            <li class="never" data-hits="" data-linenumber="290">
            <code class="sql">        );</code></li>
            <li class="never" data-hits="" data-linenumber="291">
            <code class="sql">        return ret;</code></li>
            <li class="never" data-hits="" data-linenumber="292">
            <code class="sql">      end;</code></li>
            <li class="never" data-hits="" data-linenumber="293">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="294">
            <code class="sql">      return pljson_list(pljson(l_returnvalue).get(&apos;ROWSET&apos;));</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="296">
            <code class="sql">  end if;</code></li>
            <li class="never" data-hits="" data-linenumber="297">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="298">
            <code class="sql">exception</code></li>
            <li class="never" data-hits="" data-linenumber="299">
            <code class="sql">  when scanner_exception then</code></li>
            <li class="never" data-hits="" data-linenumber="300">
            <code class="sql">    dbms_output.put(&apos;Scanner problem with the following input: &apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="301">
            <code class="sql">    dbms_output.put_line(l_returnvalue);</code></li>
            <li class="never" data-hits="" data-linenumber="302">
            <code class="sql">    raise;</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql">  when parser_exception then</code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">    dbms_output.put(&apos;Parser problem with the following input: &apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql">    dbms_output.put_line(l_returnvalue);</code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql">    raise;</code></li>
            <li class="never" data-hits="" data-linenumber="307">
            <code class="sql">  when others then raise;</code></li>
            <li class="never" data-hits="" data-linenumber="308">
            <code class="sql">end ref_cursor_to_json;</code></li>
            <li class="never" data-hits="" data-linenumber="309">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="310">
            <code class="sql">function sql_to_json (p_sql in varchar2,</code></li>
            <li class="never" data-hits="" data-linenumber="311">
            <code class="sql">                      p_max_rows in number := null,</code></li>
            <li class="never" data-hits="" data-linenumber="312">
            <code class="sql">                      p_skip_rows in number := null) return pljson_list</code></li>
            <li class="never" data-hits="" data-linenumber="313">
            <code class="sql">as</code></li>
            <li class="never" data-hits="" data-linenumber="314">
            <code class="sql">  v_cur sys_refcursor;</code></li>
            <li class="never" data-hits="" data-linenumber="315">
            <code class="sql">begin</code></li>
            <li class="never" data-hits="" data-linenumber="316">
            <code class="sql">  open v_cur for p_sql;</code></li>
            <li class="never" data-hits="" data-linenumber="317">
            <code class="sql">  return ref_cursor_to_json(v_cur, p_max_rows, p_skip_rows);</code></li>
            <li class="never" data-hits="" data-linenumber="318">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="319">
            <code class="sql">end sql_to_json;</code></li>
            <li class="never" data-hits="" data-linenumber="320">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="321">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="322">
            <code class="sql">end pljson_util_pkg;</code></li></ol></pre></div><div class="source_table" id="8ACD5C747FC1C87F2DF869260BB0A4BF"><div class="header"> <h3>DEV.PLJSON_VALUE</h3><h4><span class="red">25.37 %</span> covered</h4><div> <b>134</b> relevant lines. <span class="green"><b>34</b> lines covered</span> and <span class="red"><b>100</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">type body pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  constructor function pljson_value(object_or_array sys.anydata) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="8" data-linenumber="5">
              <span class="hits">8</span>
              <code class="sql">    case object_or_array.gettypename</code></li>
            <li class="covered" data-hits="15" data-linenumber="6">
              <span class="hits">15</span>
              <code class="sql">      when sys_context(&apos;userenv&apos;, &apos;current_schema&apos;)||&apos;.PLJSON_LIST&apos; then self.typeval := 2;</code></li>
            <li class="covered" data-hits="2" data-linenumber="7">
              <span class="hits">2</span>
              <code class="sql">      when sys_context(&apos;userenv&apos;, &apos;current_schema&apos;)||&apos;.PLJSON&apos; then self.typeval := 1;</code></li>
            <li class="missed" data-hits="0" data-linenumber="8">
              <code class="sql">      else raise_application_error(-20102, &apos;PLJSON_VALUE init error (PLJSON or PLJSON_LIST allowed)&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">    end case;</code></li>
            <li class="covered" data-hits="8" data-linenumber="10">
              <span class="hits">8</span>
              <code class="sql">    self.object_or_array := object_or_array;</code></li>
            <li class="covered" data-hits="8" data-linenumber="11">
              <span class="hits">8</span>
              <code class="sql">    if(self.object_or_array is null) then self.typeval := 6; end if;</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql"></code></li>
            <li class="covered" data-hits="8" data-linenumber="13">
              <span class="hits">8</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">  constructor function pljson_value(str varchar2, esc boolean default true) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="6" data-linenumber="18">
              <span class="hits">6</span>
              <code class="sql">    self.typeval := 3;</code></li>
            <li class="covered" data-hits="12" data-linenumber="19">
              <span class="hits">12</span>
              <code class="sql">    if(esc) then self.num := 1; else self.num := 0; end if; --message to pretty printer</code></li>
            <li class="covered" data-hits="6" data-linenumber="20">
              <span class="hits">6</span>
              <code class="sql">    self.str := str;</code></li>
            <li class="covered" data-hits="6" data-linenumber="21">
              <span class="hits">6</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">  constructor function pljson_value(str clob, esc boolean default true) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">    /* E.I.Sarmas (github.com/dsnz)   2016-01-21   limit to 5000 chars */</code></li>
            <li class="missed" data-hits="0" data-linenumber="26">
              <code class="sql">    amount number := 5000; /* for Unicode text, varchar2 &apos;self.str&apos; not exceed 5000 chars, does not limit size of data */</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="28">
              <code class="sql">    self.typeval := 3;</code></li>
            <li class="missed" data-hits="0" data-linenumber="29">
              <code class="sql">    if(esc) then self.num := 1; else self.num := 0; end if; --message to pretty printer</code></li>
            <li class="missed" data-hits="0" data-linenumber="30">
              <code class="sql">    if(dbms_lob.getlength(str) &gt; amount) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="31">
              <code class="sql">      extended_str := str;</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">    -- GHS 20120615: Added IF structure to handle null clobs</code></li>
            <li class="missed" data-hits="0" data-linenumber="34">
              <code class="sql">    if dbms_lob.getlength(str) &gt; 0 then</code></li>
            <li class="missed" data-hits="0" data-linenumber="35">
              <code class="sql">      dbms_lob.read(str, amount, 1, self.str);</code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="37">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">  constructor function pljson_value(num number) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="16" data-linenumber="42">
              <span class="hits">16</span>
              <code class="sql">    self.typeval := 4;</code></li>
            <li class="covered" data-hits="16" data-linenumber="43">
              <span class="hits">16</span>
              <code class="sql">    self.num := num;</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">    /* E.I.Sarmas (github.com/dsnz)   2016-11-03   support for binary_double numbers; typeval not changed, it is still json number */</code></li>
            <li class="covered" data-hits="16" data-linenumber="45">
              <span class="hits">16</span>
              <code class="sql">    self.num_repr_number_p := &apos;t&apos;;</code></li>
            <li class="covered" data-hits="16" data-linenumber="46">
              <span class="hits">16</span>
              <code class="sql">    self.num_double := num;</code></li>
            <li class="covered" data-hits="16" data-linenumber="47">
              <span class="hits">16</span>
              <code class="sql">    if (to_number(self.num_double) = self.num) then</code></li>
            <li class="covered" data-hits="16" data-linenumber="48">
              <span class="hits">16</span>
              <code class="sql">      self.num_repr_double_p := &apos;t&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="50">
              <code class="sql">      self.num_repr_double_p := &apos;f&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql">    /* */</code></li>
            <li class="covered" data-hits="16" data-linenumber="53">
              <span class="hits">16</span>
              <code class="sql">    if(self.num is null) then self.typeval := 6; end if;</code></li>
            <li class="covered" data-hits="16" data-linenumber="54">
              <span class="hits">16</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-11-03   support for binary_double numbers; typeval not changed, it is still json number */</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">  constructor function pljson_value(num_double binary_double) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="60">
              <code class="sql">    self.typeval := 4;</code></li>
            <li class="missed" data-hits="0" data-linenumber="61">
              <code class="sql">    self.num_double := num_double;</code></li>
            <li class="missed" data-hits="0" data-linenumber="62">
              <code class="sql">    self.num_repr_double_p := &apos;t&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="63">
              <code class="sql">    self.num := num_double;</code></li>
            <li class="missed" data-hits="0" data-linenumber="64">
              <code class="sql">    if (to_binary_double(self.num) = self.num_double) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="65">
              <code class="sql">      self.num_repr_number_p := &apos;t&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="67">
              <code class="sql">      self.num_repr_number_p := &apos;f&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="69">
              <code class="sql">    if(self.num_double is null) then self.typeval := 6; end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="70">
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">  constructor function pljson_value(b boolean) return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="9" data-linenumber="75">
              <span class="hits">9</span>
              <code class="sql">    self.typeval := 5;</code></li>
            <li class="covered" data-hits="9" data-linenumber="76">
              <span class="hits">9</span>
              <code class="sql">    self.num := 0;</code></li>
            <li class="covered" data-hits="14" data-linenumber="77">
              <span class="hits">14</span>
              <code class="sql">    if(b) then self.num := 1; end if;</code></li>
            <li class="covered" data-hits="5" data-linenumber="78">
              <span class="hits">5</span>
              <code class="sql">    if(b is null) then self.typeval := 6; end if;</code></li>
            <li class="covered" data-hits="9" data-linenumber="79">
              <span class="hits">9</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">  constructor function pljson_value return self as result as</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="1" data-linenumber="84">
              <span class="hits">1</span>
              <code class="sql">    self.typeval := 6; /* for JSON null */</code></li>
            <li class="covered" data-hits="1" data-linenumber="85">
              <span class="hits">1</span>
              <code class="sql">    return;</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">  end pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">  static function makenull return pljson_value as</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="90">
              <code class="sql">    return pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">  end makenull;</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">  member function get_type return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="95">
              <code class="sql">    case self.typeval</code></li>
            <li class="missed" data-hits="0" data-linenumber="96">
              <code class="sql">    when 1 then return &apos;object&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="97">
              <code class="sql">    when 2 then return &apos;array&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="98">
              <code class="sql">    when 3 then return &apos;string&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="99">
              <code class="sql">    when 4 then return &apos;number&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="100">
              <code class="sql">    when 5 then return &apos;bool&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="101">
              <code class="sql">    when 6 then return &apos;null&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">    end case;</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">    return &apos;unknown type&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">  end get_type;</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">  member function get_string(max_byte_size number default null, max_char_size number default null) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="109">
              <code class="sql">    if(self.typeval = 3) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="110">
              <code class="sql">      if(max_byte_size is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="111">
              <code class="sql">        return substrb(self.str,1,max_byte_size);</code></li>
            <li class="missed" data-hits="0" data-linenumber="112">
              <code class="sql">      elsif (max_char_size is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="113">
              <code class="sql">        return substr(self.str,1,max_char_size);</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql">      else</code></li>
            <li class="missed" data-hits="0" data-linenumber="115">
              <code class="sql">        return self.str;</code></li>
            <li class="never" data-hits="" data-linenumber="116">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="117">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="118">
              <code class="sql">    return null;</code></li>
            <li class="never" data-hits="" data-linenumber="119">
            <code class="sql">  end get_string;</code></li>
            <li class="never" data-hits="" data-linenumber="120">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="121">
            <code class="sql">  member procedure get_string(self in pljson_value, buf in out nocopy clob) as</code></li>
            <li class="never" data-hits="" data-linenumber="122">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="123">
              <code class="sql">    if(self.typeval = 3) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="124">
              <code class="sql">      if(extended_str is not null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="125">
              <code class="sql">        dbms_lob.copy(buf, extended_str, dbms_lob.getlength(extended_str));</code></li>
            <li class="never" data-hits="" data-linenumber="126">
            <code class="sql">      else</code></li>
            <li class="missed" data-hits="0" data-linenumber="127">
              <code class="sql">        dbms_lob.writeappend(buf, length(self.str), self.str);</code></li>
            <li class="never" data-hits="" data-linenumber="128">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="129">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="130">
            <code class="sql">  end get_string;</code></li>
            <li class="never" data-hits="" data-linenumber="131">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="132">
            <code class="sql">  member function get_number return number as</code></li>
            <li class="never" data-hits="" data-linenumber="133">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="134">
              <code class="sql">    if(self.typeval = 4) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="135">
              <code class="sql">      return self.num;</code></li>
            <li class="never" data-hits="" data-linenumber="136">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="137">
              <code class="sql">    return null;</code></li>
            <li class="never" data-hits="" data-linenumber="138">
            <code class="sql">  end get_number;</code></li>
            <li class="never" data-hits="" data-linenumber="139">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="140">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-11-03   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="141">
            <code class="sql">  member function get_double return binary_double as</code></li>
            <li class="never" data-hits="" data-linenumber="142">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="143">
              <code class="sql">    if(self.typeval = 4) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="144">
              <code class="sql">      return self.num_double;</code></li>
            <li class="never" data-hits="" data-linenumber="145">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="146">
              <code class="sql">    return null;</code></li>
            <li class="never" data-hits="" data-linenumber="147">
            <code class="sql">  end get_double;</code></li>
            <li class="never" data-hits="" data-linenumber="148">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="149">
            <code class="sql">  member function get_bool return boolean as</code></li>
            <li class="never" data-hits="" data-linenumber="150">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="151">
              <code class="sql">    if(self.typeval = 5) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="152">
              <code class="sql">      return self.num = 1;</code></li>
            <li class="never" data-hits="" data-linenumber="153">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="154">
              <code class="sql">    return null;</code></li>
            <li class="never" data-hits="" data-linenumber="155">
            <code class="sql">  end get_bool;</code></li>
            <li class="never" data-hits="" data-linenumber="156">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="157">
            <code class="sql">  member function get_null return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="158">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="159">
              <code class="sql">    if(self.typeval = 6) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="160">
              <code class="sql">      return &apos;null&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="161">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="162">
              <code class="sql">    return null;</code></li>
            <li class="never" data-hits="" data-linenumber="163">
            <code class="sql">  end get_null;</code></li>
            <li class="never" data-hits="" data-linenumber="164">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="165">
            <code class="sql">  member function is_object return boolean as begin return self.typeval = 1; end;</code></li>
            <li class="never" data-hits="" data-linenumber="166">
            <code class="sql">  member function is_array return boolean as begin return self.typeval = 2; end;</code></li>
            <li class="never" data-hits="" data-linenumber="167">
            <code class="sql">  member function is_string return boolean as begin return self.typeval = 3; end;</code></li>
            <li class="never" data-hits="" data-linenumber="168">
            <code class="sql">  member function is_number return boolean as begin return self.typeval = 4; end;</code></li>
            <li class="never" data-hits="" data-linenumber="169">
            <code class="sql">  member function is_bool return boolean as begin return self.typeval = 5; end;</code></li>
            <li class="never" data-hits="" data-linenumber="170">
            <code class="sql">  member function is_null return boolean as begin return self.typeval = 6; end;</code></li>
            <li class="never" data-hits="" data-linenumber="171">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="172">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-11-03   support for binary_double numbers, is_number is still true, extra check */</code></li>
            <li class="never" data-hits="" data-linenumber="173">
            <code class="sql">  /* return true if &apos;number&apos; is representable by number */</code></li>
            <li class="never" data-hits="" data-linenumber="174">
            <code class="sql">  member function is_number_repr_number return boolean is</code></li>
            <li class="never" data-hits="" data-linenumber="175">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="176">
              <code class="sql">    if self.typeval != 4 then</code></li>
            <li class="missed" data-hits="0" data-linenumber="177">
              <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="178">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="179">
              <code class="sql">    return (num_repr_number_p = &apos;t&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="180">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="181">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="182">
            <code class="sql">  /* return true if &apos;number&apos; is representable by binary_double */</code></li>
            <li class="never" data-hits="" data-linenumber="183">
            <code class="sql">  member function is_number_repr_double return boolean is</code></li>
            <li class="never" data-hits="" data-linenumber="184">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="185">
              <code class="sql">    if self.typeval != 4 then</code></li>
            <li class="missed" data-hits="0" data-linenumber="186">
              <code class="sql">      return false;</code></li>
            <li class="never" data-hits="" data-linenumber="187">
            <code class="sql">    end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="188">
              <code class="sql">    return (num_repr_double_p = &apos;t&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="189">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="190">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="191">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-11-03   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="192">
            <code class="sql">  -- set value for number from string representation; to replace to_number in pljson_parser</code></li>
            <li class="never" data-hits="" data-linenumber="193">
            <code class="sql">  -- can automatically decide and use binary_double if needed (set repr variables)</code></li>
            <li class="never" data-hits="" data-linenumber="194">
            <code class="sql">  -- underflows and overflows count as representable if happen on both type representations</code></li>
            <li class="never" data-hits="" data-linenumber="195">
            <code class="sql">  -- less confusing than new constructor with dummy argument for overloading</code></li>
            <li class="never" data-hits="" data-linenumber="196">
            <code class="sql">  -- centralized parse_number to use everywhere else and replace code in pljson_parser</code></li>
            <li class="never" data-hits="" data-linenumber="197">
            <code class="sql">  member procedure parse_number(str varchar2) is</code></li>
            <li class="never" data-hits="" data-linenumber="198">
            <code class="sql">  begin</code></li>
            <li class="covered" data-hits="16" data-linenumber="199">
              <span class="hits">16</span>
              <code class="sql">    if self.typeval != 4 then</code></li>
            <li class="covered" data-hits="14" data-linenumber="200">
              <span class="hits">14</span>
              <code class="sql">      return;</code></li>
            <li class="never" data-hits="" data-linenumber="201">
            <code class="sql">    end if;</code></li>
            <li class="covered" data-hits="16" data-linenumber="202">
              <span class="hits">16</span>
              <code class="sql">    self.num := to_number(str);</code></li>
            <li class="covered" data-hits="16" data-linenumber="203">
              <span class="hits">16</span>
              <code class="sql">    self.num_repr_number_p := &apos;t&apos;;</code></li>
            <li class="covered" data-hits="16" data-linenumber="204">
              <span class="hits">16</span>
              <code class="sql">    self.num_double := to_binary_double(str);</code></li>
            <li class="covered" data-hits="16" data-linenumber="205">
              <span class="hits">16</span>
              <code class="sql">    self.num_repr_double_p := &apos;t&apos;;</code></li>
            <li class="covered" data-hits="16" data-linenumber="206">
              <span class="hits">16</span>
              <code class="sql">    if (to_binary_double(self.num) != self.num_double) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="207">
              <code class="sql">      self.num_repr_number_p := &apos;f&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="208">
            <code class="sql">    end if;</code></li>
            <li class="covered" data-hits="16" data-linenumber="209">
              <span class="hits">16</span>
              <code class="sql">    if (to_number(self.num_double) != self.num) then</code></li>
            <li class="covered" data-hits="2" data-linenumber="210">
              <span class="hits">2</span>
              <code class="sql">      self.num_repr_double_p := &apos;f&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="211">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="212">
            <code class="sql">  end parse_number;</code></li>
            <li class="never" data-hits="" data-linenumber="213">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="214">
            <code class="sql">  /* E.I.Sarmas (github.com/dsnz)   2016-12-01   support for binary_double numbers */</code></li>
            <li class="never" data-hits="" data-linenumber="215">
            <code class="sql">  -- centralized toString to use everywhere else and replace code in pljson_printer</code></li>
            <li class="never" data-hits="" data-linenumber="216">
            <code class="sql">  member function number_toString return varchar2 is</code></li>
            <li class="never" data-hits="" data-linenumber="217">
            <code class="sql">    num number;</code></li>
            <li class="never" data-hits="" data-linenumber="218">
            <code class="sql">    num_double binary_double;</code></li>
            <li class="never" data-hits="" data-linenumber="219">
            <code class="sql">    buf varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="220">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="221">
            <code class="sql">    /* unrolled, instead of using two nested fuctions for speed */</code></li>
            <li class="missed" data-hits="0" data-linenumber="222">
              <code class="sql">    if (self.num_repr_number_p = &apos;t&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="223">
              <code class="sql">      num := self.num;</code></li>
            <li class="missed" data-hits="0" data-linenumber="224">
              <code class="sql">      if (num &gt; 1e127d) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="225">
              <code class="sql">        return &apos;1e309&apos;; -- json representation of infinity !?</code></li>
            <li class="never" data-hits="" data-linenumber="226">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="227">
              <code class="sql">      if (num &lt; -1e127d) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="228">
              <code class="sql">        return &apos;-1e309&apos;; -- json representation of infinity !?</code></li>
            <li class="never" data-hits="" data-linenumber="229">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="230">
              <code class="sql">      buf := STANDARD.to_char(num, &apos;TM9&apos;, &apos;NLS_NUMERIC_CHARACTERS=&apos;&apos;.,&apos;&apos;&apos;);</code></li>
            <li class="missed" data-hits="0" data-linenumber="231">
              <code class="sql">      if (-1 &lt; num and num &lt; 0 and substr(buf, 1, 2) = &apos;-.&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="232">
              <code class="sql">        buf := &apos;-0&apos; || substr(buf, 2);</code></li>
            <li class="missed" data-hits="0" data-linenumber="233">
              <code class="sql">      elsif (0 &lt; num and num &lt; 1 and substr(buf, 1, 1) = &apos;.&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="234">
              <code class="sql">        buf := &apos;0&apos; || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="235">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="236">
              <code class="sql">      return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="237">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="238">
              <code class="sql">      num_double := self.num_double;</code></li>
            <li class="missed" data-hits="0" data-linenumber="239">
              <code class="sql">      if (num_double = +BINARY_DOUBLE_INFINITY) then</code></li>
            <li class="never" data-hits="" data-linenumber="240">
            <code class="sql">        return &apos;1e309&apos;; -- json representation of infinity !?</code></li>
            <li class="never" data-hits="" data-linenumber="241">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="242">
              <code class="sql">      if (num_double = -BINARY_DOUBLE_INFINITY) then</code></li>
            <li class="never" data-hits="" data-linenumber="243">
            <code class="sql">        return &apos;-1e309&apos;; -- json representation of infinity !?</code></li>
            <li class="never" data-hits="" data-linenumber="244">
            <code class="sql">      end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="245">
              <code class="sql">      buf := STANDARD.to_char(num_double, &apos;TM9&apos;, &apos;NLS_NUMERIC_CHARACTERS=&apos;&apos;.,&apos;&apos;&apos;);</code></li>
            <li class="missed" data-hits="0" data-linenumber="246">
              <code class="sql">      if (-1 &lt; num_double and num_double &lt; 0 and substr(buf, 1, 2) = &apos;-.&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="247">
              <code class="sql">        buf := &apos;-0&apos; || substr(buf, 2);</code></li>
            <li class="missed" data-hits="0" data-linenumber="248">
              <code class="sql">      elsif (0 &lt; num_double and num_double &lt; 1 and substr(buf, 1, 1) = &apos;.&apos;) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="249">
              <code class="sql">        buf := &apos;0&apos; || buf;</code></li>
            <li class="never" data-hits="" data-linenumber="250">
            <code class="sql">      end if;</code></li>
            <li class="never" data-hits="" data-linenumber="251">
            <code class="sql">      return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="252">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="253">
            <code class="sql">  end number_toString;</code></li>
            <li class="never" data-hits="" data-linenumber="254">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="255">
            <code class="sql">  /* Output methods */</code></li>
            <li class="never" data-hits="" data-linenumber="256">
            <code class="sql">  member function to_char(spaces boolean default true, chars_per_line number default 0) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="257">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="258">
              <code class="sql">    if(spaces is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="259">
              <code class="sql">      return pljson_printer.pretty_print_any(self, line_length =&gt; chars_per_line);</code></li>
            <li class="never" data-hits="" data-linenumber="260">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="261">
              <code class="sql">      return pljson_printer.pretty_print_any(self, spaces, line_length =&gt; chars_per_line);</code></li>
            <li class="never" data-hits="" data-linenumber="262">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="263">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="264">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="265">
            <code class="sql">  member procedure to_clob(self in pljson_value, buf in out nocopy clob, spaces boolean default false, chars_per_line number default 0, erase_clob boolean default true) as</code></li>
            <li class="never" data-hits="" data-linenumber="266">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="267">
              <code class="sql">    if(spaces is null) then</code></li>
            <li class="missed" data-hits="0" data-linenumber="268">
              <code class="sql">      pljson_printer.pretty_print_any(self, false, buf, line_length =&gt; chars_per_line, erase_clob =&gt; erase_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="269">
            <code class="sql">    else</code></li>
            <li class="missed" data-hits="0" data-linenumber="270">
              <code class="sql">      pljson_printer.pretty_print_any(self, spaces, buf, line_length =&gt; chars_per_line, erase_clob =&gt; erase_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="271">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="272">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="273">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="274">
            <code class="sql">  member procedure print(self in pljson_value, spaces boolean default true, chars_per_line number default 8192, jsonp varchar2 default null) as --32512 is the real maximum in sqldeveloper</code></li>
            <li class="never" data-hits="" data-linenumber="275">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="276">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="277">
              <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="278">
              <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="279">
              <code class="sql">    pljson_printer.pretty_print_any(self, spaces, my_clob, case when (chars_per_line&gt;32512) then 32512 else chars_per_line end);</code></li>
            <li class="missed" data-hits="0" data-linenumber="280">
              <code class="sql">    pljson_printer.dbms_output_clob(my_clob, pljson_printer.newline_char, jsonp);</code></li>
            <li class="missed" data-hits="0" data-linenumber="281">
              <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="282">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="283">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="284">
            <code class="sql">  member procedure htp(self in pljson_value, spaces boolean default false, chars_per_line number default 0, jsonp varchar2 default null) as</code></li>
            <li class="never" data-hits="" data-linenumber="285">
            <code class="sql">    my_clob clob;</code></li>
            <li class="never" data-hits="" data-linenumber="286">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="287">
              <code class="sql">    my_clob := empty_clob();</code></li>
            <li class="missed" data-hits="0" data-linenumber="288">
              <code class="sql">    dbms_lob.createtemporary(my_clob, true);</code></li>
            <li class="missed" data-hits="0" data-linenumber="289">
              <code class="sql">    pljson_printer.pretty_print_any(self, spaces, my_clob, chars_per_line);</code></li>
            <li class="missed" data-hits="0" data-linenumber="290">
              <code class="sql">    pljson_printer.htp_output_clob(my_clob, jsonp);</code></li>
            <li class="missed" data-hits="0" data-linenumber="291">
              <code class="sql">    dbms_lob.freetemporary(my_clob);</code></li>
            <li class="never" data-hits="" data-linenumber="292">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="293">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="294">
            <code class="sql">  member function value_of(self in pljson_value, max_byte_size number default null, max_char_size number default null) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="295">
            <code class="sql">  begin</code></li>
            <li class="missed" data-hits="0" data-linenumber="296">
              <code class="sql">    case self.typeval</code></li>
            <li class="missed" data-hits="0" data-linenumber="297">
              <code class="sql">    when 1 then return &apos;json object&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="298">
              <code class="sql">    when 2 then return &apos;json array&apos;;</code></li>
            <li class="missed" data-hits="0" data-linenumber="299">
              <code class="sql">    when 3 then return self.get_string(max_byte_size, max_char_size);</code></li>
            <li class="missed" data-hits="0" data-linenumber="300">
              <code class="sql">    when 4 then return self.get_number();</code></li>
            <li class="missed" data-hits="0" data-linenumber="301">
              <code class="sql">    when 5 then if(self.get_bool()) then return &apos;true&apos;; else return &apos;false&apos;; end if;</code></li>
            <li class="missed" data-hits="0" data-linenumber="302">
              <code class="sql">    else return null;</code></li>
            <li class="never" data-hits="" data-linenumber="303">
            <code class="sql">    end case;</code></li>
            <li class="never" data-hits="" data-linenumber="304">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="305">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="306">
            <code class="sql">end;</code></li></ol></pre></div><div class="source_table" id="16AC19A4FA51C27269DDBE9AFA77761C"><div class="header"> <h3>DEV.PLJSON_XML</h3><h4><span class="red">0 %</span> covered</h4><div> <b>115</b> relevant lines. <span class="green"><b>0</b> lines covered</span> and <span class="red"><b>115</b> lines missed</span></div></div><pre><ol>
            <li class="never" data-hits="" data-linenumber="1">
            <code class="sql">package body pljson_xml as</code></li>
            <li class="never" data-hits="" data-linenumber="2">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="3">
            <code class="sql">  function escapeStr(str varchar2) return varchar2 as</code></li>
            <li class="never" data-hits="" data-linenumber="4">
            <code class="sql">    buf varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="5">
            <code class="sql">    ch varchar2(4);</code></li>
            <li class="never" data-hits="" data-linenumber="6">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="7">
            <code class="sql">    for i in 1 .. length(str) loop</code></li>
            <li class="never" data-hits="" data-linenumber="8">
            <code class="sql">      ch := substr(str, i, 1);</code></li>
            <li class="never" data-hits="" data-linenumber="9">
            <code class="sql">      case ch</code></li>
            <li class="never" data-hits="" data-linenumber="10">
            <code class="sql">      when &apos;&amp;&apos; then buf := buf || &apos;&amp;amp;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="11">
            <code class="sql">      when &apos;&lt;&apos; then buf := buf || &apos;&amp;lt;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="12">
            <code class="sql">      when &apos;&gt;&apos; then buf := buf || &apos;&amp;gt;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="13">
            <code class="sql">      when &apos;&quot;&apos; then buf := buf || &apos;&amp;quot;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="14">
            <code class="sql">      else buf := buf || ch;</code></li>
            <li class="never" data-hits="" data-linenumber="15">
            <code class="sql">      end case;</code></li>
            <li class="never" data-hits="" data-linenumber="16">
            <code class="sql">    end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="17">
            <code class="sql">    return buf;</code></li>
            <li class="never" data-hits="" data-linenumber="18">
            <code class="sql">  end escapeStr;</code></li>
            <li class="never" data-hits="" data-linenumber="19">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="20">
            <code class="sql">/* Clob methods from printer */</code></li>
            <li class="never" data-hits="" data-linenumber="21">
            <code class="sql">  procedure add_to_clob(buf_lob in out nocopy clob, buf_str in out nocopy varchar2, str varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="22">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="23">
            <code class="sql">    if(length(str) &gt; 32767 - length(buf_str)) then</code></li>
            <li class="never" data-hits="" data-linenumber="24">
            <code class="sql">      dbms_lob.append(buf_lob, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="25">
            <code class="sql">      buf_str := str;</code></li>
            <li class="never" data-hits="" data-linenumber="26">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="27">
            <code class="sql">      buf_str := buf_str || str;</code></li>
            <li class="never" data-hits="" data-linenumber="28">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="29">
            <code class="sql">  end add_to_clob;</code></li>
            <li class="never" data-hits="" data-linenumber="30">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="31">
            <code class="sql">  procedure flush_clob(buf_lob in out nocopy clob, buf_str in out nocopy varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="32">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="33">
            <code class="sql">    dbms_lob.append(buf_lob, buf_str);</code></li>
            <li class="never" data-hits="" data-linenumber="34">
            <code class="sql">  end flush_clob;</code></li>
            <li class="never" data-hits="" data-linenumber="35">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="36">
            <code class="sql">  procedure toString(obj pljson_value, tagname in varchar2, xmlstr in out nocopy clob, xmlbuf in out nocopy varchar2) as</code></li>
            <li class="never" data-hits="" data-linenumber="37">
            <code class="sql">    v_obj pljson;</code></li>
            <li class="never" data-hits="" data-linenumber="38">
            <code class="sql">    v_list pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="39">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="40">
            <code class="sql">    v_keys pljson_list;</code></li>
            <li class="never" data-hits="" data-linenumber="41">
            <code class="sql">    v_value pljson_value;</code></li>
            <li class="never" data-hits="" data-linenumber="42">
            <code class="sql">    key_str varchar2(4000);</code></li>
            <li class="never" data-hits="" data-linenumber="43">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="44">
            <code class="sql">    if (obj.is_object()) then</code></li>
            <li class="never" data-hits="" data-linenumber="45">
            <code class="sql">      add_to_clob(xmlstr, xmlbuf, &apos;&lt;&apos; || tagname || &apos;&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="46">
            <code class="sql">      v_obj := pljson(obj);</code></li>
            <li class="never" data-hits="" data-linenumber="47">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="48">
            <code class="sql">      v_keys := v_obj.get_keys();</code></li>
            <li class="never" data-hits="" data-linenumber="49">
            <code class="sql">      for i in 1 .. v_keys.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="50">
            <code class="sql">        v_value := v_obj.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="51">
            <code class="sql">        key_str := v_keys.get(i).str;</code></li>
            <li class="never" data-hits="" data-linenumber="52">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="53">
            <code class="sql">        if(key_str = &apos;content&apos;) then</code></li>
            <li class="never" data-hits="" data-linenumber="54">
            <code class="sql">          if(v_value.is_array()) then</code></li>
            <li class="never" data-hits="" data-linenumber="55">
            <code class="sql">            declare</code></li>
            <li class="never" data-hits="" data-linenumber="56">
            <code class="sql">              v_l pljson_list := pljson_list(v_value);</code></li>
            <li class="never" data-hits="" data-linenumber="57">
            <code class="sql">            begin</code></li>
            <li class="never" data-hits="" data-linenumber="58">
            <code class="sql">              for j in 1 .. v_l.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="59">
            <code class="sql">                if(j &gt; 1) then add_to_clob(xmlstr, xmlbuf, chr(13)||chr(10)); end if;</code></li>
            <li class="never" data-hits="" data-linenumber="60">
            <code class="sql">                add_to_clob(xmlstr, xmlbuf, escapeStr(v_l.get(j).to_char()));</code></li>
            <li class="never" data-hits="" data-linenumber="61">
            <code class="sql">              end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="62">
            <code class="sql">            end;</code></li>
            <li class="never" data-hits="" data-linenumber="63">
            <code class="sql">          else</code></li>
            <li class="never" data-hits="" data-linenumber="64">
            <code class="sql">            add_to_clob(xmlstr, xmlbuf, escapeStr(v_value.to_char()));</code></li>
            <li class="never" data-hits="" data-linenumber="65">
            <code class="sql">          end if;</code></li>
            <li class="never" data-hits="" data-linenumber="66">
            <code class="sql">        elsif(v_value.is_array()) then</code></li>
            <li class="never" data-hits="" data-linenumber="67">
            <code class="sql">          declare</code></li>
            <li class="never" data-hits="" data-linenumber="68">
            <code class="sql">            v_l pljson_list := pljson_list(v_value);</code></li>
            <li class="never" data-hits="" data-linenumber="69">
            <code class="sql">          begin</code></li>
            <li class="never" data-hits="" data-linenumber="70">
            <code class="sql">            for j in 1 .. v_l.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="71">
            <code class="sql">              v_value := v_l.get(j);</code></li>
            <li class="never" data-hits="" data-linenumber="72">
            <code class="sql">              if(v_value.is_array()) then</code></li>
            <li class="never" data-hits="" data-linenumber="73">
            <code class="sql">                add_to_clob(xmlstr, xmlbuf, &apos;&lt;&apos; || key_str || &apos;&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="74">
            <code class="sql">                add_to_clob(xmlstr, xmlbuf, escapeStr(v_value.to_char()));</code></li>
            <li class="never" data-hits="" data-linenumber="75">
            <code class="sql">                add_to_clob(xmlstr, xmlbuf, &apos;&lt;/&apos; || key_str || &apos;&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="76">
            <code class="sql">              else</code></li>
            <li class="never" data-hits="" data-linenumber="77">
            <code class="sql">                toString(v_value, key_str, xmlstr, xmlbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="78">
            <code class="sql">              end if;</code></li>
            <li class="never" data-hits="" data-linenumber="79">
            <code class="sql">            end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="80">
            <code class="sql">          end;</code></li>
            <li class="never" data-hits="" data-linenumber="81">
            <code class="sql">        elsif(v_value.is_null() or (v_value.is_string and v_value.get_string = &apos;&apos;)) then</code></li>
            <li class="never" data-hits="" data-linenumber="82">
            <code class="sql">          add_to_clob(xmlstr, xmlbuf, &apos;&lt;&apos; || key_str || &apos;/&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="83">
            <code class="sql">        else</code></li>
            <li class="never" data-hits="" data-linenumber="84">
            <code class="sql">          toString(v_value, key_str, xmlstr, xmlbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="85">
            <code class="sql">        end if;</code></li>
            <li class="never" data-hits="" data-linenumber="86">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="87">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="88">
            <code class="sql">      add_to_clob(xmlstr, xmlbuf, &apos;&lt;/&apos; || tagname || &apos;&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="89">
            <code class="sql">    elsif (obj.is_array()) then</code></li>
            <li class="never" data-hits="" data-linenumber="90">
            <code class="sql">      v_list := pljson_list(obj);</code></li>
            <li class="never" data-hits="" data-linenumber="91">
            <code class="sql">      for i in 1 .. v_list.count loop</code></li>
            <li class="never" data-hits="" data-linenumber="92">
            <code class="sql">        v_value := v_list.get(i);</code></li>
            <li class="never" data-hits="" data-linenumber="93">
            <code class="sql">        toString(v_value, nvl(tagname, &apos;array&apos;), xmlstr, xmlbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="94">
            <code class="sql">      end loop;</code></li>
            <li class="never" data-hits="" data-linenumber="95">
            <code class="sql">    else</code></li>
            <li class="never" data-hits="" data-linenumber="96">
            <code class="sql">      add_to_clob(xmlstr, xmlbuf, &apos;&lt;&apos; || tagname || &apos;&gt;&apos;||case when obj.value_of() is  not null then escapeStr(obj.value_of()) end ||&apos;&lt;/&apos; || tagname || &apos;&gt;&apos;);</code></li>
            <li class="never" data-hits="" data-linenumber="97">
            <code class="sql">    end if;</code></li>
            <li class="never" data-hits="" data-linenumber="98">
            <code class="sql">  end toString;</code></li>
            <li class="never" data-hits="" data-linenumber="99">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="100">
            <code class="sql">  function json_to_xml(obj pljson, tagname varchar2 default &apos;root&apos;) return xmltype as</code></li>
            <li class="never" data-hits="" data-linenumber="101">
            <code class="sql">    xmlstr clob := empty_clob();</code></li>
            <li class="never" data-hits="" data-linenumber="102">
            <code class="sql">    xmlbuf varchar2(32767) := &apos;&apos;;</code></li>
            <li class="never" data-hits="" data-linenumber="103">
            <code class="sql">    returnValue xmltype;</code></li>
            <li class="never" data-hits="" data-linenumber="104">
            <code class="sql">  begin</code></li>
            <li class="never" data-hits="" data-linenumber="105">
            <code class="sql">    dbms_lob.createtemporary(xmlstr, true);</code></li>
            <li class="never" data-hits="" data-linenumber="106">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="107">
            <code class="sql">    toString(obj.to_json_value(), tagname, xmlstr, xmlbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="108">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="109">
            <code class="sql">    flush_clob(xmlstr, xmlbuf);</code></li>
            <li class="never" data-hits="" data-linenumber="110">
            <code class="sql">    returnValue := xmltype(&apos;&lt;?xml version=&quot;1.0&quot;?&gt;&apos;||xmlstr);</code></li>
            <li class="never" data-hits="" data-linenumber="111">
            <code class="sql">    dbms_lob.freetemporary(xmlstr);</code></li>
            <li class="never" data-hits="" data-linenumber="112">
            <code class="sql">    return returnValue;</code></li>
            <li class="never" data-hits="" data-linenumber="113">
            <code class="sql">  end;</code></li>
            <li class="never" data-hits="" data-linenumber="114">
            <code class="sql"></code></li>
            <li class="never" data-hits="" data-linenumber="115">
            <code class="sql">end pljson_xml;</code></li></ol></pre></div></div></div></body></html>

